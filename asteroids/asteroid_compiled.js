var THREE=THREE||{};Color=function(a){this.autoUpdate=true;this.setHex(a)};
Color.prototype={setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;if(this.autoUpdate){this.updateHex();this.updateStyleString()}},setHSV:function(a,b,c){var d,f,g,h,j,k;if(c==0)d=f=g=0;else{h=Math.floor(a*6);j=a*6-h;a=c*(1-b);k=c*(1-b*j);b=c*(1-b*(1-j));switch(h){case 1:d=k;f=c;g=a;break;case 2:d=a;f=c;g=b;break;case 3:d=a;f=k;g=c;break;case 4:d=b;f=a;g=c;break;case 5:d=c;f=a;g=k;break;case 6:case 0:d=c;f=b;g=a}}this.r=d;this.g=f;this.b=g;if(this.autoUpdate){this.updateHex();this.updateStyleString()}},
setHex:function(a){this.hex=~~a&16777215;if(this.autoUpdate){this.updateRGBA();this.updateStyleString()}},updateHex:function(){this.hex=~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},updateRGBA:function(){this.r=(this.hex>>16&255)/255;this.g=(this.hex>>8&255)/255;this.b=(this.hex&255)/255},updateStyleString:function(){this.__styleString="rgb("+~~(this.r*255)+","+~~(this.g*255)+","+~~(this.b*255)+")"},clone:function(){return new Color(this.hex)},toString:function(){return"Color ( r: "+
this.r+", g: "+this.g+", b: "+this.b+", hex: "+this.hex+" )"}};Vector2=function(a,b){this.x=a||0;this.y=b||0};
Vector2.prototype={set:function(a,b){this.x=a;this.y=b;return this},cy:function(a){this.x=a.x;this.y=a.y;return this},aS:function(a){this.x+=a.x;this.y+=a.y;return this},add:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;return this},sub:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},ms:function(a){this.x*=a;this.y*=a;return this},unit:function(){this.ms(1/this.length());return this},length:function(){return Math.sqrt(this.x*
this.x+this.y*this.y)},lengthSq:function(){return this.x*this.x+this.y*this.y},negate:function(){this.x=-this.x;this.y=-this.y;return this},clone:function(){return new Vector2(this.x,this.y)},toString:function(){return"Vector2 ("+this.x+", "+this.y+")"}};v3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};
v3.prototype={set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},cy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},aS:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},aSc:function(a){this.x+=a;this.y+=a;this.z+=a;return this},sub:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},
cross:function(a,b){this.x=a.y*b.z-a.z*b.y;this.y=a.z*b.x-a.x*b.z;this.z=a.x*b.y-a.y*b.x;return this},crossSelf:function(a){var b=this.x,c=this.y,d=this.z;this.x=c*a.z-d*a.y;this.y=d*a.x-b*a.z;this.z=b*a.y-c*a.x;return this},multiply:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},mS:function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},ms:function(a){this.x*=a;this.y*=a;this.z*=a;return this},divideSelf:function(a){this.x/=a.x;this.y/=a.y;this.z/=
a.z;return this},divideScalar:function(a){this.x/=a;this.y/=a;this.z/=a;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},distanceTo:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return Math.sqrt(b*b+c*c+a*a)},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},negate:function(){this.x=
-this.x;this.y=-this.y;this.z=-this.z;return this},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);a>0?this.ms(1/a):this.set(0,0,0);return this},setLength:function(a){return this.normalize().ms(a)},isZero:function(){return Math.abs(this.x)<1.0E-4&&Math.abs(this.y)<1.0E-4&&Math.abs(this.z)<1.0E-4},clone:function(){return new v3(this.x,this.y,this.z)},toString:function(){return"v3 ( "+this.x+", "+this.y+", "+this.z+" )"}};
Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=d||1};
Vector4.prototype={set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},cy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w||1;return this},add:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},aS:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},sub:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;
return this},ms:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},divideScalar:function(a){this.x/=a;this.y/=a;this.z/=a;this.w/=a;return this},lerpSelf:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b},clone:function(){return new Vector4(this.x,this.y,this.z,this.w)},toString:function(){return"Vector4 ("+this.x+", "+this.y+", "+this.z+", "+this.w+")"}};
Ray=function(a,b){this.origin=a||new v3;this.direction=b||new v3};
Ray.prototype={intersectScene:function(a){var b,c,d=a.objects,f=[];a=0;for(b=d.length;a<b;a++){c=d[a];if(c instanceof Mesh)f=f.concat(this.intersectoB(c))}f.sort(function(g,h){return g.distance-h.distance});return f},intersectoB:function(a){function b(E,v,B,p){p=p.clone().subSelf(v);B=B.clone().subSelf(v);var e=E.clone().subSelf(v);E=p.dot(p);v=p.dot(B);p=p.dot(e);var O=B.dot(B);B=B.dot(e);e=1/(E*O-v*v);O=(O*p-v*B)*e;E=(E*B-v*p)*e;return O>0&&E>0&&O+E<1}var c,d,f,g,h,j,k,m,o,w,
t,n=a.gG,y=n.vts,z=[];c=0;for(d=n.faces.length;c<d;c++){f=n.faces[c];w=this.origin.clone();t=this.direction.clone();g=a.matrix.mV3(y[f.a].ppos.clone());h=a.matrix.mV3(y[f.b].ppos.clone());j=a.matrix.mV3(y[f.c].ppos.clone());k=f instanceof Face4?a.matrix.mV3(y[f.d].ppos.clone()):null;m=a.rtMatrix.mV3(f.normal.clone());o=t.dot(m);if(o<0){m=m.dot((new v3).sub(g,w))/o;w=w.aS(t.ms(m));
if(f instanceof Face3){if(b(w,g,h,j)){f={distance:this.origin.distanceTo(w),point:w,face:f,object:a};z.push(f)}}else if(f instanceof Face4)if(b(w,g,h,k)||b(w,h,j,k)){f={distance:this.origin.distanceTo(w),point:w,face:f,object:a};z.push(f)}}}return z}};
Rectangle=function(){function a(){g=d-b;h=f-c}var b,c,d,f,g,h,j=true;this.getX=function(){return b};this.getY=function(){return c};this.getWidth=function(){return g};this.getHeight=function(){return h};this.getLeft=function(){return b};this.getTop=function(){return c};this.getRight=function(){return d};this.getBottom=function(){return f};this.set=function(k,m,o,w){j=false;b=k;c=m;d=o;f=w;a()};this.addPoint=function(k,m){if(j){j=false;b=k;c=m;d=k;f=m}else{b=b<k?b:k;c=c<m?c:m;d=d>k?d:k;f=f>m?
f:m}a()};this.add3Points=function(k,m,o,w,t,n){if(j){j=false;b=k<o?k<t?k:t:o<t?o:t;c=m<w?m<n?m:n:w<n?w:n;d=k>o?k>t?k:t:o>t?o:t;f=m>w?m>n?m:n:w>n?w:n}else{b=k<o?k<t?k<b?k:b:t<b?t:b:o<t?o<b?o:b:t<b?t:b;c=m<w?m<n?m<c?m:c:n<c?n:c:w<n?w<c?w:c:n<c?n:c;d=k>o?k>t?k>d?k:d:t>d?t:d:o>t?o>d?o:d:t>d?t:d;f=m>w?m>n?m>f?m:f:n>f?n:f:w>n?w>f?w:f:n>f?n:f}a()};this.addRectangle=function(k){if(j){j=false;b=k.getLeft();c=k.getTop();d=k.getRight();f=k.getBottom()}else{b=b<k.getLeft()?b:k.getLeft();c=c<k.getTop()?c:k.getTop();
d=d>k.getRight()?d:k.getRight();f=f>k.getBottom()?f:k.getBottom()}a()};this.inflate=function(k){b-=k;c-=k;d+=k;f+=k;a()};this.minSelf=function(k){b=b>k.getLeft()?b:k.getLeft();c=c>k.getTop()?c:k.getTop();d=d<k.getRight()?d:k.getRight();f=f<k.getBottom()?f:k.getBottom();a()};this.instersects=function(k){return Math.min(d,k.getRight())-Math.max(b,k.getLeft())>=0&&Math.min(f,k.getBottom())-Math.max(c,k.getTop())>=0};this.empty=function(){j=true;f=d=c=b=0;a()};this.isEmpty=function(){return j};this.toString=
function(){return"Rectangle ( left: "+b+", right: "+d+", top: "+c+", bottom: "+f+", width: "+g+", height: "+h+" )"}};Matrix3=function(){this.m=[]};Matrix3.prototype={transpose:function(){var a,b=this.m;a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=b[7];b[7]=a;return this},transposeIntoArray:function(a){var b=this.m;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this}};
m4=function(a,b,c,d,f,g,h,j,k,m,o,w,t,n,y,z){this.n11=a||1;this.n12=b||0;this.n13=c||0;this.n14=d||0;this.n21=f||0;this.n22=g||1;this.n23=h||0;this.n24=j||0;this.n31=k||0;this.n32=m||0;this.n33=o||1;this.n34=w||0;this.n41=t||0;this.n42=n||0;this.n43=y||0;this.n44=z||1;this.flat=Array(16);this.m33=new Matrix3};
m4.prototype={identity:function(){this.n11=1;this.n21=this.n14=this.n13=this.n12=0;this.n22=1;this.n32=this.n31=this.n24=this.n23=0;this.n33=1;this.n43=this.n42=this.n41=this.n34=0;this.n44=1;return this},set:function(a,b,c,d,f,g,h,j,k,m,o,w,t,n,y,z){this.n11=a;this.n12=b;this.n13=c;this.n14=d;this.n21=f;this.n22=g;this.n23=h;this.n24=j;this.n31=k;this.n32=m;this.n33=o;this.n34=w;this.n41=t;this.n42=n;this.n43=y;this.n44=z;return this},cy:function(a){this.n11=a.n11;this.n12=a.n12;this.n13=
a.n13;this.n14=a.n14;this.n21=a.n21;this.n22=a.n22;this.n23=a.n23;this.n24=a.n24;this.n31=a.n31;this.n32=a.n32;this.n33=a.n33;this.n34=a.n34;this.n41=a.n41;this.n42=a.n42;this.n43=a.n43;this.n44=a.n44;return this},lookAt:function(a,b,c){var d=m4.__tmpVec1,f=m4.__tmpVec2,g=m4.__tmpVec3;g.sub(a,b).normalize();d.cross(c,g).normalize();f.cross(g,d).normalize();this.n11=d.x;this.n12=d.y;this.n13=d.z;this.n14=-d.dot(a);this.n21=f.x;this.n22=f.y;this.n23=f.z;this.n24=-f.dot(a);
this.n31=g.x;this.n32=g.y;this.n33=g.z;this.n34=-g.dot(a);this.n43=this.n42=this.n41=0;this.n44=1;return this},mV3:function(a){var b=a.x,c=a.y,d=a.z,f=1/(this.n41*b+this.n42*c+this.n43*d+this.n44);a.x=(this.n11*b+this.n12*c+this.n13*d+this.n14)*f;a.y=(this.n21*b+this.n22*c+this.n23*d+this.n24)*f;a.z=(this.n31*b+this.n32*c+this.n33*d+this.n34)*f;return a},mV4:function(a){var b=a.x,c=a.y,d=a.z,f=a.w;a.x=this.n11*b+this.n12*c+this.n13*d+this.n14*f;a.y=this.n21*b+this.n22*c+this.n23*
d+this.n24*f;a.z=this.n31*b+this.n32*c+this.n33*d+this.n34*f;a.w=this.n41*b+this.n42*c+this.n43*d+this.n44*f;return a},crossVector:function(a){var b=new Vector4;b.x=this.n11*a.x+this.n12*a.y+this.n13*a.z+this.n14*a.w;b.y=this.n21*a.x+this.n22*a.y+this.n23*a.z+this.n24*a.w;b.z=this.n31*a.x+this.n32*a.y+this.n33*a.z+this.n34*a.w;b.w=a.w?this.n41*a.x+this.n42*a.y+this.n43*a.z+this.n44*a.w:1;return b},multiply:function(a,b){var c=a.n11,d=a.n12,f=a.n13,g=a.n14,h=a.n21,j=a.n22,k=a.n23,m=a.n24,o=a.n31,
w=a.n32,t=a.n33,n=a.n34,y=a.n41,z=a.n42,E=a.n43,v=a.n44,B=b.n11,p=b.n12,e=b.n13,O=b.n14,Z=b.n21,I=b.n22,L=b.n23,X=b.n24,P=b.n31,V=b.n32,W=b.n33,J=b.n34,Q=b.n41,fa=b.n42,U=b.n43,ea=b.n44;this.n11=c*B+d*Z+f*P+g*Q;this.n12=c*p+d*I+f*V+g*fa;this.n13=c*e+d*L+f*W+g*U;this.n14=c*O+d*X+f*J+g*ea;this.n21=h*B+j*Z+k*P+m*Q;this.n22=h*p+j*I+k*V+m*fa;this.n23=h*e+j*L+k*W+m*U;this.n24=h*O+j*X+k*J+m*ea;this.n31=o*B+w*Z+t*P+n*Q;this.n32=o*p+w*I+t*V+n*fa;this.n33=o*e+w*L+t*W+n*U;this.n34=o*O+w*X+t*J+n*ea;this.n41=
y*B+z*Z+E*P+v*Q;this.n42=y*p+z*I+E*V+v*fa;this.n43=y*e+z*L+E*W+v*U;this.n44=y*O+z*X+E*J+v*ea;return this},multiplyToArray:function(a,b,c){var d=a.n11,f=a.n12,g=a.n13,h=a.n14,j=a.n21,k=a.n22,m=a.n23,o=a.n24,w=a.n31,t=a.n32,n=a.n33,y=a.n34,z=a.n41,E=a.n42,v=a.n43;a=a.n44;var B=b.n11,p=b.n12,e=b.n13,O=b.n14,Z=b.n21,I=b.n22,L=b.n23,X=b.n24,P=b.n31,V=b.n32,W=b.n33,J=b.n34,Q=b.n41,fa=b.n42,U=b.n43;b=b.n44;this.n11=d*B+f*Z+g*P+h*Q;this.n12=d*p+f*I+g*V+h*fa;this.n13=d*e+f*L+g*W+h*U;this.n14=d*O+f*X+g*J+h*
b;this.n21=j*B+k*Z+m*P+o*Q;this.n22=j*p+k*I+m*V+o*fa;this.n23=j*e+k*L+m*W+o*U;this.n24=j*O+k*X+m*J+o*b;this.n31=w*B+t*Z+n*P+y*Q;this.n32=w*p+t*I+n*V+y*fa;this.n33=w*e+t*L+n*W+y*U;this.n34=w*O+t*X+n*J+y*b;this.n41=z*B+E*Z+v*P+a*Q;this.n42=z*p+E*I+v*V+a*fa;this.n43=z*e+E*L+v*W+a*U;this.n44=z*O+E*X+v*J+a*b;c[0]=this.n11;c[1]=this.n21;c[2]=this.n31;c[3]=this.n41;c[4]=this.n12;c[5]=this.n22;c[6]=this.n32;c[7]=this.n42;c[8]=this.n13;c[9]=this.n23;c[10]=this.n33;c[11]=this.n43;c[12]=this.n14;c[13]=this.n24;
c[14]=this.n34;c[15]=this.n44;return this},mS:function(a){var b=this.n11,c=this.n12,d=this.n13,f=this.n14,g=this.n21,h=this.n22,j=this.n23,k=this.n24,m=this.n31,o=this.n32,w=this.n33,t=this.n34,n=this.n41,y=this.n42,z=this.n43,E=this.n44,v=a.n11,B=a.n21,p=a.n31,e=a.n41,O=a.n12,Z=a.n22,I=a.n32,L=a.n42,X=a.n13,P=a.n23,V=a.n33,W=a.n43,J=a.n14,Q=a.n24,fa=a.n34;a=a.n44;this.n11=b*v+c*B+d*p+f*e;this.n12=b*O+c*Z+d*I+f*L;this.n13=b*X+c*P+d*V+f*W;this.n14=b*J+c*Q+d*fa+f*a;this.n21=g*v+h*B+j*p+k*
e;this.n22=g*O+h*Z+j*I+k*L;this.n23=g*X+h*P+j*V+k*W;this.n24=g*J+h*Q+j*fa+k*a;this.n31=m*v+o*B+w*p+t*e;this.n32=m*O+o*Z+w*I+t*L;this.n33=m*X+o*P+w*V+t*W;this.n34=m*J+o*Q+w*fa+t*a;this.n41=n*v+y*B+z*p+E*e;this.n42=n*O+y*Z+z*I+E*L;this.n43=n*X+y*P+z*V+E*W;this.n44=n*J+y*Q+z*fa+E*a;return this},ms:function(a){this.n11*=a;this.n12*=a;this.n13*=a;this.n14*=a;this.n21*=a;this.n22*=a;this.n23*=a;this.n24*=a;this.n31*=a;this.n32*=a;this.n33*=a;this.n34*=a;this.n41*=a;this.n42*=a;this.n43*=a;this.n44*=
a;return this},determinant:function(){var a=this.n11,b=this.n12,c=this.n13,d=this.n14,f=this.n21,g=this.n22,h=this.n23,j=this.n24,k=this.n31,m=this.n32,o=this.n33,w=this.n34,t=this.n41,n=this.n42,y=this.n43,z=this.n44;return d*h*m*t-c*j*m*t-d*g*o*t+b*j*o*t+c*g*w*t-b*h*w*t-d*h*k*n+c*j*k*n+d*f*o*n-a*j*o*n-c*f*w*n+a*h*w*n+d*g*k*y-b*j*k*y-d*f*m*y+a*j*m*y+b*f*w*y-a*g*w*y-c*g*k*z+b*h*k*z+c*f*m*z-a*h*m*z-b*f*o*z+a*g*o*z},transpose:function(){function a(b,c,d){var f=b[c];b[c]=b[d];b[d]=f}a(this,"n21","n12");
a(this,"n31","n13");a(this,"n32","n23");a(this,"n41","n14");a(this,"n42","n24");a(this,"n43","n34");return this},clone:function(){var a=new m4;a.n11=this.n11;a.n12=this.n12;a.n13=this.n13;a.n14=this.n14;a.n21=this.n21;a.n22=this.n22;a.n23=this.n23;a.n24=this.n24;a.n31=this.n31;a.n32=this.n32;a.n33=this.n33;a.n34=this.n34;a.n41=this.n41;a.n42=this.n42;a.n43=this.n43;a.n44=this.n44;return a},flatten:function(){var a=this.flat;a[0]=this.n11;a[1]=this.n21;a[2]=this.n31;a[3]=this.n41;a[4]=this.n12;
a[5]=this.n22;a[6]=this.n32;a[7]=this.n42;a[8]=this.n13;a[9]=this.n23;a[10]=this.n33;a[11]=this.n43;a[12]=this.n14;a[13]=this.n24;a[14]=this.n34;a[15]=this.n44;return a},flattenToArray:function(a){a[0]=this.n11;a[1]=this.n21;a[2]=this.n31;a[3]=this.n41;a[4]=this.n12;a[5]=this.n22;a[6]=this.n32;a[7]=this.n42;a[8]=this.n13;a[9]=this.n23;a[10]=this.n33;a[11]=this.n43;a[12]=this.n14;a[13]=this.n24;a[14]=this.n34;a[15]=this.n44;return a},setTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,
0,0,0,1);return this},setScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},setRotX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},setRotY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},setRotZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},setRotAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),f=1-c,g=a.x,h=a.y,
j=a.z,k=f*g,m=f*h;this.set(k*g+c,k*h-d*j,k*j+d*h,0,k*h+d*j,m*h+c,m*j-d*g,0,k*j-d*h,m*j+d*g,f*j*j+c,0,0,0,0,1);return this},toString:function(){return"| "+this.n11+" "+this.n12+" "+this.n13+" "+this.n14+" |\n| "+this.n21+" "+this.n22+" "+this.n23+" "+this.n24+" |\n| "+this.n31+" "+this.n32+" "+this.n33+" "+this.n34+" |\n| "+this.n41+" "+this.n42+" "+this.n43+" "+this.n44+" |"}};m4.translationMatrix=function(a,b,c){var d=new m4;d.setTranslation(a,b,c);return d};
m4.sCMatrix=function(a,b,c){var d=new m4;d.setScale(a,b,c);return d};m4.rtXMatrix=function(a){var b=new m4;b.setRotX(a);return b};m4.rtYMatrix=function(a){var b=new m4;b.setRotY(a);return b};m4.rtZMatrix=function(a){var b=new m4;b.setRotZ(a);return b};m4.rtAxisAngleMatrix=function(a,b){var c=new m4;c.setRotAxis(a,b);return c};
m4.makeInvert=function(a){var b=a.n11,c=a.n12,d=a.n13,f=a.n14,g=a.n21,h=a.n22,j=a.n23,k=a.n24,m=a.n31,o=a.n32,w=a.n33,t=a.n34,n=a.n41,y=a.n42,z=a.n43,E=a.n44,v=new m4;v.n11=j*t*y-k*w*y+k*o*z-h*t*z-j*o*E+h*w*E;v.n12=f*w*y-d*t*y-f*o*z+c*t*z+d*o*E-c*w*E;v.n13=d*k*y-f*j*y+f*h*z-c*k*z-d*h*E+c*j*E;v.n14=f*j*o-d*k*o-f*h*w+c*k*w+d*h*t-c*j*t;v.n21=k*w*n-j*t*n-k*m*z+g*t*z+j*m*E-g*w*E;v.n22=d*t*n-f*w*n+f*m*z-b*t*z-d*m*E+b*w*E;v.n23=f*j*n-d*k*n-f*g*z+b*k*z+d*g*E-b*j*E;v.n24=d*k*m-f*j*m+
f*g*w-b*k*w-d*g*t+b*j*t;v.n31=h*t*n-k*o*n+k*m*y-g*t*y-h*m*E+g*o*E;v.n32=f*o*n-c*t*n-f*m*y+b*t*y+c*m*E-b*o*E;v.n33=d*k*n-f*h*n+f*g*y-b*k*y-c*g*E+b*h*E;v.n34=f*h*m-c*k*m-f*g*o+b*k*o+c*g*t-b*h*t;v.n41=j*o*n-h*w*n-j*m*y+g*w*y+h*m*z-g*o*z;v.n42=c*w*n-d*o*n+d*m*y-b*w*y-c*m*z+b*o*z;v.n43=d*h*n-c*j*n-d*g*y+b*j*y+c*g*z-b*h*z;v.n44=c*j*m-d*h*m+d*g*o-b*j*o-c*g*w+b*h*w;v.ms(1/a.determinant());return v};
m4.makeInvert3x3=function(a){var b=a.m33,c=b.m,d=a.n33*a.n22-a.n32*a.n23,f=-a.n33*a.n21+a.n31*a.n23,g=a.n32*a.n21-a.n31*a.n22,h=-a.n33*a.n12+a.n32*a.n13,j=a.n33*a.n11-a.n31*a.n13,k=-a.n32*a.n11+a.n31*a.n12,m=a.n23*a.n12-a.n22*a.n13,o=-a.n23*a.n11+a.n21*a.n13,w=a.n22*a.n11-a.n21*a.n12;a=a.n11*d+a.n21*h+a.n31*m;if(a==0)throw"matrix not invertible";a=1/a;c[0]=a*d;c[1]=a*f;c[2]=a*g;c[3]=a*h;c[4]=a*j;c[5]=a*k;c[6]=a*m;c[7]=a*o;c[8]=a*w;return b};
m4.makeFrustum=function(a,b,c,d,f,g){var h,j,k;h=new m4;j=2*f/(b-a);k=2*f/(d-c);a=(b+a)/(b-a);c=(d+c)/(d-c);d=-(g+f)/(g-f);f=-2*g*f/(g-f);h.n11=j;h.n12=0;h.n13=a;h.n14=0;h.n21=0;h.n22=k;h.n23=c;h.n24=0;h.n31=0;h.n32=0;h.n33=d;h.n34=f;h.n41=0;h.n42=0;h.n43=-1;h.n44=0;return h};m4.makePerspective=function(a,b,c,d){var f;a=c*Math.tan(a*Math.PI/360);f=-a;return m4.makeFrustum(f*b,a*b,f,a,c,d)};
m4.makeOrtho=function(a,b,c,d,f,g){var h,j,k,m;h=new m4;j=b-a;k=c-d;m=g-f;a=(b+a)/j;c=(c+d)/k;f=(g+f)/m;h.n11=2/j;h.n12=0;h.n13=0;h.n14=-a;h.n21=0;h.n22=2/k;h.n23=0;h.n24=-c;h.n31=0;h.n32=0;h.n33=-2/m;h.n34=-f;h.n41=0;h.n42=0;h.n43=0;h.n44=1;return h};m4.__tmpVec1=new v3;m4.__tmpVec2=new v3;m4.__tmpVec3=new v3;
Vertex=function(a,b){this.ppos=a||new v3;this.pposWorld=new v3;this.psc=new Vector4;this.normal=b||new v3;this.normalWorld=new v3;this.normalScreen=new v3;this.tangent=new Vector4;this.__vs=true};Vertex.prototype={toString:function(){return"Vertex ( ppos: "+this.ppos+", normal: "+this.normal+" )"}};
Face3=function(a,b,c,d,f){this.a=a;this.b=b;this.c=c;this.centroid=new v3;this.normal=d instanceof v3?d:new v3;this.vns=d instanceof Array?d:[];this.mTs=f instanceof Array?f:[f]};Face3.prototype={toString:function(){return"Face3 ( "+this.a+", "+this.b+", "+this.c+" )"}};
Face4=function(a,b,c,d,f,g){this.a=a;this.b=b;this.c=c;this.d=d;this.centroid=new v3;this.normal=f instanceof v3?f:new v3;this.vns=f instanceof Array?f:[];this.mTs=g instanceof Array?g:[g]};Face4.prototype={toString:function(){return"Face4 ( "+this.a+", "+this.b+", "+this.c+" "+this.d+" )"}};UV=function(a,b){this.u=a||0;this.v=b||0};
UV.prototype={cy:function(a){this.u=a.u;this.v=a.v},toString:function(){return"UV ("+this.u+", "+this.v+")"}};GG=function(){this.vts=[];this.faces=[];this.uvs=[];this.uvs2=[];this.colors=[];this.bS=this.boundingBox=null;this.gGChunks={};this.hasTangents=false};
GG.prototype={cMpCentroids:function(){var a,b,c;a=0;for(b=this.faces.length;a<b;a++){c=this.faces[a];c.centroid.set(0,0,0);if(c instanceof Face3){c.centroid.aS(this.vts[c.a].ppos);c.centroid.aS(this.vts[c.b].ppos);c.centroid.aS(this.vts[c.c].ppos);c.centroid.divideScalar(3)}else if(c instanceof Face4){c.centroid.aS(this.vts[c.a].ppos);c.centroid.aS(this.vts[c.b].ppos);c.centroid.aS(this.vts[c.c].ppos);
c.centroid.aS(this.vts[c.d].ppos);c.centroid.divideScalar(4)}}},cMpFaceNormals:function(a){var b,c,d,f,g,h,j=new v3,k=new v3;d=0;for(f=this.vts.length;d<f;d++){g=this.vts[d];g.normal.set(0,0,0)}d=0;for(f=this.faces.length;d<f;d++){g=this.faces[d];if(a&&g.vns.length){j.set(0,0,0);b=0;for(c=g.normal.length;b<c;b++)j.aS(g.vns[b]);j.divideScalar(3)}else{b=this.vts[g.a];c=this.vts[g.b];h=this.vts[g.c];j.sub(h.ppos,
c.ppos);k.sub(b.ppos,c.ppos);j.crossSelf(k)}j.isZero()||j.normalize();g.normal.cy(j)}},cMpVertexNormals:function(){var a,b,c,d;if(this.__tmpVertices==undefined){d=this.__tmpVertices=Array(this.vts.length);a=0;for(b=this.vts.length;a<b;a++)d[a]=new v3;a=0;for(b=this.faces.length;a<b;a++){c=this.faces[a];if(c instanceof Face3)c.vns=[new v3,new v3,new v3];else if(c instanceof Face4)c.vns=[new v3,
new v3,new v3,new v3]}}else{d=this.__tmpVertices;a=0;for(b=this.vts.length;a<b;a++)d[a].set(0,0,0)}a=0;for(b=this.faces.length;a<b;a++){c=this.faces[a];if(c instanceof Face3){d[c.a].aS(c.normal);d[c.b].aS(c.normal);d[c.c].aS(c.normal)}else if(c instanceof Face4){d[c.a].aS(c.normal);d[c.b].aS(c.normal);d[c.c].aS(c.normal);d[c.d].aS(c.normal)}}a=0;for(b=this.vts.length;a<b;a++)d[a].normalize();a=0;for(b=this.faces.length;a<
b;a++){c=this.faces[a];if(c instanceof Face3){c.vns[0].cy(d[c.a]);c.vns[1].cy(d[c.b]);c.vns[2].cy(d[c.c])}else if(c instanceof Face4){c.vns[0].cy(d[c.a]);c.vns[1].cy(d[c.b]);c.vns[2].cy(d[c.c]);c.vns[3].cy(d[c.d])}}},cMpTangents:function(){function a(J,Q,fa,U,ea,l,x){g=J.vts[Q].ppos;h=J.vts[fa].ppos;j=J.vts[U].ppos;k=f[ea];m=f[l];o=f[x];w=h.x-g.x;t=j.x-g.x;n=h.y-g.y;y=j.y-
g.y;z=h.z-g.z;E=j.z-g.z;v=m.u-k.u;B=o.u-k.u;p=m.v-k.v;e=o.v-k.v;O=1/(v*e-B*p);L.set((e*w-p*t)*O,(e*n-p*y)*O,(e*z-p*E)*O);X.set((v*t-B*w)*O,(v*y-B*n)*O,(v*E-B*z)*O);Z[Q].aS(L);Z[fa].aS(L);Z[U].aS(L);I[Q].aS(X);I[fa].aS(X);I[U].aS(X)}var b,c,d,f,g,h,j,k,m,o,w,t,n,y,z,E,v,B,p,e,O,Z=[],I=[],L=new v3,X=new v3,P=new v3,V=new v3,W=new v3;b=0;for(c=this.vts.length;b<c;b++){Z[b]=new v3;I[b]=new v3}b=
0;for(c=this.faces.length;b<c;b++){d=this.faces[b];f=this.uvs[b];if(d instanceof Face3){a(this,d.a,d.b,d.c,0,1,2);this.vts[d.a].normal.cy(d.vns[0]);this.vts[d.b].normal.cy(d.vns[1]);this.vts[d.c].normal.cy(d.vns[2])}else if(d instanceof Face4){a(this,d.a,d.b,d.c,0,1,2);a(this,d.a,d.b,d.d,0,1,3);this.vts[d.a].normal.cy(d.vns[0]);this.vts[d.b].normal.cy(d.vns[1]);this.vts[d.c].normal.cy(d.vns[2]);
this.vts[d.d].normal.cy(d.vns[3])}}b=0;for(c=this.vts.length;b<c;b++){W.cy(this.vts[b].normal);d=Z[b];P.cy(d);P.subSelf(W.ms(W.dot(d))).normalize();V.cross(this.vts[b].normal,d);d=V.dot(I[b]);d=d<0?-1:1;this.vts[b].tangent.set(P.x,P.y,P.z,d)}this.hasTangents=true},cMpBoundingBox:function(){var a;if(this.vts.length>0){this.boundingBox={x:[this.vts[0].ppos.x,this.vts[0].ppos.x],y:[this.vts[0].ppos.y,this.vts[0].ppos.y],
z:[this.vts[0].ppos.z,this.vts[0].ppos.z]};for(var b=1,c=this.vts.length;b<c;b++){a=this.vts[b];if(a.ppos.x<this.boundingBox.x[0])this.boundingBox.x[0]=a.ppos.x;else if(a.ppos.x>this.boundingBox.x[1])this.boundingBox.x[1]=a.ppos.x;if(a.ppos.y<this.boundingBox.y[0])this.boundingBox.y[0]=a.ppos.y;else if(a.ppos.y>this.boundingBox.y[1])this.boundingBox.y[1]=a.ppos.y;if(a.ppos.z<this.boundingBox.z[0])this.boundingBox.z[0]=a.ppos.z;else if(a.ppos.z>
this.boundingBox.z[1])this.boundingBox.z[1]=a.ppos.z}}},cMpBoundingSS:function(){for(var a=this.bS===null?0:this.bS.radius,b=0,c=this.vts.length;b<c;b++)a=Math.max(a,this.vts[b].ppos.length());this.bS={radius:a}},sortFacesByMt:function(){function a(o){var w=[];b=0;for(c=o.length;b<c;b++)o[b]==undefined?w.push("undefined"):w.push(o[b].toString());return w.join("_")}var b,c,d,f,g,h,j,k,m={};d=0;for(f=this.faces.length;d<f;d++){g=this.faces[d];
h=g.mTs;j=a(h);if(m[j]==undefined)m[j]={hash:j,counter:0};k=m[j].hash+"_"+m[j].counter;if(this.gGChunks[k]==undefined)this.gGChunks[k]={faces:[],mTs:h,vts:0};g=g instanceof Face3?3:4;if(this.gGChunks[k].vts+g>65535){m[j].counter+=1;k=m[j].hash+"_"+m[j].counter;if(this.gGChunks[k]==undefined)this.gGChunks[k]={faces:[],mTs:h,vts:0}}this.gGChunks[k].faces.push(d);this.gGChunks[k].vts+=g}},toString:function(){return"GG ( vts: "+
this.vts+", faces: "+this.faces+", uvs: "+this.uvs+" )"}};
Camera=function(a,b,c,d){this.fov=a;this.aspect=b;this.near=c;this.far=d;this.ppos=new v3;this.target={ppos:new v3};this.aum=true;this.pM=null;this.matrix=new m4;this.up=new v3(0,1,0);this.tmpVec=new v3;this.translateX=function(f){this.tmpVec.sub(this.target.ppos,this.ppos).normalize().ms(f);this.tmpVec.crossSelf(this.up);this.ppos.aS(this.tmpVec);this.target.ppos.aS(this.tmpVec)};
this.translateZ=function(f){this.tmpVec.sub(this.target.ppos,this.ppos).normalize().ms(f);this.ppos.subSelf(this.tmpVec);this.target.ppos.subSelf(this.tmpVec)};this.um=function(){this.matrix.lookAt(this.ppos,this.target.ppos,this.up)};this.updateProjectionMatrix=function(){this.pM=m4.makePerspective(this.fov,this.aspect,this.near,this.far)};this.updateProjectionMatrix()};
Camera.prototype={toString:function(){return"Camera ( "+this.ppos+", "+this.target.ppos+" )"}};Light=function(a){this.color=new Color(a)};AmbientLight=function(a){Light.call(this,a)};AmbientLight.prototype=new Light;AmbientLight.prototype.constructor=AmbientLight;DirectionalLight=function(a,b){Light.call(this,a);this.ppos=new v3(0,1,0);this.intensity=b||1};DirectionalLight.prototype=new Light;
DirectionalLight.prototype.constructor=DirectionalLight;PointLight=function(a,b){Light.call(this,a);this.ppos=new v3;this.intensity=b||1};PointLight.prototype=new Light;PointLight.prototype.constructor=PointLight;
oB3D=function(){this.id=oB3DCounter.value++;this.ppos=new v3;this.rt=new v3;this.sC=new v3(1,1,1);this.matrix=new m4;this.matrixWorld=new m4;this.rtMatrix=new m4;this.tmpMatrix=new m4;this.screen=new v3;this.vs=this.aum=true;this.children=[]};
oB3D.prototype={addChild:function(a){this.children.indexOf(a)===-1&&this.children.push(a)},removeChild:function(a){a=this.children.indexOf(a);a!==-1&&this.children.splice(a,1)},um:function(){var a=this.ppos,b=this.rt,c=this.sC,d=this.matrix,f=this.rtMatrix,g=this.tmpMatrix;d.setTranslation(a.x,a.y,a.z);f.setRotX(b.x);b.y!=0&&f.mS(g.setRotY(b.y));b.z!=0&&f.mS(g.setRotZ(b.z));d.mS(f);if(c.x!=0||c.y!=0||c.z!=0)d.mS(g.setScale(c.x,
c.y,c.z))}};oB3DCounter={value:0};Particle=function(a){oB3D.call(this);this.mTs=a instanceof Array?a:[a];this.aum=false};Particle.prototype=new oB3D;Particle.prototype.constructor=Particle;ParticleSystem=function(a,b){oB3D.call(this);this.gG=a;this.mTs=b instanceof Array?b:[b];this.sortParticles=false};ParticleSystem.prototype=new oB3D;ParticleSystem.prototype.constructor=ParticleSystem;
Line=function(a,b,c){oB3D.call(this);this.gG=a;this.mTs=b instanceof Array?b:[b];this.type=c!=undefined?c:LineStrip};LineStrip=0;LinePieces=1;Line.prototype=new oB3D;Line.prototype.constructor=Line;Mesh=function(a,b){oB3D.call(this);this.gG=a;this.mTs=b instanceof Array?b:[b];this.overdraw=this.doubleSided=this.flipSided=false;this.gG.bS||this.gG.cMpBoundingSS()};
Mesh.prototype=new oB3D;Mesh.prototype.constructor=Mesh;FlatShading=0;SmoothShading=1;NormalBlending=0;AdditiveBlending=1;SubtractiveBlending=2;BillboardBlending=3;
LineBasicMt=function(a){this.id=LineBasicMtCounter.value++;this.color=new Color(16777215);this.op=1;this.blending=NormalBlending;this.depth_test=true;this.lw=1;this.linejoin=this.linecap="round";this.vertex_colors=false;if(a){a.color!==undefined&&this.color.setHex(a.color);if(a.op!==undefined)this.op=a.op;if(a.blending!==undefined)this.blending=a.blending;if(a.depth_test!==undefined)this.depth_test=a.depth_test;if(a.lw!==undefined)this.lw=
a.lw;if(a.linecap!==undefined)this.linecap=a.linecap;if(a.linejoin!==undefined)this.linejoin=a.linejoin;if(a.vertex_colors!==undefined)this.vertex_colors=a.vertex_colors}};
LineBasicMt.prototype={toString:function(){return"LineBasicMt (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>op: "+this.op+"<br/>blending: "+this.blending+"<br/>depth_test: "+this.depth_test+"<br/>lw: "+this.lw+"<br/>linecap: "+this.linecap+"<br/>linejoin: "+this.linejoin+"<br/>vertex_colors: "+this.vertex_colors+"<br/>)"}};LineBasicMtCounter={value:0};
mBm=function(a){this.id=mBmCounter.value++;this.color=new Color(16777215);this.op=1;this.env_map=this.light_map=this.map=null;this.combine=MultiplyOperation;this.rfl=1;this.refraction_ratio=0.98;this.fog=true;this.shading=SmoothShading;this.blending=NormalBlending;this.depth_test=true;this.wf=false;this.wf_lw=1;this.wf_linejoin=this.wf_linecap="round";this.vertex_colors=false;if(a){a.color!==
undefined&&this.color.setHex(a.color);if(a.op!==undefined)this.op=a.op;if(a.map!==undefined)this.map=a.map;if(a.light_map!==undefined)this.light_map=a.light_map;if(a.env_map!==undefined)this.env_map=a.env_map;if(a.combine!==undefined)this.combine=a.combine;if(a.rfl!==undefined)this.rfl=a.rfl;if(a.refraction_ratio!==undefined)this.refraction_ratio=a.refraction_ratio;if(a.fog!==undefined)this.fog=a.fog;if(a.shading!==undefined)this.shading=a.shading;if(a.blending!==
undefined)this.blending=a.blending;if(a.depth_test!==undefined)this.depth_test=a.depth_test;if(a.wf!==undefined)this.wf=a.wf;if(a.wf_lw!==undefined)this.wf_lw=a.wf_lw;if(a.wf_linecap!==undefined)this.wf_linecap=a.wf_linecap;if(a.wf_linejoin!==undefined)this.wf_linejoin=a.wf_linejoin;if(a.vertex_colors!==undefined)this.vertex_colors=a.vertex_colors}};
mBm.prototype={toString:function(){return"mBm (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>op: "+this.op+"<br/>map: "+this.map+"<br/>light_map: "+this.light_map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>rfl: "+this.rfl+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>blending: "+this.blending+"<br/>depth_test: "+this.depth_test+"<br/>wf: "+this.wf+"<br/>wf_lw: "+this.wf_lw+
"<br/>wf_linecap: "+this.wf_linecap+"<br/>wf_linejoin: "+this.wf_linejoin+"<br/>vertex_colors: "+this.vertex_colors+"<br/>)"}};mBmCounter={value:0};
mLm=function(a){this.id=mLmCounter.value++;this.color=new Color(16777215);this.op=1;this.env_map=this.light_map=this.map=null;this.combine=MultiplyOperation;this.rfl=1;this.refraction_ratio=0.98;this.fog=true;this.shading=SmoothShading;this.blending=NormalBlending;this.depth_test=true;this.wf=false;this.wf_lw=1;this.wf_linejoin=this.wf_linecap="round";this.vertex_colors=false;if(a){a.color!==
undefined&&this.color.setHex(a.color);if(a.op!==undefined)this.op=a.op;if(a.map!==undefined)this.map=a.map;if(a.light_map!==undefined)this.light_map=a.light_map;if(a.env_map!==undefined)this.env_map=a.env_map;if(a.combine!==undefined)this.combine=a.combine;if(a.rfl!==undefined)this.rfl=a.rfl;if(a.refraction_ratio!==undefined)this.refraction_ratio=a.refraction_ratio;if(a.fog!==undefined)this.fog=a.fog;if(a.shading!==undefined)this.shading=a.shading;if(a.blending!==
undefined)this.blending=a.blending;if(a.depth_test!==undefined)this.depth_test=a.depth_test;if(a.wf!==undefined)this.wf=a.wf;if(a.wf_lw!==undefined)this.wf_lw=a.wf_lw;if(a.wf_linecap!==undefined)this.wf_linecap=a.wf_linecap;if(a.wf_linejoin!==undefined)this.wf_linejoin=a.wf_linejoin;if(a.vertex_colors!==undefined)this.vertex_colors=a.vertex_colors}};
mLm.prototype={toString:function(){return"mLm (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>op: "+this.op+"<br/>map: "+this.map+"<br/>light_map: "+this.light_map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>rfl: "+this.rfl+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>shading: "+this.shading+"<br/>blending: "+this.blending+"<br/>depth_test: "+this.depth_test+"<br/>wf: "+this.wf+
"<br/>wf_lw: "+this.wf_lw+"<br/>wf_linecap: "+this.wf_linecap+"<br/>wf_linejoin: "+this.wf_linejoin+"<br/>vertex_colors: "+this.vertex_colors+"<br/> )"}};mLmCounter={value:0};
mQm=function(a){this.id=mQmCounter.value++;this.color=new Color(16777215);this.ambient=new Color(328965);this.specular=new Color(1118481);this.shininess=30;this.op=1;this.env_map=this.light_map=this.map=null;this.combine=MultiplyOperation;this.rfl=1;this.refraction_ratio=0.98;this.fog=true;this.shading=SmoothShading;this.blending=NormalBlending;this.depth_test=true;this.wf=false;this.wf_lw=
1;this.wf_linejoin=this.wf_linecap="round";this.vertex_colors=false;if(a){if(a.color!==undefined)this.color=new Color(a.color);if(a.ambient!==undefined)this.ambient=new Color(a.ambient);if(a.specular!==undefined)this.specular=new Color(a.specular);if(a.shininess!==undefined)this.shininess=a.shininess;if(a.op!==undefined)this.op=a.op;if(a.light_map!==undefined)this.light_map=a.light_map;if(a.map!==undefined)this.map=a.map;if(a.env_map!==undefined)this.env_map=
a.env_map;if(a.combine!==undefined)this.combine=a.combine;if(a.rfl!==undefined)this.rfl=a.rfl;if(a.refraction_ratio!==undefined)this.refraction_ratio=a.refraction_ratio;if(a.fog!==undefined)this.fog=a.fog;if(a.shading!==undefined)this.shading=a.shading;if(a.blending!==undefined)this.blending=a.blending;if(a.depth_test!==undefined)this.depth_test=a.depth_test;if(a.wf!==undefined)this.wf=a.wf;if(a.wf_lw!==undefined)this.wf_lw=
a.wf_lw;if(a.wf_linecap!==undefined)this.wf_linecap=a.wf_linecap;if(a.wf_linejoin!==undefined)this.wf_linejoin=a.wf_linejoin;if(a.vertex_colors!==undefined)this.vertex_colors=a.vertex_colors}};
mQm.prototype={toString:function(){return"mQm (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>ambient: "+this.ambient+"<br/>specular: "+this.specular+"<br/>shininess: "+this.shininess+"<br/>op: "+this.op+"<br/>map: "+this.map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>rfl: "+this.rfl+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>shading: "+this.shading+"<br/>blending: "+this.blending+"<br/>depth_test: "+
this.depth_test+"<br/>wf: "+this.wf+"<br/>wf_lw: "+this.wf_lw+"<br/>wf_linecap: "+this.wf_linecap+"<br/>wf_linejoin: "+this.wf_linejoin+"<br/>vertex_colors: "+this.vertex_colors+"<br/>)"}};mQmCounter={value:0};
MeshDepthMt=function(a){this.id=MeshDepthMtCounter.value++;this.op=1;this.shading=SmoothShading;this.blending=NormalBlending;this.depth_test=true;this.wf=false;this.wf_lw=1;if(a){if(a.op!==undefined)this.op=a.op;if(a.shading!==undefined)this.shading=a.shading;if(a.blending!==undefined)this.blending=a.blending;if(a.depth_test!==undefined)this.depth_test=a.depth_test;if(a.wf!==undefined)this.wf=a.wf;if(a.wf_lw!==
undefined)this.wf_lw=a.wf_lw}};MeshDepthMt.prototype={toString:function(){return"MeshDepthMt (<br/>id: "+this.id+"<br/>op: "+this.op+"<br/>blending: "+this.blending+"<br/>depth_test: "+this.depth_test+"<br/>wf: "+this.wf+"<br/>wf_lw: "+this.wf_lw+"<br/>)"}};MeshDepthMtCounter={value:0};
MeshNormalMt=function(a){this.id=MeshNormalMtCounter.value++;this.op=1;this.shading=FlatShading;this.blending=NormalBlending;this.depth_test=true;this.wf=false;this.wf_lw=1;if(a){if(a.op!==undefined)this.op=a.op;if(a.shading!==undefined)this.shading=a.shading;if(a.blending!==undefined)this.blending=a.blending;if(a.depth_test!==undefined)this.depth_test=a.depth_test;if(a.wf!==undefined)this.wf=a.wf;if(a.wf_lw!==
undefined)this.wf_lw=a.wf_lw}};MeshNormalMt.prototype={toString:function(){return"MeshNormalMt (<br/>id: "+this.id+"<br/>op: "+this.op+"<br/>blending: "+this.blending+"<br/>depth_test: "+this.depth_test+"<br/>wf: "+this.wf+"<br/>wf_lw: "+this.wf_lw+"<br/>)"}};MeshNormalMtCounter={value:0};MeshFaceMt=function(){};MeshFaceMt.prototype={toString:function(){return"MeshFaceMt"}};
MeshShaderMt=function(a){this.id=MeshShaderMtCounter.value++;this.vertex_shader=this.fragment_shader="void main() {}";this.uniforms={};this.op=1;this.shading=SmoothShading;this.blending=NormalBlending;this.depth_test=true;this.wf=false;this.wf_lw=1;this.wf_linejoin=this.wf_linecap="round";this.vertex_colors=false;if(a){if(a.fragment_shader!==undefined)this.fragment_shader=a.fragment_shader;if(a.vertex_shader!==undefined)this.vertex_shader=
a.vertex_shader;if(a.uniforms!==undefined)this.uniforms=a.uniforms;if(a.op!==undefined)this.op=a.op;if(a.shading!==undefined)this.shading=a.shading;if(a.blending!==undefined)this.blending=a.blending;if(a.depth_test!==undefined)this.depth_test=a.depth_test;if(a.wf!==undefined)this.wf=a.wf;if(a.wf_lw!==undefined)this.wf_lw=a.wf_lw;if(a.wf_linecap!==undefined)this.wf_linecap=a.wf_linecap;if(a.wf_linejoin!==
undefined)this.wf_linejoin=a.wf_linejoin;if(a.vertex_colors!==undefined)this.vertex_colors=a.vertex_colors}};
MeshShaderMt.prototype={toString:function(){return"MeshShaderMt (<br/>id: "+this.id+"<br/>blending: "+this.blending+"<br/>depth_test: "+this.depth_test+"<br/>wf: "+this.wf+"<br/>wf_lw: "+this.wf_lw+"<br/>wf_linecap: "+this.wf_linecap+"<br/>wf_linejoin: "+this.wf_linejoin+"<br/>vertex_colors: "+this.vertex_colors+"<br/>)"}};MeshShaderMtCounter={value:0};
ParticleBasicMt=function(a){this.id=ParticleBasicMtCounter.value++;this.color=new Color(16777215);this.op=1;this.map=null;this.size=1;this.blending=NormalBlending;this.depth_test=true;this.offset=new Vector2;this.vertex_colors=false;if(a){a.color!==undefined&&this.color.setHex(a.color);if(a.op!==undefined)this.op=a.op;if(a.map!==undefined)this.map=a.map;if(a.size!==undefined)this.size=a.size;if(a.blending!==undefined)this.blending=a.blending;
if(a.depth_test!==undefined)this.depth_test=a.depth_test;if(a.vertex_colors!==undefined)this.vertex_colors=a.vertex_colors}};ParticleBasicMt.prototype={toString:function(){return"ParticleBasicMt (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>op: "+this.op+"<br/>map: "+this.map+"<br/>size: "+this.size+"<br/>blending: "+this.blending+"<br/>depth_test: "+this.depth_test+"<br/>vertex_colors: "+this.vertex_colors+"<br/>)"}};ParticleBasicMtCounter={value:0};
ParticleCircleMt=function(a){this.color=new Color(16777215);this.op=1;this.blending=NormalBlending;if(a){a.color!==undefined&&this.color.setHex(a.color);if(a.op!==undefined)this.op=a.op;if(a.blending!==undefined)this.blending=a.blending}};ParticleCircleMt.prototype={toString:function(){return"ParticleCircleMt (<br/>color: "+this.color+"<br/>op: "+this.op+"<br/>blending: "+this.blending+"<br/>)"}};
ParticleDOMMt=function(a){this.domElement=a};ParticleDOMMt.prototype={toString:function(){return"ParticleDOMMt ( domElement: "+this.domElement+" )"}};Texture=function(a,b,c,d,f,g){this.image=a;this.mapping=b!==undefined?b:new UVMapping;this.wrap_s=c!==undefined?c:ClampToEdgeWrapping;this.wrap_t=d!==undefined?d:ClampToEdgeWrapping;this.mag_filter=f!==undefined?f:LinearFilter;this.min_filter=g!==undefined?g:LinearMipMapLinearFilter};
Texture.prototype={clone:function(){return new Texture(this.image,this.mapping,this.wrap_s,this.wrap_t,this.mag_filter,this.min_filter)},toString:function(){return"Texture (<br/>image: "+this.image+"<br/>wrap_s: "+this.wrap_s+"<br/>wrap_t: "+this.wrap_t+"<br/>mag_filter: "+this.mag_filter+"<br/>min_filter: "+this.min_filter+"<br/>)"}};MultiplyOperation=0;MixOperation=1;RepeatWrapping=0;ClampToEdgeWrapping=1;MirroredRepeatWrapping=2;
NearestFilter=3;NearestMipMapNearestFilter=4;NearestMipMapLinearFilter=5;LinearFilter=6;LinearMipMapNearestFilter=7;LinearMipMapLinearFilter=8;ByteType=9;UnsignedByteType=10;ShortType=11;UnsignedShortType=12;IntType=13;UnsignedIntType=14;FloatType=15;AlphaFormat=16;RGBFormat=17;RGBAFormat=18;LuminanceFormat=19;LuminanceAlphaFormat=20;
RenderTarget=function(a,b,c){this.width=a;this.height=b;c=c||{};this.wrap_s=c.wrap_s!==undefined?c.wrap_s:ClampToEdgeWrapping;this.wrap_t=c.wrap_t!==undefined?c.wrap_t:ClampToEdgeWrapping;this.mag_filter=c.mag_filter!==undefined?c.mag_filter:LinearFilter;this.min_filter=c.min_filter!==undefined?c.min_filter:LinearMipMapLinearFilter;this.format=c.format!==undefined?c.format:RGBFormat;this.type=c.type!==undefined?c.type:UnsignedByteType};
var Uniforms={clone:function(a){var b,c,d,f={};for(b in a){f[b]={};for(c in a[b]){d=a[b][c];f[b][c]=d instanceof Color||d instanceof v3||d instanceof Texture?d.clone():d}}return f},merge:function(a){var b,c,d,f={};for(b=0;b<a.length;b++){d=this.clone(a[b]);for(c in d)f[c]=d[c]}return f}};CubeReflectionMapping=function(){};CubeRefractionMapping=function(){};LatitudeReflectionMapping=function(){};LatitudeRefractionMapping=function(){};
SphericalReflectionMapping=function(){};SphericalRefractionMapping=function(){};UVMapping=function(){};
Scene=function(){this.objects=[];this.lights=[];this.fog=null;this.addoB=function(a){this.objects.indexOf(a)===-1&&this.objects.push(a)};this.removeoB=function(a){a=this.objects.indexOf(a);a!==-1&&this.objects.splice(a,1)};this.addLight=function(a){this.lights.indexOf(a)===-1&&this.lights.push(a)};this.removeLight=function(a){a=this.lights.indexOf(a);a!==-1&&this.lights.splice(a,1)};this.toString=function(){return"Scene ( "+this.objects+" )"}};
Fog=function(a,b,c){this.color=new Color(a);this.near=b||1;this.far=c||1E3};FogExp2=function(a,b){this.color=new Color(a);this.density=b||2.5E-4};
Projector=function(){function a(I,L){return L.z-I.z}function b(I,L){var X=0,P=1,V=I.z+I.w,W=L.z+L.w,J=-I.z+I.w,Q=-L.z+L.w;if(V>=0&&W>=0&&J>=0&&Q>=0)return true;else if(V<0&&W<0||J<0&&Q<0)return false;else{if(V<0)X=Math.max(X,V/(V-W));else if(W<0)P=Math.min(P,V/(V-W));if(J<0)X=Math.max(X,J/(J-Q));else if(Q<0)P=Math.min(P,J/(J-Q));if(P<X)return false;else{I.lerpSelf(L,X);L.lerpSelf(I,1-P);return true}}}var c,d,f=[],g,h,j,k=[],m,o,w=[],t,n,y=[],z=new Vector4,E=new Vector4,v=new m4,
B=new m4,p=[],e=new Vector4,O=new Vector4,Z;this.projectoBs=function(I,L,X){var P=[],V,W;d=0;v.multiply(L.pM,L.matrix);p[0]=new Vector4(v.n41-v.n11,v.n42-v.n12,v.n43-v.n13,v.n44-v.n14);p[1]=new Vector4(v.n41+v.n11,v.n42+v.n12,v.n43+v.n13,v.n44+v.n14);p[2]=new Vector4(v.n41+v.n21,v.n42+v.n22,v.n43+v.n23,v.n44+v.n24);p[3]=new Vector4(v.n41-v.n21,v.n42-v.n22,v.n43-v.n23,v.n44-v.n24);p[4]=new Vector4(v.n41-v.n31,v.n42-v.n32,v.n43-
v.n33,v.n44-v.n34);p[5]=new Vector4(v.n41+v.n31,v.n42+v.n32,v.n43+v.n33,v.n44+v.n34);L=0;for(V=p.length;L<V;L++){W=p[L];W.divideScalar(Math.sqrt(W.x*W.x+W.y*W.y+W.z*W.z))}V=I.objects;I=0;for(L=V.length;I<L;I++){W=V[I];var J;if(!(J=!W.vs))if(J=W instanceof Mesh){a:{for(var Q=W.ppos,fa=-W.gG.bS.radius*Math.max(W.sC.x,Math.max(W.sC.y,W.sC.z)),U=0;U<6;U++){J=p[U].x*Q.x+p[U].y*Q.y+p[U].z*Q.z+p[U].w;if(J<=fa){J=false;break a}}J=true}J=!J}if(!J){c=f[d]=f[d]||
new RenderableoB;z.cy(W.ppos);v.mV3(z);c.object=W;c.z=z.z;P.push(c);d++}}X&&P.sort(a);return P};this.projectScene=function(I,L,X){var P=[],V=L.near,W=L.far,J,Q,fa,U,ea,l,x,A,u,q,G,N,H,F,D,S;j=o=n=0;L.aum&&L.um();v.multiply(L.pM,L.matrix);l=this.projectoBs(I,L,true);I=0;for(J=l.length;I<J;I++){x=l[I].object;if(x.vs){x.aum&&x.um();A=x.matrix;u=x.rtMatrix;q=x.mTs;G=x.overdraw;if(x instanceof Mesh){N=
x.gG;H=N.vts;Q=0;for(fa=H.length;Q<fa;Q++){F=H[Q];F.pposWorld.cy(F.ppos);A.mV3(F.pposWorld);U=F.psc;U.cy(F.pposWorld);v.mV4(U);U.x/=U.w;U.y/=U.w;F.__vs=U.z>V&&U.z<W}N=N.faces;Q=0;for(fa=N.length;Q<fa;Q++){F=N[Q];if(F instanceof Face3){U=H[F.a];ea=H[F.b];D=H[F.c];if(U.__vs&&ea.__vs&&D.__vs)if(x.doubleSided||x.flipSided!=(D.psc.x-U.psc.x)*(ea.psc.y-U.psc.y)-(D.psc.y-
U.psc.y)*(ea.psc.x-U.psc.x)<0){g=k[j]=k[j]||new RenderableFace3;g.v1.pposWorld.cy(U.pposWorld);g.v2.pposWorld.cy(ea.pposWorld);g.v3.pposWorld.cy(D.pposWorld);g.v1.psc.cy(U.psc);g.v2.psc.cy(ea.psc);g.v3.psc.cy(D.psc);g.normalWorld.cy(F.normal);u.mV3(g.normalWorld);g.centroidWorld.cy(F.centroid);A.mV3(g.centroidWorld);g.centroidScreen.cy(g.centroidWorld);
v.mV3(g.centroidScreen);D=F.vns;Z=g.vnsWorld;U=0;for(ea=D.length;U<ea;U++){S=Z[U]=Z[U]||new v3;S.cy(D[U]);u.mV3(S)}g.z=g.centroidScreen.z;g.meshMts=q;g.faceMts=F.mTs;g.overdraw=G;if(x.gG.uvs[Q]){g.uvs[0]=x.gG.uvs[Q][0];g.uvs[1]=x.gG.uvs[Q][1];g.uvs[2]=x.gG.uvs[Q][2]}P.push(g);j++}}else if(F instanceof Face4){U=H[F.a];ea=H[F.b];D=H[F.c];S=H[F.d];if(U.__vs&&ea.__vs&&D.__vs&&S.__vs)if(x.doubleSided||
x.flipSided!=((S.psc.x-U.psc.x)*(ea.psc.y-U.psc.y)-(S.psc.y-U.psc.y)*(ea.psc.x-U.psc.x)<0||(ea.psc.x-D.psc.x)*(S.psc.y-D.psc.y)-(ea.psc.y-D.psc.y)*(S.psc.x-D.psc.x)<0)){g=k[j]=k[j]||new RenderableFace3;g.v1.pposWorld.cy(U.pposWorld);g.v2.pposWorld.cy(ea.pposWorld);g.v3.pposWorld.cy(S.pposWorld);
g.v1.psc.cy(U.psc);g.v2.psc.cy(ea.psc);g.v3.psc.cy(S.psc);g.normalWorld.cy(F.normal);u.mV3(g.normalWorld);g.centroidWorld.cy(F.centroid);A.mV3(g.centroidWorld);g.centroidScreen.cy(g.centroidWorld);v.mV3(g.centroidScreen);g.z=g.centroidScreen.z;g.meshMts=q;g.faceMts=F.mTs;g.overdraw=G;if(x.gG.uvs[Q]){g.uvs[0]=x.gG.uvs[Q][0];g.uvs[1]=x.gG.uvs[Q][1];g.uvs[2]=
x.gG.uvs[Q][3]}P.push(g);j++;h=k[j]=k[j]||new RenderableFace3;h.v1.pposWorld.cy(ea.pposWorld);h.v2.pposWorld.cy(D.pposWorld);h.v3.pposWorld.cy(S.pposWorld);h.v1.psc.cy(ea.psc);h.v2.psc.cy(D.psc);h.v3.psc.cy(S.psc);h.normalWorld.cy(g.normalWorld);h.centroidWorld.cy(g.centroidWorld);h.centroidScreen.cy(g.centroidScreen);h.z=h.centroidScreen.z;h.meshMts=q;h.faceMts=F.mTs;
h.overdraw=G;if(x.gG.uvs[Q]){h.uvs[0]=x.gG.uvs[Q][1];h.uvs[1]=x.gG.uvs[Q][2];h.uvs[2]=x.gG.uvs[Q][3]}P.push(h);j++}}}}else if(x instanceof Line){B.multiply(v,A);H=x.gG.vts;F=H[0];F.psc.cy(F.ppos);B.mV4(F.psc);Q=1;for(fa=H.length;Q<fa;Q++){U=H[Q];U.psc.cy(U.ppos);B.mV4(U.psc);ea=H[Q-1];e.cy(U.psc);O.cy(ea.psc);if(b(e,O)){e.ms(1/e.w);O.ms(1/
O.w);m=w[o]=w[o]||new RenderableLine;m.v1.psc.cy(e);m.v2.psc.cy(O);m.z=Math.max(e.z,O.z);m.mTs=x.mTs;P.push(m);o++}}}else if(x instanceof Particle){E.set(x.ppos.x,x.ppos.y,x.ppos.z,1);v.mV4(E);E.z/=E.w;if(E.z>0&&E.z<1){t=y[n]=y[n]||new RenderableParticle;t.x=E.x/E.w;t.y=E.y/E.w;t.z=E.z;t.rt=x.rt.z;t.sC.x=x.sC.x*Math.abs(t.x-(E.x+L.pM.n11)/(E.w+L.pM.n14));t.sC.y=x.sC.y*
Math.abs(t.y-(E.y+L.pM.n22)/(E.w+L.pM.n24));t.mTs=x.mTs;P.push(t);n++}}}}X&&P.sort(a);return P};this.unprojectVector=function(I,L){var X=m4.makeInvert(L.matrix);X.mS(m4.makeInvert(L.pM));X.mV3(I);return I}};
DOMRenderer=function(){Renderer.call(this);var a=null,b=new Projector,c,d,f,g;this.domElement=document.createElement("div");this.setSize=function(h,j){c=h;d=j;f=c/2;g=d/2};this.render=function(h,j){var k,m,o,w,t,n,y,z;a=b.projectScene(h,j);k=0;for(m=a.length;k<m;k++){t=a[k];if(t instanceof RenderableParticle){y=t.x*f+f;z=t.y*g+g;o=0;for(w=t.material.length;o<w;o++){n=t.material[o];if(n instanceof ParticleDOMMt){n=n.domElement;n.style.left=y+"px";n.style.top=z+"px"}}}}}};
CanvasRenderer=function(){function a(ga){if(t!=ga)m.globalAlpha=t=ga}function b(ga){if(n!=ga){switch(ga){case NormalBlending:m.globalCompositeOperation="source-over";break;case AdditiveBlending:m.globalCompositeOperation="lighter";break;case SubtractiveBlending:m.globalCompositeOperation="darker"}n=ga}}var c=null,d=new Projector,f=document.createElement("canvas"),g,h,j,k,m=f.getContext("2d"),o=new Color(0),w=0,t=1,n=0,y=null,z=null,E=1,v,B,p,e,O,Z,I,L,X,P=new Color,
V=new Color,W=new Color,J=new Color,Q=new Color,fa,U,ea,l,x,A,u,q,G,N=new Rectangle,H=new Rectangle,F=new Rectangle,D=false,S=new Color,ba=new Color,ha=new Color,C=new Color,M=Math.PI*2,K=new v3,R,da,$,la,ra,wa,na=16;R=document.createElement("canvas");R.width=R.height=2;da=R.getContext("2d");da.fillStyle="rgba(0,0,0,1)";da.fillRect(0,0,2,2);$=da.getImageData(0,0,2,2);la=$.data;ra=document.createElement("canvas");ra.width=
ra.height=na;wa=ra.getContext("2d");wa.translate(-na/2,-na/2);wa.sC(na,na);na--;this.domElement=f;this.sortElements=this.sortoBs=this.autoClear=true;this.setSize=function(ga,ja){g=ga;h=ja;j=g/2;k=h/2;f.width=g;f.height=h;N.set(-j,-k,j,k);t=1;n=0;z=y=null;E=1};this.setClearColor=function(ga,ja){o=ga;w=ja;H.set(-j,-k,j,k);m.setTransform(1,0,0,-1,j,k);this.clear()};this.setClearColorHex=function(ga,ja){o.setHex(ga);w=ja;H.set(-j,-k,j,k);m.setTransform(1,0,0,-1,j,k);this.clear()};this.clear=function(){m.setTransform(1,
0,0,-1,j,k);if(!H.isEmpty()){H.inflate(1);H.minSelf(N);if(o.hex==0&&w==0)m.clearRect(H.getX(),H.getY(),H.getWidth(),H.getHeight());else{b(NormalBlending);a(1);m.fillStyle="rgba("+Math.floor(o.r*255)+","+Math.floor(o.g*255)+","+Math.floor(o.b*255)+","+w+")";m.fillRect(H.getX(),H.getY(),H.getWidth(),H.getHeight())}H.empty()}};this.render=function(ga,ja){function Fa(T){var ia,ca,Y,aa=T.lights;ba.setRGB(0,0,0);ha.setRGB(0,0,0);C.setRGB(0,0,0);T=0;for(ia=aa.length;T<ia;T++){ca=aa[T];Y=ca.color;if(ca instanceof
AmbientLight){ba.r+=Y.r;ba.g+=Y.g;ba.b+=Y.b}else if(ca instanceof DirectionalLight){ha.r+=Y.r;ha.g+=Y.g;ha.b+=Y.b}else if(ca instanceof PointLight){C.r+=Y.r;C.g+=Y.g;C.b+=Y.b}}}function ta(T,ia,ca,Y){var aa,ma,ua,Aa,Ca=T.lights;T=0;for(aa=Ca.length;T<aa;T++){ma=Ca[T];ua=ma.color;Aa=ma.intensity;if(ma instanceof DirectionalLight){ma=ca.dot(ma.ppos)*Aa;if(ma>0){Y.r+=ua.r*ma;Y.g+=ua.g*ma;Y.b+=ua.b*ma}}else if(ma instanceof PointLight){K.sub(ma.ppos,ia);K.normalize();
ma=ca.dot(K)*Aa;if(ma>0){Y.r+=ua.r*ma;Y.g+=ua.g*ma;Y.b+=ua.b*ma}}}}function pa(T,ia,ca){if(ca.op!=0){a(ca.op);b(ca.blending);var Y,aa,ma,ua,Aa,Ca;if(ca instanceof ParticleBasicMt){if(ca.map&&ca.map.image.loaded){ua=ca.map.image;Aa=ua.width>>1;Ca=ua.height>>1;aa=ia.sC.x*j;ma=ia.sC.y*k;ca=aa*Aa;Y=ma*Ca;F.set(T.x-ca,T.y-Y,T.x+ca,T.y+Y);if(N.instersects(F)){m.save();m.translate(T.x,T.y);m.rotate(-ia.rt);m.sC(aa,-ma);m.translate(-Aa,-Ca);m.drawImage(ua,0,0);m.restore()}}}else if(ca instanceof
ParticleCircleMt){if(D){S.r=ba.r+ha.r+C.r;S.g=ba.g+ha.g+C.g;S.b=ba.b+ha.b+C.b;P.r=ca.color.r*S.r;P.g=ca.color.g*S.g;P.b=ca.color.b*S.b;P.updateStyleString()}else P.__styleString=ca.color.__styleString;ca=ia.sC.x*j;Y=ia.sC.y*k;F.set(T.x-ca,T.y-Y,T.x+ca,T.y+Y);if(N.instersects(F)){aa=P.__styleString;if(z!=aa)m.fillStyle=z=aa;m.save();m.translate(T.x,T.y);m.rotate(-ia.rt);m.sC(ca,Y);m.beginPath();m.arc(0,0,1,0,M,true);m.closePath();m.fill();m.restore()}}}}function sa(T,ia,
ca,Y){if(Y.op!=0){a(Y.op);b(Y.blending);m.beginPath();m.moveTo(T.psc.x,T.psc.y);m.lineTo(ia.psc.x,ia.psc.y);m.closePath();if(Y instanceof LineBasicMt){P.__styleString=Y.color.__styleString;T=Y.lw;if(E!=T)m.lineWidth=E=T;T=P.__styleString;if(y!=T)m.strokeStyle=y=T;m.stroke();F.inflate(Y.lw*2)}}}function Ma(T,ia,ca,Y,aa,ma){if(aa.op!=0){a(aa.op);b(aa.blending);e=T.psc.x;O=T.psc.y;Z=ia.psc.x;
I=ia.psc.y;L=ca.psc.x;X=ca.psc.y;m.beginPath();m.moveTo(e,O);m.lineTo(Z,I);m.lineTo(L,X);m.lineTo(e,O);m.closePath();if(aa instanceof mBm)if(aa.map)aa.map.image.loaded&&aa.map.mapping instanceof UVMapping&&ka(e,O,Z,I,L,X,aa.map.image,Y.uvs[0].u,Y.uvs[0].v,Y.uvs[1].u,Y.uvs[1].v,Y.uvs[2].u,Y.uvs[2].v);else if(aa.env_map){if(aa.env_map.image.loaded)if(aa.env_map.mapping instanceof SphericalReflectionMapping){T=ja.matrix;K.cy(Y.vnsWorld[0]);
l=(K.x*T.n11+K.y*T.n12+K.z*T.n13)*0.5+0.5;x=-(K.x*T.n21+K.y*T.n22+K.z*T.n23)*0.5+0.5;K.cy(Y.vnsWorld[1]);A=(K.x*T.n11+K.y*T.n12+K.z*T.n13)*0.5+0.5;u=-(K.x*T.n21+K.y*T.n22+K.z*T.n23)*0.5+0.5;K.cy(Y.vnsWorld[2]);q=(K.x*T.n11+K.y*T.n12+K.z*T.n13)*0.5+0.5;G=-(K.x*T.n21+K.y*T.n22+K.z*T.n23)*0.5+0.5;ka(e,O,Z,I,L,X,aa.env_map.image,l,x,A,u,q,G)}}else aa.wf?Ga(aa.color.__styleString,aa.wf_lw):za(aa.color.__styleString);else if(aa instanceof mLm){if(aa.map&&
!aa.wf){aa.map.mapping instanceof UVMapping&&ka(e,O,Z,I,L,X,aa.map.image,Y.uvs[0].u,Y.uvs[0].v,Y.uvs[1].u,Y.uvs[1].v,Y.uvs[2].u,Y.uvs[2].v);b(SubtractiveBlending)}if(D)if(!aa.wf&&aa.shading==SmoothShading&&Y.vnsWorld.length==3){V.r=W.r=J.r=ba.r;V.g=W.g=J.g=ba.g;V.b=W.b=J.b=ba.b;ta(ma,Y.v1.pposWorld,Y.vnsWorld[0],V);ta(ma,Y.v2.pposWorld,Y.vnsWorld[1],W);ta(ma,Y.v3.pposWorld,Y.vnsWorld[2],J);Q.r=(W.r+J.r)*0.5;Q.g=(W.g+
J.g)*0.5;Q.b=(W.b+J.b)*0.5;ea=qa(V,W,J,Q);ka(e,O,Z,I,L,X,ea,0,0,1,0,0,1)}else{S.r=ba.r;S.g=ba.g;S.b=ba.b;ta(ma,Y.centroidWorld,Y.normalWorld,S);P.r=aa.color.r*S.r;P.g=aa.color.g*S.g;P.b=aa.color.b*S.b;P.updateStyleString();aa.wf?Ga(P.__styleString,aa.wf_lw):za(P.__styleString)}else aa.wf?Ga(aa.color.__styleString,aa.wf_lw):za(aa.color.__styleString)}else if(aa instanceof MeshDepthMt){fa=ja.near;U=ja.far;V.r=V.g=V.b=1-Da(T.psc.z,fa,U);
W.r=W.g=W.b=1-Da(ia.psc.z,fa,U);J.r=J.g=J.b=1-Da(ca.psc.z,fa,U);Q.r=(W.r+J.r)*0.5;Q.g=(W.g+J.g)*0.5;Q.b=(W.b+J.b)*0.5;ea=qa(V,W,J,Q);ka(e,O,Z,I,L,X,ea,0,0,1,0,0,1)}else if(aa instanceof MeshNormalMt){P.r=xa(Y.normalWorld.x);P.g=xa(Y.normalWorld.y);P.b=xa(Y.normalWorld.z);P.updateStyleString();aa.wf?Ga(P.__styleString,aa.wf_lw):za(P.__styleString)}}}function Ga(T,ia){if(y!=T)m.strokeStyle=y=T;if(E!=ia)m.lineWidth=E=ia;m.stroke();F.inflate(ia*2)}
function za(T){if(z!=T)m.fillStyle=z=T;m.fill()}function ka(T,ia,ca,Y,aa,ma,ua,Aa,Ca,Ja,Ea,Ka,Ra){var Ha,La;Ha=ua.width-1;La=ua.height-1;Aa*=Ha;Ca*=La;Ja*=Ha;Ea*=La;Ka*=Ha;Ra*=La;ca-=T;Y-=ia;aa-=T;ma-=ia;Ja-=Aa;Ea-=Ca;Ka-=Aa;Ra-=Ca;Ha=Ja*Ra-Ka*Ea;if(Ha!=0){La=1/Ha;Ha=(Ra*ca-Ea*aa)*La;Ea=(Ra*Y-Ea*ma)*La;ca=(Ja*aa-Ka*ca)*La;Y=(Ja*ma-Ka*Y)*La;T=T-Ha*Aa-ca*Ca;ia=ia-Ea*Aa-Y*Ca;m.save();m.transform(Ha,Ea,ca,Y,T,ia);m.clip();m.drawImage(ua,0,0);m.restore()}}function qa(T,ia,ca,Y){var aa=~~(T.r*255),ma=~~(T.g*
255);T=~~(T.b*255);var ua=~~(ia.r*255),Aa=~~(ia.g*255);ia=~~(ia.b*255);var Ca=~~(ca.r*255),Ja=~~(ca.g*255);ca=~~(ca.b*255);var Ea=~~(Y.r*255),Ka=~~(Y.g*255);Y=~~(Y.b*255);la[0]=aa<0?0:aa>255?255:aa;la[1]=ma<0?0:ma>255?255:ma;la[2]=T<0?0:T>255?255:T;la[4]=ua<0?0:ua>255?255:ua;la[5]=Aa<0?0:Aa>255?255:Aa;la[6]=ia<0?0:ia>255?255:ia;la[8]=Ca<0?0:Ca>255?255:Ca;la[9]=Ja<0?0:Ja>255?255:Ja;la[10]=ca<0?0:ca>255?255:ca;la[12]=Ea<0?0:Ea>255?255:Ea;la[13]=Ka<0?0:Ka>255?255:Ka;la[14]=Y<0?0:Y>255?255:Y;da.putImageData($,
0,0);wa.drawImage(R,0,0);return ra}function Da(T,ia,ca){T=(T-ia)/(ca-ia);return T*T*(3-2*T)}function xa(T){T=(T+1)*0.5;return T<0?0:T>1?1:T}function Oa(T,ia){var ca=ia.x-T.x,Y=ia.y-T.y,aa=1/Math.sqrt(ca*ca+Y*Y);ca*=aa;Y*=aa;ia.x+=ca;ia.y+=Y;T.x-=ca;T.y-=Y}var ya,Pa,oa,Ba,Ia,Na,Qa,va;this.autoClear?this.clear():m.setTransform(1,0,0,-1,j,k);c=d.projectScene(ga,ja,this.sortElements);(D=ga.lights.length>0)&&Fa(ga);ya=0;for(Pa=c.length;ya<Pa;ya++){oa=c[ya];F.empty();if(oa instanceof RenderableParticle){v=
oa;v.x*=j;v.y*=k;Ba=0;for(Ia=oa.mTs.length;Ba<Ia;Ba++)pa(v,oa,oa.mTs[Ba],ga)}else if(oa instanceof RenderableLine){v=oa.v1;B=oa.v2;v.psc.x*=j;v.psc.y*=k;B.psc.x*=j;B.psc.y*=k;F.addPoint(v.psc.x,v.psc.y);F.addPoint(B.psc.x,B.psc.y);if(N.instersects(F)){Ba=0;for(Ia=oa.mTs.length;Ba<Ia;)sa(v,B,oa,oa.mTs[Ba++],ga)}}else if(oa instanceof RenderableFace3){v=oa.v1;B=oa.v2;p=oa.v3;v.psc.x*=
j;v.psc.y*=k;B.psc.x*=j;B.psc.y*=k;p.psc.x*=j;p.psc.y*=k;if(oa.overdraw){Oa(v.psc,B.psc);Oa(B.psc,p.psc);Oa(p.psc,v.psc)}F.add3Points(v.psc.x,v.psc.y,B.psc.x,B.psc.y,p.psc.x,p.psc.y);if(N.instersects(F)){Ba=0;for(Ia=oa.meshMts.length;Ba<Ia;){va=oa.meshMts[Ba++];if(va instanceof MeshFaceMt){Na=
0;for(Qa=oa.faceMts.length;Na<Qa;)(va=oa.faceMts[Na++])&&Ma(v,B,p,oa,va,ga)}else Ma(v,B,p,oa,va,ga)}}}H.addRectangle(F)}m.setTransform(1,0,0,1,0,0)}};
SVGRenderer=function(){function a(l,x,A){var u,q,G,N;u=0;for(q=l.lights.length;u<q;u++){G=l.lights[u];if(G instanceof DirectionalLight){N=x.normalWorld.dot(G.ppos)*G.intensity;if(N>0){A.r+=G.color.r*N;A.g+=G.color.g*N;A.b+=G.color.b*N}}else if(G instanceof PointLight){X.sub(G.ppos,x.centroidWorld);X.normalize();N=x.normalWorld.dot(X)*G.intensity;if(N>0){A.r+=G.color.r*N;A.g+=G.color.g*N;A.b+=G.color.b*N}}}}function b(l,x,A,u,q,G){J=d(Q++);J.setAttribute("d","M "+l.psc.x+
" "+l.psc.y+" L "+x.psc.x+" "+x.psc.y+" L "+A.psc.x+","+A.psc.y+"z");if(q instanceof mBm)p.__styleString=q.color.__styleString;else if(q instanceof mLm)if(B){e.r=O.r;e.g=O.g;e.b=O.b;a(G,u,e);p.r=q.color.r*e.r;p.g=q.color.g*e.g;p.b=q.color.b*e.b;p.updateStyleString()}else p.__styleString=q.color.__styleString;else if(q instanceof MeshDepthMt){L=1-q.__2near/(q.__farPlusNear-u.z*q.__farMinusNear);
p.setRGB(L,L,L)}else q instanceof MeshNormalMt&&p.setRGB(f(u.normalWorld.x),f(u.normalWorld.y),f(u.normalWorld.z));q.wf?J.setAttribute("style","fill: none; stroke: "+p.__styleString+"; stroke-width: "+q.wf_lw+"; stroke-op: "+q.op+"; stroke-linecap: "+q.wf_linecap+"; stroke-linejoin: "+q.wf_linejoin):J.setAttribute("style","fill: "+p.__styleString+"; fill-op: "+q.op);j.appendChild(J)}function c(l,x,A,u,q,G,N){J=d(Q++);J.setAttribute("d",
"M "+l.psc.x+" "+l.psc.y+" L "+x.psc.x+" "+x.psc.y+" L "+A.psc.x+","+A.psc.y+" L "+u.psc.x+","+u.psc.y+"z");if(G instanceof mBm)p.__styleString=G.color.__styleString;else if(G instanceof mLm)if(B){e.r=O.r;e.g=O.g;e.b=O.b;a(N,q,e);p.r=G.color.r*e.r;p.g=G.color.g*e.g;p.b=G.color.b*e.b;p.updateStyleString()}else p.__styleString=G.color.__styleString;else if(G instanceof MeshDepthMt){L=
1-G.__2near/(G.__farPlusNear-q.z*G.__farMinusNear);p.setRGB(L,L,L)}else G instanceof MeshNormalMt&&p.setRGB(f(q.normalWorld.x),f(q.normalWorld.y),f(q.normalWorld.z));G.wf?J.setAttribute("style","fill: none; stroke: "+p.__styleString+"; stroke-width: "+G.wf_lw+"; stroke-op: "+G.op+"; stroke-linecap: "+G.wf_linecap+"; stroke-linejoin: "+G.wf_linejoin):J.setAttribute("style","fill: "+p.__styleString+"; fill-op: "+G.op);j.appendChild(J)}
function d(l){if(P[l]==null){P[l]=document.createElementNS("http://www.w3.org/2000/svg","path");ea==0&&P[l].setAttribute("shape-rendering","crispEdges");return P[l]}return P[l]}function f(l){return l<0?Math.min((1+l)*0.5,0.5):0.5+Math.min(l*0.5,0.5)}var g=null,h=new Projector,j=document.createElementNS("http://www.w3.org/2000/svg","svg"),k,m,o,w,t,n,y,z,E=new Rectangle,v=new Rectangle,B=false,p=new Color(16777215),e=new Color(16777215),O=new Color(0),Z=new Color(0),
I=new Color(0),L,X=new v3,P=[],V=[],W=[],J,Q,fa,U,ea=1;this.domElement=j;this.sortElements=this.sortoBs=this.autoClear=true;this.setQuality=function(l){switch(l){case "high":ea=1;break;case "low":ea=0}};this.setSize=function(l,x){k=l;m=x;o=k/2;w=m/2;j.setAttribute("viewBox",-o+" "+-w+" "+k+" "+m);j.setAttribute("width",k);j.setAttribute("height",m);E.set(-o,-w,o,w)};this.clear=function(){for(;j.childNodes.length>0;)j.removeChild(j.childNodes[0])};this.render=function(l,x){var A,
u,q,G,N,H,F,D;this.autoClear&&this.clear();g=h.projectScene(l,x,this.sortElements);U=fa=Q=0;if(B=l.lights.length>0){F=l.lights;O.setRGB(0,0,0);Z.setRGB(0,0,0);I.setRGB(0,0,0);A=0;for(u=F.length;A<u;A++){q=F[A];G=q.color;if(q instanceof AmbientLight){O.r+=G.r;O.g+=G.g;O.b+=G.b}else if(q instanceof DirectionalLight){Z.r+=G.r;Z.g+=G.g;Z.b+=G.b}else if(q instanceof PointLight){I.r+=G.r;I.g+=G.g;I.b+=G.b}}}A=0;for(u=g.length;A<u;A++){F=g[A];v.empty();if(F instanceof RenderableParticle){t=
F;t.x*=o;t.y*=-w;q=0;for(G=F.mTs.length;q<G;q++)if(D=F.mTs[q]){N=t;H=F;var S=fa++;if(V[S]==null){V[S]=document.createElementNS("http://www.w3.org/2000/svg","circle");ea==0&&V[S].setAttribute("shape-rendering","crispEdges")}J=V[S];J.setAttribute("cx",N.x);J.setAttribute("cy",N.y);J.setAttribute("r",H.sC.x*o);if(D instanceof ParticleCircleMt){if(B){e.r=O.r+Z.r+I.r;e.g=O.g+Z.g+I.g;e.b=O.b+Z.b+I.b;p.r=D.color.r*e.r;p.g=D.color.g*e.g;p.b=D.color.b*e.b;p.updateStyleString()}else p=
D.color;J.setAttribute("style","fill: "+p.__styleString)}j.appendChild(J)}}else if(F instanceof RenderableLine){t=F.v1;n=F.v2;t.psc.x*=o;t.psc.y*=-w;n.psc.x*=o;n.psc.y*=-w;v.addPoint(t.psc.x,t.psc.y);v.addPoint(n.psc.x,n.psc.y);if(E.instersects(v)){q=0;for(G=F.mTs.length;q<G;)if(D=F.mTs[q++]){N=t;H=n;S=U++;if(W[S]==null){W[S]=document.createElementNS("http://www.w3.org/2000/svg","line");ea==0&&
W[S].setAttribute("shape-rendering","crispEdges")}J=W[S];J.setAttribute("x1",N.psc.x);J.setAttribute("y1",N.psc.y);J.setAttribute("x2",H.psc.x);J.setAttribute("y2",H.psc.y);if(D instanceof LineBasicMt){p.__styleString=D.color.__styleString;J.setAttribute("style","fill: none; stroke: "+p.__styleString+"; stroke-width: "+D.lw+"; stroke-op: "+D.op+"; stroke-linecap: "+D.linecap+"; stroke-linejoin: "+D.linejoin);j.appendChild(J)}}}}else if(F instanceof
RenderableFace3){t=F.v1;n=F.v2;y=F.v3;t.psc.x*=o;t.psc.y*=-w;n.psc.x*=o;n.psc.y*=-w;y.psc.x*=o;y.psc.y*=-w;v.addPoint(t.psc.x,t.psc.y);v.addPoint(n.psc.x,n.psc.y);v.addPoint(y.psc.x,y.psc.y);if(E.instersects(v)){q=0;for(G=F.meshMts.length;q<G;){D=F.meshMts[q++];if(D instanceof MeshFaceMt){N=0;for(H=F.faceMts.length;N<H;)(D=F.faceMts[N++])&&
b(t,n,y,F,D,l)}else D&&b(t,n,y,F,D,l)}}}else if(F instanceof RenderableFace4){t=F.v1;n=F.v2;y=F.v3;z=F.v4;t.psc.x*=o;t.psc.y*=-w;n.psc.x*=o;n.psc.y*=-w;y.psc.x*=o;y.psc.y*=-w;z.psc.x*=o;z.psc.y*=-w;v.addPoint(t.psc.x,t.psc.y);v.addPoint(n.psc.x,n.psc.y);v.addPoint(y.psc.x,y.psc.y);v.addPoint(z.psc.x,z.psc.y);if(E.instersects(v)){q=
0;for(G=F.meshMts.length;q<G;){D=F.meshMts[q++];if(D instanceof MeshFaceMt){N=0;for(H=F.faceMts.length;N<H;)(D=F.faceMts[N++])&&c(t,n,y,z,F,D,l)}else D&&c(t,n,y,z,F,D,l)}}}}}};
WebGLRenderer=function(a){function b(l,x,A){var u,q,G,N=l.vts,H=N.length,F=l.colors,D=F.length,S=l.__vertexArray,ba=l.__colorArray,ha=l.__sortArray,C=l.__dirtyVertices,M=l.__dirtyColors;if(A.sortParticles){V.mS(A.matrixWorld);for(u=0;u<H;u++){q=N[u].ppos;Q.cy(q);V.mV3(Q);ha[u]=[Q.z,u]}ha.sort(function(K,R){return R[0]-K[0]});for(u=0;u<H;u++){q=N[ha[u][1]].ppos;G=u*3;S[G]=q.x;S[G+1]=q.y;S[G+2]=q.z}for(u=0;u<D;u++){G=u*3;color=F[ha[u][1]];ba[G]=color.r;ba[G+
1]=color.g;ba[G+2]=color.b}}else{if(C)for(u=0;u<H;u++){q=N[u].ppos;G=u*3;S[G]=q.x;S[G+1]=q.y;S[G+2]=q.z}if(M)for(u=0;u<D;u++){color=F[u];G=u*3;ba[G]=color.r;ba[G+1]=color.g;ba[G+2]=color.b}}if(C||A.sortParticles){e.bindBuffer(e.ARRAY_BUFFER,l.__webGLVertexBuffer);e.bufferData(e.ARRAY_BUFFER,S,x)}if(M||A.sortParticles){e.bindBuffer(e.ARRAY_BUFFER,l.__webGLColorBuffer);e.bufferData(e.ARRAY_BUFFER,ba,x)}}function c(l,x){l.fragment_shader=x.fragment_shader;l.vertex_shader=x.vertex_shader;l.uniforms=
Uniforms.clone(x.uniforms)}function d(l,x){if(!l.__webGLVertexBuffer)l.__webGLVertexBuffer=e.createBuffer();if(!l.__webGLNormalBuffer)l.__webGLNormalBuffer=e.createBuffer();if(l.hasPos){e.bindBuffer(e.ARRAY_BUFFER,l.__webGLVertexBuffer);e.bufferData(e.ARRAY_BUFFER,l.pposArray,e.DYNAMIC_DRAW);e.enableVertexAttribArray(x.attributes.ppos);e.vertexAttribPointer(x.attributes.ppos,3,e.FLOAT,false,0,0)}if(l.hasNormal){e.bindBuffer(e.ARRAY_BUFFER,l.__webGLNormalBuffer);e.bufferData(e.ARRAY_BUFFER,
l.normalArray,e.DYNAMIC_DRAW);e.enableVertexAttribArray(x.attributes.normal);e.vertexAttribPointer(x.attributes.normal,3,e.FLOAT,false,0,0)}e.drawArrays(e.TRIANGLES,0,l.count);l.count=0}function f(l){if(I!=l.doubleSided){l.doubleSided?e.disable(e.CULL_FACE):e.enable(e.CULL_FACE);I=l.doubleSided}if(L!=l.flipSided){l.flipSided?e.frontFace(e.CW):e.frontFace(e.CCW);L=l.flipSided}}function g(l){P[0].set(l.n41-l.n11,l.n42-l.n12,l.n43-l.n13,l.n44-l.n14);P[1].set(l.n41+l.n11,l.n42+l.n12,l.n43+l.n13,l.n44+
l.n14);P[2].set(l.n41+l.n21,l.n42+l.n22,l.n43+l.n23,l.n44+l.n24);P[3].set(l.n41-l.n21,l.n42-l.n22,l.n43-l.n23,l.n44-l.n24);P[4].set(l.n41-l.n31,l.n42-l.n32,l.n43-l.n33,l.n44-l.n34);P[5].set(l.n41+l.n31,l.n42+l.n32,l.n43+l.n33,l.n44+l.n34);var x;for(l=0;l<5;l++){x=P[l];x.divideScalar(Math.sqrt(x.x*x.x+x.y*x.y+x.z*x.z))}}function h(l){for(var x=l.matrix,A=-l.gG.bS.radius*Math.max(l.sC.x,Math.max(l.sC.y,l.sC.z)),u=0;u<6;u++){l=P[u].x*x.n14+P[u].y*x.n24+P[u].z*x.n34+P[u].w;
if(l<=A)return false}return true}function j(l,x){l.list[l.count]=x;l.count+=1}function k(l){var x,A,u=l.object,q=l.opaque,G=l.transparent;G.count=0;l=q.count=0;for(x=u.mTs.length;l<x;l++){A=u.mTs[l];A.op&&A.op<1||A.blending!=NormalBlending?j(G,A):j(q,A)}}function m(l){var x,A,u,q,G=l.object,N=l.buffer,H=l.opaque,F=l.transparent;F.count=0;l=H.count=0;for(u=G.mTs.length;l<u;l++){x=G.mTs[l];if(x instanceof MeshFaceMt){x=0;for(A=N.mTs.length;x<
A;x++)if(q=N.mTs[x])q.op&&q.op<1||q.blending!=NormalBlending?j(F,q):j(H,q)}else{q=x;q.op&&q.op<1||q.blending!=NormalBlending?j(F,q):j(H,q)}}}function o(l){var x,A,u,q=l.children;x=0;for(A=q.length;x<A;x++){u=q[x];u.aum&&u.um();u.matrixWorld.multiply(l.matrixWorld,u.matrix);o(u)}}function w(l,x){var A,u,q=x.children;A=0;for(u=q.length;A<u;A++){child=q[A];t(l,child,false);w(l,child)}}function t(l,x,A){var u,q,G;q=x.gG;if(l.__webGLoBsMap[x.id]==
undefined){l.__webGLoBsMap[x.id]={};x._modelViewMatrix=new m4;x._normalMatrixArray=new Float32Array(9);x._modelViewMatrixArray=new Float32Array(16);x._objectMatrixArray=new Float32Array(16);x.matrix.flattenToArray(x._objectMatrixArray)}G=l.__webGLoBsMap[x.id];objlist=l.__webGLoBs;if(x instanceof Mesh){for(u in q.gGChunks){l=q.gGChunks[u];if(!l.__webGLVertexBuffer){var N=l;N.__webGLVertexBuffer=e.createBuffer();N.__webGLNormalBuffer=e.createBuffer();N.__webGLTangentBuffer=
e.createBuffer();N.__webGLColorBuffer=e.createBuffer();N.__webGLUVBuffer=e.createBuffer();N.__webGLUV2Buffer=e.createBuffer();N.__webGLFaceBuffer=e.createBuffer();N.__webGLLineBuffer=e.createBuffer();N=l;var H=x,F=void 0,D=void 0,S=0,ba=0,ha=0,C=H.gG.faces,M=N.faces;F=0;for(D=M.length;F<D;F++){fi=M[F];face=C[fi];if(face instanceof Face3){S+=3;ba+=1;ha+=3}else if(face instanceof Face4){S+=4;ba+=2;ha+=4}}N.__vertexArray=new Float32Array(S*3);N.__normalArray=new Float32Array(S*3);N.__tangentArray=
new Float32Array(S*4);N.__colorArray=new Float32Array(S*3);N.__uvArray=new Float32Array(S*2);N.__uv2Array=new Float32Array(S*2);N.__faceArray=new Uint16Array(ba*3);N.__lineArray=new Uint16Array(ha*2);D=F=N;var K=void 0,R=void 0;M=false;S=0;for(C=H.mTs.length;S<C;S++){K=H.mTs[S];if(K instanceof MeshFaceMt){K=0;for(R=D.mTs.length;K<R;K++)if(D.mTs[K]&&D.mTs[K].shading!=undefined&&D.mTs[K].shading==SmoothShading){M=true;break}}else if(K&&K.shading!=
undefined&&K.shading==SmoothShading){M=true;break}if(M)break}F.__needsSmoothNormals=M;N.__webGLFaceCount=ba*3;N.__webGLLineCount=ha*2;q.__dirtyVertices=true;q.__dirtyElements=true;q.__dirtyUvs=true;q.__dirtyNormals=true;q.__dirtyTangents=true;q.__dirtyColors=true}if(q.__dirtyVertices||q.__dirtyElements||q.__dirtyUvs||q.__dirtyNormals||q.__dirtyColors||q.__dirtyTangents){N=l;ba=e.DYNAMIC_DRAW;var da=void 0,$=void 0,la=void 0,ra=void 0,wa=void 0,na=void 0,ga=void 0,ja=void 0,Fa=void 0,ta=R=K=
M=C=S=H=D=0,pa=0,sa=N.__vertexArray,Ma=N.__uvArray,Ga=N.__uv2Array,za=N.__normalArray,ka=N.__tangentArray,qa=N.__colorArray,Da=N.__faceArray,xa=N.__lineArray,Oa=N.__needsSmoothNormals,ya=x.gG,Pa=ya.__dirtyVertices,oa=ya.__dirtyElements,Ba=ya.__dirtyUvs,Ia=ya.__dirtyNormals,Na=ya.__dirtyTangents,Qa=ya.__dirtyColors,va=ya.vts,T=N.faces,ia=ya.faces,ca=ya.uvs,Y=ya.uvs2,aa=ya.colors;ha=0;for(F=T.length;ha<F;ha++){da=T[ha];$=ia[da];wa=ca[da];da=Y[da];la=$.vns;ra=$.normal;if($ instanceof
Face3){if(Pa){na=va[$.a].ppos;ga=va[$.b].ppos;ja=va[$.c].ppos;sa[H]=na.x;sa[H+1]=na.y;sa[H+2]=na.z;sa[H+3]=ga.x;sa[H+4]=ga.y;sa[H+5]=ga.z;sa[H+6]=ja.x;sa[H+7]=ja.y;sa[H+8]=ja.z;H+=9}if(Qa&&aa.length){na=aa[$.a];ga=aa[$.b];ja=aa[$.c];qa[pa]=na.r;qa[pa+1]=na.g;qa[pa+2]=na.b;qa[pa+3]=ga.r;qa[pa+4]=ga.g;qa[pa+5]=ga.b;qa[pa+6]=ja.r;qa[pa+7]=ja.g;qa[pa+8]=ja.b;pa+=9}if(Na&&ya.hasTangents){na=va[$.a].tangent;ga=va[$.b].tangent;ja=va[$.c].tangent;ka[R]=na.x;ka[R+1]=na.y;ka[R+2]=na.z;ka[R+
3]=na.w;ka[R+4]=ga.x;ka[R+5]=ga.y;ka[R+6]=ga.z;ka[R+7]=ga.w;ka[R+8]=ja.x;ka[R+9]=ja.y;ka[R+10]=ja.z;ka[R+11]=ja.w;R+=12}if(Ia)if(la.length==3&&Oa)for($=0;$<3;$++){ra=la[$];za[K]=ra.x;za[K+1]=ra.y;za[K+2]=ra.z;K+=3}else for($=0;$<3;$++){za[K]=ra.x;za[K+1]=ra.y;za[K+2]=ra.z;K+=3}if(Ba&&wa)for($=0;$<3;$++){la=wa[$];Ma[S]=la.u;Ma[S+1]=la.v;S+=2}if(Ba&&da)for($=0;$<3;$++){wa=da[$];Ga[C]=wa.u;Ga[C+1]=wa.v;C+=2}if(oa){Da[M]=D;Da[M+1]=D+1;Da[M+2]=D+2;M+=3;xa[ta]=D;xa[ta+1]=D+1;xa[ta+2]=D;xa[ta+3]=D+2;xa[ta+
4]=D+1;xa[ta+5]=D+2;ta+=6;D+=3}}else if($ instanceof Face4){if(Pa){na=va[$.a].ppos;ga=va[$.b].ppos;ja=va[$.c].ppos;Fa=va[$.d].ppos;sa[H]=na.x;sa[H+1]=na.y;sa[H+2]=na.z;sa[H+3]=ga.x;sa[H+4]=ga.y;sa[H+5]=ga.z;sa[H+6]=ja.x;sa[H+7]=ja.y;sa[H+8]=ja.z;sa[H+9]=Fa.x;sa[H+10]=Fa.y;sa[H+11]=Fa.z;H+=12}if(Qa&&aa.length){na=aa[$.a];ga=aa[$.b];ja=aa[$.c];Fa=aa[$.d];qa[pa]=na.r;qa[pa+1]=na.g;qa[pa+2]=na.b;qa[pa+3]=ga.r;qa[pa+4]=ga.g;qa[pa+5]=ga.b;qa[pa+6]=ja.r;qa[pa+7]=ja.g;qa[pa+8]=ja.b;
qa[pa+9]=Fa.r;qa[pa+10]=Fa.g;qa[pa+11]=Fa.b;pa+=12}if(Na&&ya.hasTangents){na=va[$.a].tangent;ga=va[$.b].tangent;ja=va[$.c].tangent;$=va[$.d].tangent;ka[R]=na.x;ka[R+1]=na.y;ka[R+2]=na.z;ka[R+3]=na.w;ka[R+4]=ga.x;ka[R+5]=ga.y;ka[R+6]=ga.z;ka[R+7]=ga.w;ka[R+8]=ja.x;ka[R+9]=ja.y;ka[R+10]=ja.z;ka[R+11]=ja.w;ka[R+12]=$.x;ka[R+13]=$.y;ka[R+14]=$.z;ka[R+15]=$.w;R+=16}if(Ia)if(la.length==4&&Oa)for($=0;$<4;$++){ra=la[$];za[K]=ra.x;za[K+1]=ra.y;za[K+2]=ra.z;K+=3}else for($=0;$<4;$++){za[K]=ra.x;za[K+1]=ra.y;
za[K+2]=ra.z;K+=3}if(Ba&&wa)for($=0;$<4;$++){la=wa[$];Ma[S]=la.u;Ma[S+1]=la.v;S+=2}if(Ba&&da)for($=0;$<4;$++){wa=da[$];Ga[C]=wa.u;Ga[C+1]=wa.v;C+=2}if(oa){Da[M]=D;Da[M+1]=D+1;Da[M+2]=D+2;Da[M+3]=D;Da[M+4]=D+2;Da[M+5]=D+3;M+=6;xa[ta]=D;xa[ta+1]=D+1;xa[ta+2]=D;xa[ta+3]=D+3;xa[ta+4]=D+1;xa[ta+5]=D+2;xa[ta+6]=D+2;xa[ta+7]=D+3;ta+=8;D+=4}}}if(Pa){e.bindBuffer(e.ARRAY_BUFFER,N.__webGLVertexBuffer);e.bufferData(e.ARRAY_BUFFER,sa,ba)}if(Qa&&aa.length){e.bindBuffer(e.ARRAY_BUFFER,N.__webGLColorBuffer);e.bufferData(e.ARRAY_BUFFER,
qa,ba)}if(Ia){e.bindBuffer(e.ARRAY_BUFFER,N.__webGLNormalBuffer);e.bufferData(e.ARRAY_BUFFER,za,ba)}if(Na&&ya.hasTangents){e.bindBuffer(e.ARRAY_BUFFER,N.__webGLTangentBuffer);e.bufferData(e.ARRAY_BUFFER,ka,ba)}if(Ba&&S>0){e.bindBuffer(e.ARRAY_BUFFER,N.__webGLUVBuffer);e.bufferData(e.ARRAY_BUFFER,Ma,ba)}if(Ba&&C>0){e.bindBuffer(e.ARRAY_BUFFER,N.__webGLUV2Buffer);e.bufferData(e.ARRAY_BUFFER,Ga,ba)}if(oa){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,N.__webGLFaceBuffer);e.bufferData(e.ELEMENT_ARRAY_BUFFER,Da,
ba);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,N.__webGLLineBuffer);e.bufferData(e.ELEMENT_ARRAY_BUFFER,xa,ba)}}n(objlist,G,u,l,x,A)}q.__dirtyVertices=false;q.__dirtyElements=false;q.__dirtyUvs=false;q.__dirtyNormals=false;q.__dirtyTangents=false;q.__dirtyColors=false}else if(x instanceof Line){if(!q.__webGLVertexBuffer){q.__webGLVertexBuffer=e.createBuffer();q.__webGLColorBuffer=e.createBuffer();u=q.vts.length;q.__vertexArray=new Float32Array(u*3);q.__colorArray=new Float32Array(u*3);q.__webGLLineCount=
u;q.__dirtyVertices=true;q.__dirtyColors=true}if(q.__dirtyVertices||q.__dirtyColors){u=e.DYNAMIC_DRAW;H=q.vts;N=q.colors;S=H.length;ba=N.length;C=q.__vertexArray;ha=q.__colorArray;M=q.__dirtyColors;if(q.__dirtyVertices){for(F=0;F<S;F++){D=H[F].ppos;l=F*3;C[l]=D.x;C[l+1]=D.y;C[l+2]=D.z}e.bindBuffer(e.ARRAY_BUFFER,q.__webGLVertexBuffer);e.bufferData(e.ARRAY_BUFFER,C,u)}if(M){for(F=0;F<ba;F++){color=N[F];l=F*3;ha[l]=color.r;ha[l+1]=color.g;ha[l+2]=color.b}e.bindBuffer(e.ARRAY_BUFFER,q.__webGLColorBuffer);
e.bufferData(e.ARRAY_BUFFER,ha,u)}}n(objlist,G,0,q,x,A);q.__dirtyVertices=false;q.__dirtyColors=false}else if(x instanceof ParticleSystem){if(!q.__webGLVertexBuffer){q.__webGLVertexBuffer=e.createBuffer();q.__webGLColorBuffer=e.createBuffer();u=q.vts.length;q.__vertexArray=new Float32Array(u*3);q.__colorArray=new Float32Array(u*3);q.__sortArray=[];q.__webGLParticleCount=u;q.__dirtyVertices=true;q.__dirtyColors=true}if(q.__dirtyVertices||q.__dirtyColors||x.sortParticles)b(q,e.DYNAMIC_DRAW,
x,CC);n(objlist,G,0,q,x,A);q.__dirtyVertices=false;q.__dirtyColors=false}else if(x instanceof MarchingCubes)if(G[0]==undefined){l.__webGLoBsImmediate.push({object:x,opaque:{list:[],count:0},transparent:{list:[],count:0},root:A});G[0]=1}}function n(l,x,A,u,q,G){if(x[A]==undefined){l.push({buffer:u,object:q,opaque:{list:[],count:0},transparent:{list:[],count:0},root:G});x[A]=1}}function y(l,x){l._modelViewMatrix.multiplyToArray(x.matrix,l.matrixWorld,l._modelViewMatrixArray);l._normalMatrix=
m4.makeInvert3x3(l._modelViewMatrix).transposeIntoArray(l._normalMatrixArray)}function z(l){if(l!=X){switch(l){case AdditiveBlending:e.blendEquation(e.FUNC_ADD);e.blendFunc(e.ONE,e.ONE);break;case SubtractiveBlending:e.blendFunc(e.DST_COLOR,e.ZERO);break;case BillboardBlending:e.blendEquation(e.FUNC_ADD);e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);break;default:e.blendEquation(e.FUNC_ADD);e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)}X=l}}function E(l,x){if(l&&!l.__webGLFramebuffer){l.__webGLFramebuffer=
e.CrFramebuffer();l.__webGLRenderbuffer=e.CrRenderbuffer();l.__webGLTexture=e.createTexture();e.bindRenderbuffer(e.RENDERBUFFER,l.__webGLRenderbuffer);e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,l.width,l.height);e.bindTexture(e.TEXTURE_2D,l.__webGLTexture);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,B(l.wrap_s));e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,B(l.wrap_t));e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,B(l.mag_filter));e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,
B(l.min_filter));e.texImage2D(e.TEXTURE_2D,0,B(l.format),l.width,l.height,0,B(l.format),B(l.type),null);e.bindFramebuffer(e.FRAMEBUFFER,l.__webGLFramebuffer);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,l.__webGLTexture,0);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,l.__webGLRenderbuffer);e.bindTexture(e.TEXTURE_2D,null);e.bindRenderbuffer(e.RENDERBUFFER,null);e.bindFramebuffer(e.FRAMEBUFFER,null)}var A,u,q;if(l){A=l.__webGLFramebuffer;u=l.width;
q=l.height}else{A=null;u=p.width;q=p.height}if(A!=Z){e.bindFramebuffer(e.FRAMEBUFFER,A);e.viewport(0,0,u,q);x&&e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);Z=A}}function v(l,x){var A;if(l=="fragment")A=e.createShader(e.FRAGMENT_SHADER);else if(l=="vertex")A=e.createShader(e.VERTEX_SHADER);e.shaderSource(A,x);e.compileShader(A);if(!e.getShaderParameter(A,e.COMPILE_STATUS)){alert(e.getShaderInfoLog(A));return null}return A}function B(l){switch(l){case RepeatWrapping:return e.REPEAT;case ClampToEdgeWrapping:return e.CLAMP_TO_EDGE;
case MirroredRepeatWrapping:return e.MIRRORED_REPEAT;case NearestFilter:return e.NEAREST;case NearestMipMapNearestFilter:return e.NEAREST_MIPMAP_NEAREST;case NearestMipMapLinearFilter:return e.NEAREST_MIPMAP_LINEAR;case LinearFilter:return e.LINEAR;case LinearMipMapNearestFilter:return e.LINEAR_MIPMAP_NEAREST;case LinearMipMapLinearFilter:return e.LINEAR_MIPMAP_LINEAR;case ByteType:return e.BYTE;case UnsignedByteType:return e.UNSIGNED_BYTE;case ShortType:return e.SHORT;
case UnsignedShortType:return e.UNSIGNED_SHORT;case IntType:return e.INT;case UnsignedShortType:return e.UNSIGNED_INT;case FloatType:return e.FLOAT;case AlphaFormat:return e.ALPHA;case RGBFormat:return e.RGB;case RGBAFormat:return e.RGBA;case LuminanceFormat:return e.LUMINANCE;case LuminanceAlphaFormat:return e.LUMINANCE_ALPHA}return 0}var p=document.createElement("canvas"),e,O=null,Z=null,I=null,L=null,X=null,P=[new Vector4,new Vector4,
new Vector4,new Vector4,new Vector4,new Vector4],V=new m4,W=new Float32Array(16),J=new Float32Array(16),Q=new Vector4,fa=true,U=new Color(0),ea=0;if(a){if(a.antialias!==undefined)fa=a.antialias;a.clearColor!==undefined&&U.setHex(a.clearColor);if(a.clearAlpha!==undefined)ea=a.clearAlpha}this.domElement=p;this.autoClear=true;(function(l,x,A){try{e=p.getContext("experimental-webgl",{antialias:l})}catch(u){console.log(u)}if(!e){alert("WebGL not supported");
throw"cannot Cr webgl context";}e.clearColor(0,0,0,1);e.clearDepth(1);e.enable(e.DEPTH_TEST);e.depthFunc(e.LEQUAL);e.frontFace(e.CCW);e.cullFace(e.BACK);e.enable(e.CULL_FACE);e.enable(e.BLEND);e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA);e.clearColor(x.r,x.g,x.b,A);_cullEnabled=true})(fa,U,ea);this.context=e;this.lights={ambient:[0,0,0],directional:{length:0,colors:[],pposs:[]},point:{length:0,colors:[],pposs:[]}};this.setSize=function(l,x){p.width=l;p.height=x;e.viewport(0,0,p.width,p.height)};
this.setClearColorHex=function(l,x){var A=new Color(l);e.clearColor(A.r,A.g,A.b,x)};this.setClearColor=function(l,x){e.clearColor(l.r,l.g,l.b,x)};this.clear=function(){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)};this.setupLights=function(l,x){var A,u,q,G=0,N=0,H=0,F,D,S,ba=this.lights,ha=ba.directional.colors,C=ba.directional.pposs,M=ba.point.colors,K=ba.point.pposs,R=0,da=0;A=0;for(u=x.length;A<u;A++){q=x[A];F=q.color;D=q.ppos;S=q.intensity;if(q instanceof AmbientLight){G+=
F.r;N+=F.g;H+=F.b}else if(q instanceof DirectionalLight){q=R*3;ha[q]=F.r*S;ha[q+1]=F.g*S;ha[q+2]=F.b*S;C[q]=D.x;C[q+1]=D.y;C[q+2]=D.z;R+=1}else if(q instanceof PointLight){q=da*3;M[q]=F.r*S;M[q+1]=F.g*S;M[q+2]=F.b*S;K[q]=D.x;K[q+1]=D.y;K[q+2]=D.z;da+=1}}for(A=R*3;A<ha.length;A++)ha[A]=0;for(A=da*3;A<M.length;A++)M[A]=0;ba.point.length=da;ba.directional.length=R;ba.ambient[0]=G;ba.ambient[1]=N;ba.ambient[2]=H};this.initMt=function(l,x,A){var u,q;if(l instanceof MeshDepthMt)c(l,
ShaderLib.depth);else if(l instanceof MeshNormalMt)c(l,ShaderLib.normal);else if(l instanceof mBm)c(l,ShaderLib.basic);else if(l instanceof mLm)c(l,ShaderLib.lambert);else if(l instanceof mQm)c(l,ShaderLib.phong);else if(l instanceof LineBasicMt)c(l,ShaderLib.basic);else l instanceof ParticleBasicMt&&c(l,ShaderLib.particle_basic);var G,N,H,F;q=H=F=0;for(G=x.length;q<
G;q++){N=x[q];N instanceof DirectionalLight&&H++;N instanceof PointLight&&F++}if(F+H<=4)x=H;else{x=Math.ceil(4*H/(F+H));F=4-x}q={directional:x,point:F};F=l.fragment_shader;x=l.vertex_shader;G={fog:A,map:l.map,env_map:l.env_map,light_map:l.light_map,vertex_colors:l.vertex_colors,maxDirLights:q.directional,maxPointLights:q.point};A=e.createProgram();q=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+G.maxDirLights,"#define MAX_POINT_LIGHTS "+G.maxPointLights,G.fog?
"#define USE_FOG":"",G.fog instanceof FogExp2?"#define FOG_EXP2":"",G.map?"#define USE_MAP":"",G.env_map?"#define USE_ENVMAP":"",G.light_map?"#define USE_LIGHTMAP":"",G.vertex_colors?"#define USE_COLOR":"","uniform mat4 viewMatrix;\nuniform vec3 CCPosition;\n"].join("\n");G=[e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0?"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+G.maxDirLights,"#define MAX_POINT_LIGHTS "+G.maxPointLights,G.map?"#define USE_MAP":"",G.env_map?"#define USE_ENVMAP":
"",G.light_map?"#define USE_LIGHTMAP":"",G.vertex_colors?"#define USE_COLOR":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 pM;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 CCPosition;\nattribute vec3 ppos;\nattribute vec3 normal;\nattribute vec3 color;\nattribute vec2 uv;\nattribute vec2 uv2;\n"].join("\n");e.attachShader(A,v("fragment",q+F));e.attachShader(A,v("vertex",G+x));e.linkProgram(A);e.getProgramParameter(A,e.LINK_STATUS)||
alert("Could not initialise shaders\nVALIDATE_STATUS: "+e.getProgramParameter(A,e.VALIDATE_STATUS)+", gl error ["+e.getError()+"]");A.uniforms={};A.attributes={};l.program=A;A=["viewMatrix","modelViewMatrix","pM","normalMatrix","objectMatrix","CCPosition"];for(u in l.uniforms)A.push(u);u=l.program;F=0;for(x=A.length;F<x;F++){q=A[F];u.uniforms[q]=e.getUniformLocation(u,q)}l=l.program;u=["ppos","normal","uv","uv2","tangent","color"];A=0;for(F=u.length;A<F;A++){x=u[A];l.attributes[x]=
e.getAttribLocation(l,x)}};this.setProgram=function(l,x,A,u,q){u.program||this.initMt(u,x,A);var G=u.program,N=G.uniforms,H=u.uniforms;if(G!=O){e.useProgram(G);O=G;e.uniformMatrix4fv(N.pM,false,W)}if(A&&(u instanceof mBm||u instanceof mLm||u instanceof mQm||u instanceof LineBasicMt||u instanceof ParticleBasicMt)){H.fogColor.value.setHex(A.color.hex);if(A instanceof Fog){H.fogNear.value=
A.near;H.fogFar.value=A.far}else if(A instanceof FogExp2)H.fogDensity.value=A.density}if(u instanceof mQm||u instanceof mLm){this.setupLights(G,x);x=this.lights;H.enableLighting.value=x.directional.length+x.point.length;H.ambientLightColor.value=x.ambient;H.directionalLightColor.value=x.directional.colors;H.directionalLightDirection.value=x.directional.pposs;H.pointLightColor.value=x.point.colors;H.pointLightPosition.value=x.point.pposs}if(u instanceof
mBm||u instanceof mLm||u instanceof mQm){H.diffuse.value.setRGB(u.color.r*u.op,u.color.g*u.op,u.color.b*u.op);H.op.value=u.op;H.map.texture=u.map;H.light_map.texture=u.light_map;H.env_map.texture=u.env_map;H.rfl.value=u.rfl;H.refraction_ratio.value=u.refraction_ratio;H.combine.value=u.combine;H.useRefract.value=u.env_map&&u.env_map.mapping instanceof CubeRefractionMapping}if(u instanceof
LineBasicMt){H.diffuse.value.setRGB(u.color.r*u.op,u.color.g*u.op,u.color.b*u.op);H.op.value=u.op}else if(u instanceof ParticleBasicMt){H.psColor.value.setRGB(u.color.r*u.op,u.color.g*u.op,u.color.b*u.op);H.op.value=u.op;H.size.value=u.size;H.map.texture=u.map}else if(u instanceof mQm){H.ambient.value.setRGB(u.ambient.r,u.ambient.g,u.ambient.b);H.specular.value.setRGB(u.specular.r,u.specular.g,u.specular.b);
H.shininess.value=u.shininess}else if(u instanceof MeshDepthMt){H.mNear.value=l.near;H.mFar.value=l.far;H.op.value=u.op}else if(u instanceof MeshNormalMt)H.op.value=u.op;var F,D,S;for(F in H)if(S=G.uniforms[F]){A=H[F];D=A.type;x=A.value;if(D=="i")e.uniform1i(S,x);else if(D=="f")e.uniform1f(S,x);else if(D=="fv1")e.uniform1fv(S,x);else if(D=="fv")e.uniform3fv(S,x);else if(D=="v2")e.uniform2f(S,x.x,x.y);else if(D=="v3")e.uniform3f(S,x.x,x.y,x.z);else if(D==
"c")e.uniform3f(S,x.r,x.g,x.b);else if(D=="t"){e.uniform1i(S,x);if(A=A.texture)if(A.image instanceof Array&&A.image.length==6){if(A.image.length==6){if(!A.image.__webGLTextureCube&&!A.image.__cubeMapInitialized&&A.image.loadCount==6){A.image.__webGLTextureCube=e.createTexture();e.bindTexture(e.TEXTURE_CUBE_MAP,A.image.__webGLTextureCube);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_CUBE_MAP,
e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR);for(D=0;D<6;++D)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,A.image[D]);e.generateMipmap(e.TEXTURE_CUBE_MAP);e.bindTexture(e.TEXTURE_CUBE_MAP,null);A.image.__cubeMapInitialized=true}e.activeTexture(e.TEXTURE0+x);e.bindTexture(e.TEXTURE_CUBE_MAP,A.image.__webGLTextureCube)}}else{if(!A.__webGLTexture&&A.image.loaded){A.__webGLTexture=e.createTexture();e.bindTexture(e.TEXTURE_2D,
A.__webGLTexture);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,A.image);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,B(A.wrap_s));e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,B(A.wrap_t));e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,B(A.mag_filter));e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,B(A.min_filter));e.generateMipmap(e.TEXTURE_2D);e.bindTexture(e.TEXTURE_2D,null)}e.activeTexture(e.TEXTURE0+x);e.bindTexture(e.TEXTURE_2D,A.__webGLTexture)}}}e.uniformMatrix4fv(N.modelViewMatrix,
false,q._modelViewMatrixArray);e.uniformMatrix3fv(N.normalMatrix,false,q._normalMatrixArray);if(u instanceof MeshShaderMt||u instanceof mQm||u.env_map)e.uniform3f(N.CCPosition,l.ppos.x,l.ppos.y,l.ppos.z);if(u instanceof MeshShaderMt||u.env_map)e.uniformMatrix4fv(N.objectMatrix,false,q._objectMatrixArray);if(u instanceof mQm||u instanceof mLm||u instanceof MeshShaderMt)e.uniformMatrix4fv(N.viewMatrix,
false,J);return G};this.renderBuffer=function(l,x,A,u,q,G){l=this.setProgram(l,x,A,u,G).attributes;e.bindBuffer(e.ARRAY_BUFFER,q.__webGLVertexBuffer);e.vertexAttribPointer(l.ppos,3,e.FLOAT,false,0,0);e.enableVertexAttribArray(l.ppos);if(l.color>=0){e.bindBuffer(e.ARRAY_BUFFER,q.__webGLColorBuffer);e.vertexAttribPointer(l.color,3,e.FLOAT,false,0,0);e.enableVertexAttribArray(l.color)}if(l.normal>=0){e.bindBuffer(e.ARRAY_BUFFER,q.__webGLNormalBuffer);e.vertexAttribPointer(l.normal,3,e.FLOAT,
false,0,0);e.enableVertexAttribArray(l.normal)}if(l.tangent>=0){e.bindBuffer(e.ARRAY_BUFFER,q.__webGLTangentBuffer);e.vertexAttribPointer(l.tangent,4,e.FLOAT,false,0,0);e.enableVertexAttribArray(l.tangent)}if(l.uv>=0)if(q.__webGLUVBuffer){e.bindBuffer(e.ARRAY_BUFFER,q.__webGLUVBuffer);e.vertexAttribPointer(l.uv,2,e.FLOAT,false,0,0);e.enableVertexAttribArray(l.uv)}else e.disableVertexAttribArray(l.uv);if(l.uv2>=0)if(q.__webGLUV2Buffer){e.bindBuffer(e.ARRAY_BUFFER,q.__webGLUV2Buffer);e.vertexAttribPointer(l.uv2,
2,e.FLOAT,false,0,0);e.enableVertexAttribArray(l.uv2)}else e.disableVertexAttribArray(l.uv2);if(G instanceof Mesh)if(u.wf){e.lineWidth(u.wf_lw);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,q.__webGLLineBuffer);e.drawElements(e.LINES,q.__webGLLineCount,e.UNSIGNED_SHORT,0)}else{e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,q.__webGLFaceBuffer);e.drawElements(e.TRIANGLES,q.__webGLFaceCount,e.UNSIGNED_SHORT,0)}else if(G instanceof Line){G=G.type==LineStrip?e.LINE_STRIP:e.LINES;e.lineWidth(u.lw);
e.drawArrays(G,0,q.__webGLLineCount)}else G instanceof ParticleSystem&&e.drawArrays(e.POINTS,0,q.__webGLParticleCount)};this.render=function(l,x,A,u){var q,G,N,H,F,D,S,ba=l.lights,ha=l.fog;x.aum&&x.um();x.matrix.flattenToArray(J);x.pM.flattenToArray(W);V.multiply(x.pM,x.matrix);g(V);this.initWebGLoBs(l,x);E(A,u!==undefined?u:true);this.autoClear&&this.clear();H=l.__webGLoBs.length;for(u=0;u<H;u++){q=l.__webGLoBs[u];D=q.object;if(D.vs){if(q.root){D.aum&&
D.um();D.matrixWorld.cy(D.matrix);o(D)}if(!(D instanceof Mesh)||h(D)){D.matrixWorld.flattenToArray(D._objectMatrixArray);y(D,x);m(q);q.render=true}else q.render=false}else q.render=false}F=l.__webGLoBsImmediate.length;for(u=0;u<F;u++){q=l.__webGLoBsImmediate[u];D=q.object;if(D.vs){if(D.aum){D.um();D.matrixWorld.cy(D.matrix);D.matrixWorld.flattenToArray(D._objectMatrixArray)}y(D,x);k(q)}}z(NormalBlending);for(u=0;u<H;u++){q=l.__webGLoBs[u];
if(q.render){D=q.object;S=q.buffer;N=q.opaque;f(D);for(q=0;q<N.count;q++){material=N.list[q];this.setDepthTest(material.depth_test);this.renderBuffer(x,ba,ha,material,S,D)}}}for(u=0;u<F;u++){q=l.__webGLoBsImmediate[u];D=q.object;if(D.vs){N=q.opaque;f(D);for(q=0;q<N.count;q++){material=N.list[q];this.setDepthTest(material.depth_test);G=this.setProgram(x,ba,ha,material,D);D.render(function(C){d(C,G)})}}}for(u=0;u<H;u++){q=l.__webGLoBs[u];if(q.render){D=q.object;S=q.buffer;N=q.transparent;
f(D);for(q=0;q<N.count;q++){material=N.list[q];z(material.blending);this.setDepthTest(material.depth_test);this.renderBuffer(x,ba,ha,material,S,D)}}}for(u=0;u<F;u++){q=l.__webGLoBsImmediate[u];D=q.object;if(D.vs){N=q.transparent;f(D);for(q=0;q<N.count;q++){material=N.list[q];z(material.blending);this.setDepthTest(material.depth_test);G=this.setProgram(x,ba,ha,material,D);D.render(function(C){d(C,G)})}}}if(A&&A.min_filter!==NearestFilter&&A.min_filter!==LinearFilter){e.bindTexture(e.TEXTURE_2D,
A.__webGLTexture);e.generateMipmap(e.TEXTURE_2D);e.bindTexture(e.TEXTURE_2D,null)}};this.initWebGLoBs=function(l){var x,A,u;if(!l.__webGLoBs){l.__webGLoBs=[];l.__webGLoBsMap={};l.__webGLoBsImmediate=[]}x=0;for(A=l.objects.length;x<A;x++){u=l.objects[x];t(l,u,true);w(l,u)}};this.removeoB=function(l,x){var A,u;for(A=l.__webGLoBs.length-1;A>=0;A--){u=l.__webGLoBs[A].object;x==u&&l.__webGLoBs.splice(A,1)}};this.setDepthTest=function(l){l?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST)};
this.setFaceCulling=function(l,x){if(l){!x||x=="ccw"?e.frontFace(e.CCW):e.frontFace(e.CW);if(l=="back")e.cullFace(e.BACK);else l=="front"?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK);e.enable(e.CULL_FACE)}else e.disable(e.CULL_FACE)};this.supportsVertexTextures=function(){return e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}};
Sn={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",
envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float rfl;\nuniform samplerCube env_map;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( env_map, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = vec4( mix( gl_FragColor.xyz, cubeColor.xyz, rfl ), op );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refraction_ratio;\nuniform bool useRefract;\n#endif",
envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( ppos, 1.0 );\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - CCPosition ), normalize( nWorld.xyz ), refraction_ratio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - CCPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",
map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\n#endif",map_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D light_map;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",
lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( light_map, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n#ifdef PHONG\nvarying vec3 vPointLightVector[ MAX_POINT_LIGHTS ];\n#endif\n#endif",
lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 pointLightVector = normalize( lPosition.xyz - mvPosition.xyz );\nfloat pointLightWeighting = max( dot( transformedNormal, pointLightVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting;\n#ifdef PHONG\nvPointLightVector[ i ] = pointLightVector;\n#endif\n}\n#endif\n}",
lights_pars_fragment:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nvarying vec3 vPointLightVector[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 mColor = vec4( diffuse, op );\nvec4 mSpecular = vec4( specular, op );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointDiffuse  = vec4( 0.0 );\nvec4 pointSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec3 pointVector = normalize( vPointLightVector[ i ] );\nvec3 pointHalfVector = normalize( vPointLightVector[ i ] + vViewPosition );\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += mColor * pointDiffuseWeight;\npointSpecular += mSpecular * pointSpecularWeight;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirDiffuse  = vec4( 0.0 );\nvec4 dirSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += mColor * dirDiffuseWeight;\ndirSpecular += mSpecular * dirSpecularWeight;\n}\n#endif\nvec4 totalLight = vec4( ambient, op );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirDiffuse + dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointDiffuse + pointSpecular;\n#endif\ngl_FragColor = gl_FragColor * totalLight;",
color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, op );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\nvColor = color;\n#endif"};
UniformsLib={common:{diffuse:{type:"c",value:new Color(15658734)},op:{type:"f",value:1},map:{type:"t",value:0,texture:null},light_map:{type:"t",value:2,texture:null},env_map:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},rfl:{type:"f",value:1},refraction_ratio:{type:"f",value:0.98},combine:{type:"i",value:0},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new Color(16777215)}},lights:{enableLighting:{type:"i",
value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]}},particle:{psColor:{type:"c",value:new Color(15658734)},op:{type:"f",value:1},size:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new Color(16777215)}}};
ShaderLib={depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2E3},op:{type:"f",value:1}},fragment_shader:"uniform float mNear;\nuniform float mFar;\nuniform float op;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), op );\n}",vertex_shader:"void main() {\ngl_Position = pM * modelViewMatrix * vec4( ppos, 1.0 );\n}"},normal:{uniforms:{op:{type:"f",
value:1}},fragment_shader:"uniform float op;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, op );\n}",vertex_shader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( ppos, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = pM * mvPosition;\n}"},basic:{uniforms:UniformsLib.common,fragment_shader:["uniform vec3 diffuse;\nuniform float op;",Sn.color_pars_fragment,
Sn.map_pars_fragment,Sn.lightmap_pars_fragment,Sn.envmap_pars_fragment,Sn.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, op );",Sn.map_fragment,Sn.lightmap_fragment,Sn.color_fragment,Sn.envmap_fragment,Sn.fog_fragment,"}"].join("\n"),vertex_shader:[Sn.map_pars_vertex,Sn.lightmap_pars_vertex,Sn.envmap_pars_vertex,Sn.color_pars_vertex,
"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( ppos, 1.0 );",Sn.map_vertex,Sn.lightmap_vertex,Sn.envmap_vertex,Sn.color_vertex,"gl_Position = pM * mvPosition;\n}"].join("\n")},lambert:{uniforms:Uniforms.merge([UniformsLib.common,UniformsLib.lights]),fragment_shader:["uniform vec3 diffuse;\nuniform float op;\nvarying vec3 vLightWeighting;",Sn.color_pars_fragment,Sn.map_pars_fragment,
Sn.lightmap_pars_fragment,Sn.envmap_pars_fragment,Sn.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, op );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",Sn.map_fragment,Sn.lightmap_fragment,Sn.color_fragment,Sn.envmap_fragment,Sn.fog_fragment,"}"].join("\n"),vertex_shader:["varying vec3 vLightWeighting;",Sn.map_pars_vertex,Sn.lightmap_pars_vertex,
Sn.envmap_pars_vertex,Sn.lights_pars_vertex,Sn.color_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( ppos, 1.0 );",Sn.map_vertex,Sn.lightmap_vertex,Sn.envmap_vertex,Sn.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",Sn.lights_vertex,"gl_Position = pM * mvPosition;\n}"].join("\n")},phong:{uniforms:Uniforms.merge([UniformsLib.common,
UniformsLib.lights,{ambient:{type:"c",value:new Color(328965)},specular:{type:"c",value:new Color(1118481)},shininess:{type:"f",value:30}}]),fragment_shader:["uniform vec3 diffuse;\nuniform float op;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;\nvarying vec3 vLightWeighting;",Sn.color_pars_fragment,Sn.map_pars_fragment,Sn.lightmap_pars_fragment,Sn.envmap_pars_fragment,Sn.fog_pars_fragment,
Sn.lights_pars_fragment,"void main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );",Sn.lights_fragment,Sn.map_fragment,Sn.lightmap_fragment,Sn.color_fragment,Sn.envmap_fragment,Sn.fog_fragment,"}"].join("\n"),vertex_shader:["#define PHONG\nvarying vec3 vLightWeighting;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",Sn.map_pars_vertex,Sn.lightmap_pars_vertex,Sn.envmap_pars_vertex,
Sn.lights_pars_vertex,Sn.color_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( ppos, 1.0 );",Sn.map_vertex,Sn.lightmap_vertex,Sn.envmap_vertex,Sn.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( ppos, 1.0 );\n#endif\nvViewPosition = CCPosition - mPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",Sn.lights_vertex,
"gl_Position = pM * mvPosition;\n}"].join("\n")},particle_basic:{uniforms:UniformsLib.particle,fragment_shader:["uniform vec3 psColor;\nuniform float op;",Sn.color_pars_fragment,Sn.map_particle_pars_fragment,Sn.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, op );",Sn.map_particle_fragment,Sn.color_fragment,Sn.fog_fragment,"}"].join("\n"),vertex_shader:["uniform float size;",Sn.color_pars_vertex,
"void main() {",Sn.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( ppos, 1.0 );\ngl_Position = pM * mvPosition;\ngl_PointSize = size;\n}"].join("\n")}};RenderableoB=function(){this.z=this.object=null};
RenderableFace3=function(){this.z=null;this.v1=new Vertex;this.v2=new Vertex;this.v3=new Vertex;this.centroidWorld=new v3;this.centroidScreen=new v3;this.normalWorld=new v3;this.vnsWorld=[];this.faceMts=this.meshMts=null;this.overdraw=false;this.uvs=[null,null,null]};RenderableParticle=function(){this.rt=this.z=this.y=this.x=null;this.sC=new Vector2;this.mTs=null};
RenderableLine=function(){this.z=null;this.v1=new Vertex;this.v2=new Vertex;this.mTs=null};
Detector={canvas:!!window.CanvasRenderingContext2D,webgl:!!window.WebGLRenderingContext,workers:!!window.Worker,addGetWebGLMessage:function(a){var b=document.body,c="oldie";if(a){if(a.parent!==undefined)b=a.parent;if(a.id!==undefined)c=a.id}a=document.createElement("center");var d=document.createElement("div");d.innerHTML='Sorry, your browser doesn\'t support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a><br/>\n<br/>\nPlease try in\n<a href="http://www.google.com/chrome">Chrome 9+</a> /\n<a href="http://www.mozilla.com/en-US/firefox/all-beta.html">Firefox 4+</a> /\n<a href="http://nightly.webkit.org/">Safari OSX 10.6+</a>';d.id=
c;c=d.style;c.fontFamily="monospace";c.fontSize="13px";c.textAlign="center";c.background="#eee";c.color="#000";c.padding="1em";c.width="475px";c.margin="5em auto 0";a.appendChild(d);b.appendChild(a);return d}};
var GGUtils={merge:function(a,b){var c=b instanceof Mesh,d=a.vts.length,f=c?b.gG:b,g=a.vts,h=f.vts,j=a.faces,k=f.faces,m=a.uvs;f=f.uvs;c&&b.aum&&b.um();for(var o=0,w=h.length;o<w;o++){var t=new Vertex(h[o].ppos.clone());c&&b.matrix.mV3(t.ppos);g.push(t)}o=0;for(w=k.length;o<w;o++){h=k[o];var n,y=h.vns;if(h instanceof Face3)n=new Face3(h.a+d,h.b+d,h.c+d);else if(h instanceof Face4)n=new Face4(h.a+
d,h.b+d,h.c+d,h.d+d);n.centroid.cy(h.centroid);n.normal.cy(h.normal);c=0;for(g=y.length;c<g;c++){t=y[c];n.vns.push(t.clone())}n.mTs=h.mTs.slice();j.push(n)}o=0;for(w=f.length;o<w;o++){d=f[o];j=[];c=0;for(g=d.length;c<g;c++)j.push(new UV(d[c].u,d[c].v));m.push(j)}}},ImageUtils={lT:function(a,b,c){var d=new Image;d.onload=function(){this.loaded=true;c&&c(this)};d.src=a;return new Texture(d,b)},loadArray:function(a,b){var c,d,f=[];c=f.loadCount=0;for(d=
a.length;c<d;++c){f[c]=new Image;f[c].loaded=0;f[c].onload=function(){f.loadCount+=1;this.loaded=true;b&&b(this)};f[c].src=a[c]}return f}},SceneUtils={loadScene:function(a,b,c,d){a=new Worker(a);a.postMessage(0);a.onmessage=function(f){function g(){for(o in I.objects)if(!J.objects[o]){z=I.objects[o];if(p=J.geometries[z.gG]){Z=[];for(i=0;i<z.mTs.length;i++)Z[i]=J.mTs[z.mTs[i]];E=z.ppos;r=z.rt;s=z.sC;object=new Mesh(p,Z);object.ppos.set(E[0],E[1],E[2]);
object.rt.set(r[0],r[1],r[2]);object.sC.set(s[0],s[1],s[2]);object.vs=z.vs;J.scene.addoB(object);J.objects[o]=object}}}function h(Q){return function(fa){J.geometries[Q]=fa;g();X-=1;j()}}function j(){d({total_models:V,total_textures:W,loaded_models:V-X,loaded_textures:W-P},J);X==0&&P==0&&c(J)}var k,m,o,w,t,n,y,z,E,v,B,p,e,O,Z,I,L,X,P,V,W,J;I=f.data;L=new Loader;P=X=0;J={scene:new Scene,geometries:{},mTs:{},textures:{},objects:{},CCs:{},lights:{},fogs:{}};
f=function(){P-=1;j()};for(t in I.CCs){v=I.CCs[t];if(v.type=="perspective")e=new Camera(v.fov,v.aspect,v.near,v.far);else if(v.type=="ortho"){e=new Camera;e.pM=m4.makeOrtho(v.left,v.right,v.top,v.bottom,v.near,v.far)}E=v.ppos;v=v.target;e.ppos.set(E[0],E[1],E[2]);e.target.ppos.set(v[0],v[1],v[2]);J.CCs[t]=e}for(w in I.lights){t=I.lights[w];if(t.type=="directional"){E=t.direction;light=new DirectionalLight;light.ppos.set(E[0],E[1],
E[2]);light.ppos.normalize()}else if(t.type=="point"){E=t.ppos;light=new PointLight;light.ppos.set(E[0],E[1],E[2])}v=t.color;i=t.intensity||1;light.color.setRGB(v[0]*i,v[1]*i,v[2]*i);J.scene.addLight(light);J.lights[w]=light}for(n in I.fogs){w=I.fogs[n];if(w.type=="linear")O=new Fog(0,w.near,w.far);else if(w.type=="exp2")O=new FogExp2(0,w.density);v=w.color;O.color.setRGB(v[0],v[1],v[2]);J.fogs[n]=O}if(J.CCs&&I.defaults.CC)J.currentCamera=J.CCs[I.defaults.CC];
if(J.fogs&&I.defaults.fog)J.scene.fog=J.fogs[I.defaults.fog];v=I.defaults.bgcolor;J.bgColor=new Color;J.bgColor.setRGB(v[0],v[1],v[2]);J.bgColorAlpha=I.defaults.bgalpha;for(k in I.geometries){n=I.geometries[k];if(n.type=="bin_mesh"||n.type=="ascii_mesh")X+=1}V=X;for(k in I.geometries){n=I.geometries[k];if(n.type=="cube"){p=new Cube(n.width,n.height,n.depth,n.segments_width,n.segments_height,null,n.flipped,n.sides);J.geometries[k]=p}else if(n.type=="plane"){p=new Plane(n.width,n.height,n.segments_width,
n.segments_height);J.geometries[k]=p}else if(n.type=="sphere"){p=new SS(n.radius,n.segments_width,n.segments_height);J.geometries[k]=p}else if(n.type=="cylinder"){p=new Cylinder(n.numSegs,n.topRad,n.botRad,n.height,n.topOffset,n.botOffset);J.geometries[k]=p}else if(n.type=="torus"){p=new Torus(n.radius,n.tube,n.segmentsR,n.segmentsT);J.geometries[k]=p}else if(n.type=="icosahedron"){p=new Icosahedron(n.subdivisions);J.geometries[k]=p}else if(n.type=="bin_mesh")L.loadBinary({model:n.url,callback:h(k)});
else n.type=="ascii_mesh"&&L.loadAscii({model:n.url,callback:h(k)})}for(y in I.textures){k=I.textures[y];P+=k.url instanceof Array?k.url.length:1}W=P;for(y in I.textures){k=I.textures[y];if(k.mapping!=undefined&&THREE[k.mapping]!=undefined)k.mapping=new THREE[k.mapping];if(k.url instanceof Array){n=ImageUtils.loadArray(k.url,f);n=new Texture(n,k.mapping)}else{n=ImageUtils.lT(k.url,k.mapping,f);if(THREE[k.min_filter]!=undefined)n.min_filter=THREE[k.min_filter];if(THREE[k.mag_filter]!=
undefined)n.mag_filter=THREE[k.mag_filter]}J.textures[y]=n}for(m in I.mTs){y=I.mTs[m];for(B in y.parameters)if(B=="env_map"||B=="map"||B=="light_map")y.parameters[B]=J.textures[y.parameters[B]];else if(B=="shading")y.parameters[B]=y.parameters[B]=="flat"?FlatShading:SmoothShading;else if(B=="blending")y.parameters[B]=THREE[y.parameters[B]]?THREE[y.parameters[B]]:NormalBlending;else if(B=="combine")y.parameters[B]=y.parameters[B]=="MixOperation"?MixOperation:MultiplyOperation;
y=new THREE[y.type](y.parameters);J.mTs[m]=y}g();b(J)}},addMesh:function(a,b,c,d,f,g,h,j,k,m){b=new Mesh(b,m);b.sC.x=b.sC.y=b.sC.z=c;b.ppos.x=d;b.ppos.y=f;b.ppos.z=g;b.rt.x=h;b.rt.y=j;b.rt.z=k;a.addoB(b);return b},addPanoramaCubeWebGL:function(a,b,c){var d=ShaderUtils.lib.cube;d.uniforms.tCube.texture=c;c=new MeshShaderMt({fragment_shader:d.fragment_shader,vertex_shader:d.vertex_shader,uniforms:d.uniforms});b=new Mesh(new Cube(b,
b,b,1,1,null,true),c);a.addoB(b);return b},addPanoramaCube:function(a,b,c){var d=[];d.push(new mBm({map:new Texture(c[0])}));d.push(new mBm({map:new Texture(c[1])}));d.push(new mBm({map:new Texture(c[2])}));d.push(new mBm({map:new Texture(c[3])}));d.push(new mBm({map:new Texture(c[4])}));d.push(new mBm({map:new Texture(c[5])}));b=new Mesh(new Cube(b,
b,b,1,1,d,true),new MeshFaceMt);a.addoB(b);return b},addPanoramaCubePlanes:function(a,b,c){var d=b/2;b=new Plane(b,b);var f=Math.PI/2,g=Math.PI;SceneUtils.addMesh(a,b,1,0,0,-d,0,0,0,new mBm({map:new Texture(c[5])}));SceneUtils.addMesh(a,b,1,-d,0,0,0,f,0,new mBm({map:new Texture(c[0])}));SceneUtils.addMesh(a,b,1,d,0,0,0,-f,0,new mBm({map:new Texture(c[1])}));SceneUtils.addMesh(a,b,1,0,d,0,f,0,g,new mBm({map:new Texture(c[2])}));
SceneUtils.addMesh(a,b,1,0,-d,0,-f,0,g,new mBm({map:new Texture(c[3])}))}},ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:0.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragment_shader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",
vertex_shader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( ppos, 1.0 );\nvec4 mPosition = objectMatrix * vec4( ppos, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - CCPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = pM * mvPosition;\n}"},
normal:{uniforms:{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tNormal:{type:"t",value:2,texture:null},tAO:{type:"t",value:3,texture:null},uNormalScale:{type:"f",value:1},tDisplacement:{type:"t",value:4,texture:null},uDisplacementBias:{type:"f",value:-0.5},uDisplacementScale:{type:"f",value:2.5},uPointLightPos:{type:"v3",value:new v3},uPointLightColor:{type:"c",value:new Color(15658734)},uDirLightPos:{type:"v3",value:new v3},
uDirLightColor:{type:"c",value:new Color(15658734)},uAmbientLightColor:{type:"c",value:new Color(328965)},uDiffuseColor:{type:"c",value:new Color(15658734)},uSpecularColor:{type:"c",value:new Color(1118481)},uAmbientColor:{type:"c",value:new Color(328965)},uShininess:{type:"f",value:30}},fragment_shader:"uniform vec3 uDirLightPos;\nuniform vec3 uAmbientLightColor;\nuniform vec3 uDirLightColor;\nuniform vec3 uPointLightColor;\nuniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform bool enableDiffuse;\nuniform bool enableAO;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tAO;\nuniform float uNormalScale;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 diffuseTex = vec3( 1.0, 1.0, 1.0 );\nvec3 aoTex = vec3( 1.0, 1.0, 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ndiffuseTex = texture2D( tDiffuse, vUv ).xyz;\nif( enableAO )\naoTex = texture2D( tAO, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 pointDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 pointSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec3 pointVector = normalize( vPointLightVector );\nvec3 pointHalfVector = normalize( vPointLightVector + vViewPosition );\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, uShininess );\npointDiffuse  += vec4( uDiffuseColor, 1.0 ) * pointDiffuseWeight;\npointSpecular += vec4( uSpecularColor, 1.0 ) * pointSpecularWeight;\nvec4 dirDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 dirSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );\nvec4 lDirection = viewMatrix * vec4( uDirLightPos, 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, uShininess );\ndirDiffuse  += vec4( uDiffuseColor, 1.0 ) * dirDiffuseWeight;\ndirSpecular += vec4( uSpecularColor, 1.0 ) * dirSpecularWeight;\nvec4 totalLight = vec4( uAmbientLightColor * uAmbientColor, 1.0 );\ntotalLight += vec4( uDirLightColor, 1.0 ) * ( dirDiffuse + dirSpecular );\ntotalLight += vec4( uPointLightColor, 1.0 ) * ( pointDiffuse + pointSpecular );\ngl_FragColor = vec4( totalLight.xyz * aoTex * diffuseTex, 1.0 );\n}",
vertex_shader:"attribute vec4 tangent;\nuniform vec3 uPointLightPos;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vPointLightVector;\nvarying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( ppos, 1.0 );\nvViewPosition = CCPosition - mPosition.xyz;\nvec4 mvPosition = modelViewMatrix * vec4( ppos, 1.0 );\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv;\nvec4 lPosition = viewMatrix * vec4( uPointLightPos, 1.0 );\nvPointLightVector = normalize( lPosition.xyz - mvPosition.xyz );\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = pM * displacedPosition;\n#else\ngl_Position = pM * mvPosition;\n#endif\n}"},
cube:{uniforms:{tCube:{type:"t",value:1,texture:null}},vertex_shader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( ppos, 1.0 );\nvViewPosition = CCPosition - mPosition.xyz;\ngl_Position = pM * modelViewMatrix * vec4( ppos, 1.0 );\n}",fragment_shader:"uniform samplerCube tCube;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = CCPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( - wPos.x, wPos.yz ) );\n}"},convolution:{uniforms:{tDiffuse:{type:"t",
value:0,texture:null},uImageIncrement:{type:"v2",value:new Vector2(0.001953125,0)},cKernel:{type:"fv1",value:[]}},vertex_shader:"varying vec2 vUv;\nuniform vec2 uImageIncrement;\nvoid main(void) {\nvUv = uv - ((KERNEL_SIZE - 1.0) / 2.0) * uImageIncrement;\ngl_Position = pM * modelViewMatrix * vec4( ppos, 1.0 );\n}",fragment_shader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nuniform float cKernel[KERNEL_SIZE];\nvoid main(void) {\nvec2 imageCoord = vUv;\nvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\nfor( int i=0; i<KERNEL_SIZE; ++i ) {\nsum += texture2D( tDiffuse, imageCoord ) * cKernel[i];\nimageCoord += uImageIncrement;\n}\ngl_FragColor = sum;\n}"},
film:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},time:{type:"f",value:0},graysC:{type:"i",value:1}},vertex_shader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = pM * modelViewMatrix * vec4( ppos, 1.0 );\n}",fragment_shader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float time;\nuniform bool graysC;\nconst float fNintensity = 0.35;\nconst float fSintensity = 0.35;\nconst float fScount = 4096.0;\nvoid main() {\nvec4 cTextureScreen = texture2D( tDiffuse, vUv );\nfloat x = vUv.x * vUv.y * time *  1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\nvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\nvec2 sc = vec2( sin(vUv.y * fScount), cos(vUv.y * fScount) );\ncResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * fSintensity;\ncResult = cTextureScreen.rgb + clamp( fNintensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\nif( graysC ) {\ncResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n}\ngl_FragColor =  vec4( cResult, cTextureScreen.a );\n}"},
screen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},op:{type:"f",value:1}},vertex_shader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = pM * modelViewMatrix * vec4( ppos, 1.0 );\n}",fragment_shader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float op;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = op * texel;\n}"},basic:{uniforms:{},vertex_shader:"void main() {\ngl_Position = pM * modelViewMatrix * vec4( ppos, 1.0 );\n}",
fragment_shader:"void main() {\ngl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );\n}"}},buildKernel:function(a){var b,c,d,f,g=2*Math.ceil(a*3)+1;if(g>25)g=25;f=(g-1)*0.5;c=Array(g);for(b=d=0;b<g;++b){c[b]=Math.exp(-((b-f)*(b-f))/(2*a*a));d+=c[b]}for(b=0;b<g;++b)c[b]/=d;return c}},Cube=function(a,b,c,d,f,g,h,j){function k(z,E,v,B,p,e,O,Z){var I,L,X=d||1,P=f||1,V=X+1,W=P+1,J=p/2,Q=e/2;p/=X;var fa=e/P,U=m.vts.length;if(z=="x"&&E=="y"||z=="y"&&E=="x")I="z";else if(z=="x"&&E=="z"||z=="z"&&E=="x")I="y";else if(z==
"z"&&E=="y"||z=="y"&&E=="z")I="x";for(L=0;L<W;L++)for(e=0;e<V;e++){var ea=new v3;ea[z]=(e*p-J)*v;ea[E]=(L*fa-Q)*B;ea[I]=O;m.vts.push(new Vertex(ea))}for(L=0;L<P;L++)for(e=0;e<X;e++){m.faces.push(new Face4(e+V*L+U,e+V*(L+1)+U,e+1+V*(L+1)+U,e+1+V*L+U,null,Z));m.uvs.push([new UV(e/X,L/P),new UV(e/X,(L+1)/P),new UV((e+1)/X,(L+1)/P),new UV((e+1)/X,L/P)])}}GG.call(this);var m=this,o=a/2,w=b/2,t=c/2;h=h?-1:1;if(g!==undefined)if(g instanceof
Array)this.mTs=g;else{this.mTs=[];for(var n=0;n<6;n++)this.mTs.push([g])}else this.mTs=[];this.sides={px:true,nx:true,py:true,ny:true,pz:true,nz:true};if(j!=undefined)for(var y in j)if(this.sides[y]!=undefined)this.sides[y]=j[y];this.sides.px&&k("z","y",1*h,-1,c,b,-o,this.mTs[0]);this.sides.nx&&k("z","y",-1*h,-1,c,b,o,this.mTs[1]);this.sides.py&&k("x","z",1*h,1,a,c,w,this.mTs[2]);this.sides.ny&&k("x","z",1*h,-1,a,c,-w,this.mTs[3]);this.sides.pz&&k("x",
"y",1*h,-1,a,b,t,this.mTs[4]);this.sides.nz&&k("x","y",-1*h,-1,a,b,-t,this.mTs[5]);(function(){for(var z=[],E=[],v=0,B=m.vts.length;v<B;v++){for(var p=m.vts[v],e=false,O=0,Z=z.length;O<Z;O++){var I=z[O];if(p.ppos.x==I.ppos.x&&p.ppos.y==I.ppos.y&&p.ppos.z==I.ppos.z){E[v]=O;e=true;break}}if(!e){E[v]=z.length;z.push(new Vertex(p.ppos.clone()))}}v=0;for(B=m.faces.length;v<B;v++){p=m.faces[v];p.a=E[p.a];p.b=E[p.b];p.c=E[p.c];p.d=E[p.d]}m.vts=
z})();this.cMpCentroids();this.cMpFaceNormals();this.sortFacesByMt()};Cube.prototype=new GG;Cube.prototype.constructor=Cube;
var Cylinder=function(a,b,c,d,f){function g(m,o,w){h.vts.push(new Vertex(new v3(m,o,w)))}GG.call(this);var h=this,j=Math.PI,k;for(k=0;k<a;k++)g(Math.sin(2*j*k/a)*b,Math.cos(2*j*k/a)*b,0);for(k=0;k<a;k++)g(Math.sin(2*j*k/a)*c,Math.cos(2*j*k/a)*c,d);for(k=0;k<a;k++)h.faces.push(new Face4(k,k+a,a+(k+1)%a,(k+1)%a));if(c!=0){g(0,0,-f);for(k=a;k<a+a/2;k++)h.faces.push(new Face4(2*a,(2*k-2*a)%a,(2*k-2*a+1)%a,(2*k-2*a+2)%a))}if(b!=0){g(0,0,d+f);for(k=a+a/2;k<
2*a;k++)h.faces.push(new Face4((2*k-2*a+2)%a+a,(2*k-2*a+1)%a+a,(2*k-2*a)%a+a,2*a+1))}this.cMpCentroids();this.cMpFaceNormals();this.sortFacesByMt()};Cylinder.prototype=new GG;Cylinder.prototype.constructor=Cylinder;
var Plane=function(a,b,c,d){GG.call(this);var f,g=a/2,h=b/2;c=c||1;d=d||1;var j=c+1,k=d+1;a/=c;var m=b/d;for(f=0;f<k;f++)for(b=0;b<j;b++)this.vts.push(new Vertex(new v3(b*a-g,-(f*m-h),0)));for(f=0;f<d;f++)for(b=0;b<c;b++){this.faces.push(new Face4(b+j*f,b+j*(f+1),b+1+j*(f+1),b+1+j*f));this.uvs.push([new UV(b/c,f/d),new UV(b/c,(f+1)/d),new UV((b+1)/c,(f+1)/d),new UV((b+1)/c,f/d)])}this.cMpCentroids();this.cMpFaceNormals();this.sortFacesByMt()};
Plane.prototype=new GG;Plane.prototype.constructor=Plane;
var SS=function(a,b,c){GG.call(this);var d,f=Math.PI,g=Math.max(3,b||8),h=Math.max(2,c||6);b=[];for(c=0;c<h+1;c++){d=c/h;var j=a*Math.cos(d*f),k=a*Math.sin(d*f),m=[],o=0;for(d=0;d<g;d++){var w=2*d/g,t=k*Math.sin(w*f);w=k*Math.cos(w*f);(c==0||c==h)&&d>0||(o=this.vts.push(new Vertex(new v3(w,j,t)))-1);m.push(o)}b.push(m)}var n,y,z;f=b.length;for(c=0;c<f;c++){g=b[c].length;if(c>0)for(d=0;d<g;d++){m=d==g-1;h=b[c][m?0:d+1];j=b[c][m?g-1:d];k=b[c-1][m?g-1:d];m=b[c-1][m?
0:d+1];t=c/(f-1);n=(c-1)/(f-1);y=(d+1)/g;w=d/g;o=new UV(1-y,t);t=new UV(1-w,t);w=new UV(1-w,n);var E=new UV(1-y,n);if(c<b.length-1){n=this.vts[h].ppos.clone();y=this.vts[j].ppos.clone();z=this.vts[k].ppos.clone();n.normalize();y.normalize();z.normalize();this.faces.push(new Face3(h,j,k,[new v3(n.x,n.y,n.z),new v3(y.x,y.y,y.z),new v3(z.x,z.y,z.z)]));this.uvs.push([o,t,w])}if(c>1){n=this.vts[h].ppos.clone();
y=this.vts[k].ppos.clone();z=this.vts[m].ppos.clone();n.normalize();y.normalize();z.normalize();this.faces.push(new Face3(h,k,m,[new v3(n.x,n.y,n.z),new v3(y.x,y.y,y.z),new v3(z.x,z.y,z.z)]));this.uvs.push([o,w,E])}}}this.cMpCentroids();this.cMpFaceNormals();this.cMpVertexNormals();this.sortFacesByMt();this.bS={radius:a}};SS.prototype=new GG;SS.prototype.constructor=SS;
var Torus=function(a,b,c,d){this.radius=a||100;this.tube=b||40;this.segmentsR=c||8;this.segmentsT=d||6;a=[];GG.call(this);for(b=0;b<=this.segmentsR;++b)for(c=0;c<=this.segmentsT;++c){d=c/this.segmentsT*2*Math.PI;var f=b/this.segmentsR*2*Math.PI;this.vts.push(new Vertex(new v3((this.radius+this.tube*Math.cos(f))*Math.cos(d),(this.radius+this.tube*Math.cos(f))*Math.sin(d),this.tube*Math.sin(f))));a.push([c/this.segmentsT,1-b/this.segmentsR])}for(b=1;b<=this.segmentsR;++b)for(c=
1;c<=this.segmentsT;++c){d=(this.segmentsT+1)*b+c;f=(this.segmentsT+1)*b+c-1;var g=(this.segmentsT+1)*(b-1)+c-1,h=(this.segmentsT+1)*(b-1)+c;this.faces.push(new Face4(d,f,g,h));this.uvs.push([new UV(a[d][0],a[d][1]),new UV(a[f][0],a[f][1]),new UV(a[g][0],a[g][1]),new UV(a[h][0],a[h][1])])}delete a;this.cMpCentroids();this.cMpFaceNormals();this.cMpVertexNormals();this.sortFacesByMt()};Torus.prototype=new GG;Torus.prototype.constructor=Torus;
var Icosahedron=function(a){function b(w,t,n){var y=Math.sqrt(w*w+t*t+n*n);return f.vts.push(new Vertex(new v3(w/y,t/y,n/y)))-1}function c(w,t,n,y){y.faces.push(new Face3(w,t,n))}function d(w,t){var n=f.vts[w].ppos,y=f.vts[t].ppos;return b((n.x+y.x)/2,(n.y+y.y)/2,(n.z+y.z)/2)}var f=this,g=new GG,h;this.subdivisions=a||0;GG.call(this);a=(1+Math.sqrt(5))/2;b(-1,a,0);b(1,a,0);b(-1,-a,0);b(1,-a,0);b(0,-1,a);b(0,1,a);b(0,-1,-a);b(0,
1,-a);b(a,0,-1);b(a,0,1);b(-a,0,-1);b(-a,0,1);c(0,11,5,g);c(0,5,1,g);c(0,1,7,g);c(0,7,10,g);c(0,10,11,g);c(1,5,9,g);c(5,11,4,g);c(11,10,2,g);c(10,7,6,g);c(7,1,8,g);c(3,9,4,g);c(3,4,2,g);c(3,2,6,g);c(3,6,8,g);c(3,8,9,g);c(4,9,5,g);c(2,4,11,g);c(6,2,10,g);c(8,6,7,g);c(9,8,1,g);for(a=0;a<this.subdivisions;a++){h=new GG;for(var j in g.faces){var k=d(g.faces[j].a,g.faces[j].b),m=d(g.faces[j].b,g.faces[j].c),o=d(g.faces[j].c,g.faces[j].a);c(g.faces[j].a,k,o,h);c(g.faces[j].b,m,k,h);c(g.faces[j].c,
o,m,h);c(k,m,o,h)}g.faces=h.faces}f.faces=g.faces;delete g;delete h;this.cMpCentroids();this.cMpFaceNormals();this.cMpVertexNormals();this.sortFacesByMt()};Icosahedron.prototype=new GG;Icosahedron.prototype.constructor=Icosahedron;
function lO(a,b,c){GG.call(this);b=b||12;c=c||2*Math.PI;b=c/b;for(var d=[],f=[],g=[],h=[],j=0;j<a.length;j++){this.vts.push(new Vertex(a[j]));f[j]=this.vts.length-1;d[j]=new v3(a[j].x,a[j].y,a[j].z)}for(var k=m4.rtZMatrix(b),m=0;m<=c+0.0010;m+=b){for(j=0;j<d.length;j++)if(m<c){d[j]=k.mV3(d[j].clone());this.vts.push(new Vertex(d[j]));g[j]=this.vts.length-1}else g=h;if(m==0)h=f;for(j=0;j<f.length-1;j++){this.faces.push(new Face4(g[j],
g[j+1],f[j+1],f[j]));this.uvs.push([new UV(m/c,j/a.length),new UV(m/c,(j+1)/a.length),new UV((m-b)/c,(j+1)/a.length),new UV((m-b)/c,j/a.length)])}f=g;g=[]}this.cMpCentroids();this.cMpFaceNormals();this.cMpVertexNormals();this.sortFacesByMt()}lO.prototype=new GG;lO.prototype.constructor=lO;if(!window.Int32Array){window.Int32Array=Array;window.Float32Array=Array}
MarchingCubes=function(a,b){oB3D.call(this);this.mTs=b instanceof Array?b:[b];this.init=function(c){this.isolation=80;this.size=c;this.size2=this.size*this.size;this.size3=this.size2*this.size;this.halfsize=this.size/2;this.delta=2/this.size;this.yd=this.size;this.zd=this.size2;this.field=new Float32Array(this.size3);this.normal_cache=new Float32Array(this.size3*3);this.vlist=new Float32Array(36);this.nlist=new Float32Array(36);this.firstDraw=true;this.maxCount=4096;this.count=
0;this.hasNormal=this.hasPos=false;this.pposArray=new Float32Array(this.maxCount*3);this.normalArray=new Float32Array(this.maxCount*3)};this.lerp=function(c,d,f){return c+(d-c)*f};this.VIntX=function(c,d,f,g,h,j,k,m,o,w){h=(h-o)/(w-o);o=this.normal_cache;d[g]=j+h*this.delta;d[g+1]=k;d[g+2]=m;f[g]=this.lerp(o[c],o[c+3],h);f[g+1]=this.lerp(o[c+1],o[c+4],h);f[g+2]=this.lerp(o[c+2],o[c+5],h)};this.VIntY=function(c,d,f,g,h,j,k,m,o,w){h=(h-o)/(w-o);o=this.normal_cache;d[g]=j;d[g+1]=k+h*this.delta;d[g+
2]=m;d=c+this.yd*3;f[g]=this.lerp(o[c],o[d],h);f[g+1]=this.lerp(o[c+1],o[d+1],h);f[g+2]=this.lerp(o[c+2],o[d+2],h)};this.VIntZ=function(c,d,f,g,h,j,k,m,o,w){h=(h-o)/(w-o);o=this.normal_cache;d[g]=j;d[g+1]=k;d[g+2]=m+h*this.delta;d=c+this.zd*3;f[g]=this.lerp(o[c],o[d],h);f[g+1]=this.lerp(o[c+1],o[d+1],h);f[g+2]=this.lerp(o[c+2],o[d+2],h)};this.compNorm=function(c){var d=c*3;if(this.normal_cache[d]==0){this.normal_cache[d]=this.field[c-1]-this.field[c+1];this.normal_cache[d+1]=this.field[c-this.yd]-
this.field[c+this.yd];this.normal_cache[d+2]=this.field[c-this.zd]-this.field[c+this.zd]}};this.polygonize=function(c,d,f,g,h,j){var k=g+1,m=g+this.yd,o=g+this.zd,w=k+this.yd,t=k+this.zd,n=g+this.yd+this.zd,y=k+this.yd+this.zd,z=0,E=this.field[g],v=this.field[k],B=this.field[m],p=this.field[w],e=this.field[o],O=this.field[t],Z=this.field[n],I=this.field[y];if(E<h)z|=1;if(v<h)z|=2;if(B<h)z|=8;if(p<h)z|=4;if(e<h)z|=16;if(O<h)z|=32;if(Z<h)z|=128;if(I<h)z|=64;var L=edgeTable[z];if(L==0)return 0;
var X=this.delta,P=c+X,V=d+X;X=f+X;if(L&1){this.compNorm(g);this.compNorm(k);this.VIntX(g*3,this.vlist,this.nlist,0,h,c,d,f,E,v)}if(L&2){this.compNorm(k);this.compNorm(w);this.VIntY(k*3,this.vlist,this.nlist,3,h,P,d,f,v,p)}if(L&4){this.compNorm(m);this.compNorm(w);this.VIntX(m*3,this.vlist,this.nlist,6,h,c,V,f,B,p)}if(L&8){this.compNorm(g);this.compNorm(m);this.VIntY(g*3,this.vlist,this.nlist,9,h,c,d,f,E,B)}if(L&16){this.compNorm(o);this.compNorm(t);this.VIntX(o*3,this.vlist,this.nlist,12,h,c,d,X,
e,O)}if(L&32){this.compNorm(t);this.compNorm(y);this.VIntY(t*3,this.vlist,this.nlist,15,h,P,d,X,O,I)}if(L&64){this.compNorm(n);this.compNorm(y);this.VIntX(n*3,this.vlist,this.nlist,18,h,c,V,X,Z,I)}if(L&128){this.compNorm(o);this.compNorm(n);this.VIntY(o*3,this.vlist,this.nlist,21,h,c,d,X,e,Z)}if(L&256){this.compNorm(g);this.compNorm(o);this.VIntZ(g*3,this.vlist,this.nlist,24,h,c,d,f,E,e)}if(L&512){this.compNorm(k);this.compNorm(t);this.VIntZ(k*3,this.vlist,this.nlist,27,h,P,d,f,v,O)}if(L&1024){this.compNorm(w);
this.compNorm(y);this.VIntZ(w*3,this.vlist,this.nlist,30,h,P,V,f,p,I)}if(L&2048){this.compNorm(m);this.compNorm(n);this.VIntZ(m*3,this.vlist,this.nlist,33,h,c,V,f,B,Z)}z<<=4;for(h=g=0;triTable[z+h]!=-1;){c=z+h;d=c+1;f=c+2;this.posnormtriv(this.vlist,this.nlist,3*triTable[c],3*triTable[d],3*triTable[f],j);h+=3;g++}return g};this.posnormtriv=function(c,d,f,g,h,j){var k=this.count*3;this.pposArray[k]=c[f];this.pposArray[k+1]=c[f+1];this.pposArray[k+2]=c[f+2];this.pposArray[k+
3]=c[g];this.pposArray[k+4]=c[g+1];this.pposArray[k+5]=c[g+2];this.pposArray[k+6]=c[h];this.pposArray[k+7]=c[h+1];this.pposArray[k+8]=c[h+2];this.normalArray[k]=d[f];this.normalArray[k+1]=d[f+1];this.normalArray[k+2]=d[f+2];this.normalArray[k+3]=d[g];this.normalArray[k+4]=d[g+1];this.normalArray[k+5]=d[g+2];this.normalArray[k+6]=d[h];this.normalArray[k+7]=d[h+1];this.normalArray[k+8]=d[h+2];this.hasNormal=this.hasPos=true;this.count+=3;this.count>=this.maxCount-3&&j(this)};this.begin=
function(){this.count=0;this.hasNormal=this.hasPos=false};this.end=function(c){if(this.count!=0){for(var d=this.count*3;d<this.pposArray.length;d++)this.pposArray[d]=0;c(this)}};this.addBall=function(c,d,f,g,h){var j=this.size*Math.sqrt(g/h),k=f*this.size,m=d*this.size,o=c*this.size,w=Math.floor(k-j);if(w<1)w=1;k=Math.floor(k+j);if(k>this.size-1)k=this.size-1;var t=Math.floor(m-j);if(t<1)t=1;m=Math.floor(m+j);if(m>this.size-1)m=this.size-1;var n=Math.floor(o-j);if(n<1)n=1;j=Math.floor(o+j);
if(j>this.size-1)j=this.size-1;for(var y,z,E,v,B,p;w<k;w++){o=this.size2*w;z=w/this.size-f;B=z*z;for(z=t;z<m;z++){E=o+this.size*z;y=z/this.size-d;p=y*y;for(y=n;y<j;y++){v=y/this.size-c;v=g/(1.0E-6+v*v+p+B)-h;if(v>0)this.field[E+y]+=v}}}};this.addPlaneX=function(c,d){var f,g,h,j,k,m=this.size,o=this.yd,w=this.zd,t=this.field,n=m*Math.sqrt(c/d);if(n>m)n=m;for(f=0;f<n;f++){g=f/m;g*=g;j=c/(1.0E-4+g)-d;if(j>0)for(g=0;g<m;g++){k=f+g*o;for(h=0;h<m;h++)t[w*h+k]+=j}}};this.addPlaneY=function(c,d){var f,g,
h,j,k,m,o=this.size,w=this.yd,t=this.zd,n=this.field,y=o*Math.sqrt(c/d);if(y>o)y=o;for(g=0;g<y;g++){f=g/o;f*=f;j=c/(1.0E-4+f)-d;if(j>0){k=g*w;for(f=0;f<o;f++){m=k+f;for(h=0;h<o;h++)n[t*h+m]+=j}}}};this.addPlaneZ=function(c,d){var f,g,h,j,k,m;size=this.size;yd=this.yd;zd=this.zd;field=this.field;dist=size*Math.sqrt(c/d);if(dist>size)dist=size;for(h=0;h<dist;h++){f=h/size;f*=f;j=c/(1.0E-4+f)-d;if(j>0){k=zd*h;for(g=0;g<size;g++){m=k+g*yd;for(f=0;f<size;f++)field[m+f]+=j}}}};this.reset=function(){var c;
for(c=0;c<this.size3;c++){this.normal_cache[c*3]=0;this.field[c]=0}};this.render=function(c){this.begin();var d,f,g,h,j,k,m,o,w,t=this.size-2;for(h=1;h<t;h++){w=this.size2*h;m=(h-this.halfsize)/this.halfsize;for(g=1;g<t;g++){o=w+this.size*g;k=(g-this.halfsize)/this.halfsize;for(f=1;f<t;f++){j=(f-this.halfsize)/this.halfsize;d=o+f;this.polygonize(j,k,m,d,this.isolation,c)}}}this.end(c)};this.generateGG=function(){var c=0,d=new GG;this.render(function(f){var g,h,j,k,m,o,w,t;for(g=
0;g<f.count;g++){m=g*3;w=m+1;t=m+2;h=f.pposArray[m];j=f.pposArray[w];k=f.pposArray[t];o=new v3(h,j,k);h=f.normalArray[m];j=f.normalArray[w];k=f.normalArray[t];m=new v3(h,j,k);m.normalize();m=new Vertex(o,m);d.vts.push(m)}nfaces=f.count/3;for(g=0;g<nfaces;g++){m=(c+g)*3;w=m+1;t=m+2;o=d.vts[m].normal;h=d.vts[w].normal;j=d.vts[t].normal;m=new Face3(m,w,t,[o,h,j]);d.faces.push(m)}c+=nfaces;f.count=0});d.sortFacesByMt();return d};
this.init(a)};MarchingCubes.prototype=new oB3D;MarchingCubes.prototype.constructor=MarchingCubes;
edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,
1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,
419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);
triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,
-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,
-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,
-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,
8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,
-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,
5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,
-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,
10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,
6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,
8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,
2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,
-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,
-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,
-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,
-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,
2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,
4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,
-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,
2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);Loader=function(a){this.statusDomElement=(this.showStatus=a)?this.addStatusElement():null};
Loader.prototype={addStatusElement:function(){var a=document.createElement("div");a.style.fontSize="0.8em";a.style.textAlign="left";a.style.background="#b00";a.style.color="#fff";a.style.width="140px";a.style.padding="0.25em 0.25em 0.25em 0.5em";a.style.ppos="absolute";a.style.right="0px";a.style.top="0px";a.style.zIndex=1E3;a.innerHTML="Loading ...";return a},updateProgress:function(a){var b="Loaded ";b+=a.total?(100*a.loaded/a.total).toFixed(0)+"%":(a.loaded/1E3).toFixed(2)+" KB";this.statusDomElement.innerHTML=
b},loadAsciiOld:function(a,b){var c=document.createElement("script");c.type="text/javascript";c.onload=b;c.src=a;document.getElementsByTagName("head")[0].appendChild(c)},loadAscii:function(a){var b=a.model,c=a.callback,d=a.texture_path?a.texture_path:Loader.prototype.extractUrlbase(b);a=(new Date).getTime();b=new Worker(b);b.onmessage=function(f){Loader.prototype.CrModel(f.data,c,d)};b.postMessage(a)},loadBinary:function(a){var b=a.model,c=a.callback,d=a.texture_path?a.texture_path:
Loader.prototype.extractUrlbase(b),f=a.bin_path?a.bin_path:Loader.prototype.extractUrlbase(b);a=(new Date).getTime();b=new Worker(b);var g=this.showProgress?Loader.prototype.updateProgress:null;b.onmessage=function(h){Loader.prototype.loadAjaxBuffers(h.data.buffers,h.data.mTs,c,f,d,g)};b.onerror=function(h){alert("worker.onerror: "+h.message+"\n"+h.data);h.preventDefault()};b.postMessage(a)},loadAjaxBuffers:function(a,b,c,d,f,g){var h=new XMLHttpRequest,j=d+"/"+a,k=0;
h.onreadystatechange=function(){if(h.readyState==4)h.status==200||h.status==0?Loader.prototype.CrBinModel(h.responseText,c,f,b):alert("Couldn't load ["+j+"] ["+h.status+"]");else if(h.readyState==3){if(g){if(k==0)k=h.getResponseHeader("Content-Length");g({total:k,loaded:h.responseText.length})}}else if(h.readyState==2)k=h.getResponseHeader("Content-Length")};h.open("GET",j,true);h.overrideMimeType("text/plain; charset=x-user-defined");h.setRequestHeader("Content-Type","text/plain");h.send(null)},
CrBinModel:function(a,b,c,d){var f=function(g){function h(C,M){var K=o(C,M),R=o(C,M+1),da=o(C,M+2),$=o(C,M+3),la=($<<1&255|da>>7)-127;K=(da&127)<<16|R<<8|K;if(K==0&&la==-127)return 0;return(1-2*($>>7))*(1+K*Math.pow(2,-23))*Math.pow(2,la)}function j(C,M){var K=o(C,M),R=o(C,M+1),da=o(C,M+2);return(o(C,M+3)<<24)+(da<<16)+(R<<8)+K}function k(C,M){var K=o(C,M);return(o(C,M+1)<<8)+K}function m(C,M){var K=o(C,M);return K>127?K-256:K}function o(C,M){return C.charCodeAt(M)&255}function w(C){var M,K,R;
M=j(a,C);K=j(a,C+Z);R=j(a,C+I);C=k(a,C+L);Loader.prototype.f3(v,M,K,R,C)}function t(C){var M,K,R,da,$,la;M=j(a,C);K=j(a,C+Z);R=j(a,C+I);da=k(a,C+L);$=j(a,C+X);la=j(a,C+P);C=j(a,C+V);Loader.prototype.f3n(v,e,M,K,R,da,$,la,C)}function n(C){var M,K,R,da;M=j(a,C);K=j(a,C+W);R=j(a,C+J);da=j(a,C+Q);C=k(a,C+fa);Loader.prototype.f4(v,M,K,R,da,C)}function y(C){var M,K,R,da,$,la,ra,wa;M=j(a,C);K=j(a,C+W);R=j(a,C+J);da=j(a,C+Q);$=k(a,C+fa);la=j(a,C+U);ra=j(a,C+ea);wa=j(a,C+l);C=j(a,C+x);Loader.prototype.f4n(v,
e,M,K,R,da,$,la,ra,wa,C)}function z(C){var M,K;M=j(a,C);K=j(a,C+A);C=j(a,C+u);Loader.prototype.uv3(v.uvs,O[M*2],O[M*2+1],O[K*2],O[K*2+1],O[C*2],O[C*2+1])}function E(C){var M,K,R;M=j(a,C);K=j(a,C+q);R=j(a,C+G);C=j(a,C+N);Loader.prototype.uv4(v.uvs,O[M*2],O[M*2+1],O[K*2],O[K*2+1],O[R*2],O[R*2+1],O[C*2],O[C*2+1])}var v=this,B=0,p,e=[],O=[],Z,I,L,X,P,V,W,J,Q,fa,U,ea,l,x,A,u,q,G,N,H,F,D,S,ba,ha;GG.call(this);Loader.prototype.init_mTs(v,d,g);p={signature:a.substr(B,8),
header_bytes:o(a,B+8),vertex_coordinate_bytes:o(a,B+9),normal_coordinate_bytes:o(a,B+10),uv_coordinate_bytes:o(a,B+11),vertex_index_bytes:o(a,B+12),normal_index_bytes:o(a,B+13),uv_index_bytes:o(a,B+14),material_index_bytes:o(a,B+15),nvts:j(a,B+16),nnormals:j(a,B+16+4),nuvs:j(a,B+16+8),ntri_flat:j(a,B+16+12),ntri_smooth:j(a,B+16+16),ntri_flat_uv:j(a,B+16+20),ntri_smooth_uv:j(a,B+16+24),nquad_flat:j(a,B+16+28),nquad_smooth:j(a,B+16+32),nquad_flat_uv:j(a,B+16+36),nquad_smooth_uv:j(a,B+16+40)};B+=
p.header_bytes;Z=p.vertex_index_bytes;I=p.vertex_index_bytes*2;L=p.vertex_index_bytes*3;X=p.vertex_index_bytes*3+p.material_index_bytes;P=p.vertex_index_bytes*3+p.material_index_bytes+p.normal_index_bytes;V=p.vertex_index_bytes*3+p.material_index_bytes+p.normal_index_bytes*2;W=p.vertex_index_bytes;J=p.vertex_index_bytes*2;Q=p.vertex_index_bytes*3;fa=p.vertex_index_bytes*4;U=p.vertex_index_bytes*4+p.material_index_bytes;ea=p.vertex_index_bytes*4+p.material_index_bytes+p.normal_index_bytes;l=p.vertex_index_bytes*
4+p.material_index_bytes+p.normal_index_bytes*2;x=p.vertex_index_bytes*4+p.material_index_bytes+p.normal_index_bytes*3;A=p.uv_index_bytes;u=p.uv_index_bytes*2;q=p.uv_index_bytes;G=p.uv_index_bytes*2;N=p.uv_index_bytes*3;g=p.vertex_index_bytes*3+p.material_index_bytes;ha=p.vertex_index_bytes*4+p.material_index_bytes;H=p.ntri_flat*g;F=p.ntri_smooth*(g+p.normal_index_bytes*3);D=p.ntri_flat_uv*(g+p.uv_index_bytes*3);S=p.ntri_smooth_uv*(g+p.normal_index_bytes*3+p.uv_index_bytes*3);ba=p.nquad_flat*ha;g=
p.nquad_smooth*(ha+p.normal_index_bytes*4);ha=p.nquad_flat_uv*(ha+p.uv_index_bytes*4);B+=function(C){for(var M,K,R,da=p.vertex_coordinate_bytes*3,$=C+p.nvts*da;C<$;C+=da){M=h(a,C);K=h(a,C+p.vertex_coordinate_bytes);R=h(a,C+p.vertex_coordinate_bytes*2);Loader.prototype.v(v,M,K,R)}return p.nvts*da}(B);B+=function(C){for(var M,K,R,da=p.normal_coordinate_bytes*3,$=C+p.nnormals*da;C<$;C+=da){M=m(a,C);K=m(a,C+p.normal_coordinate_bytes);R=m(a,C+p.normal_coordinate_bytes*2);e.push(M/127,K/
127,R/127)}return p.nnormals*da}(B);B+=function(C){for(var M,K,R=p.uv_coordinate_bytes*2,da=C+p.nuvs*R;C<da;C+=R){M=h(a,C);K=h(a,C+p.uv_coordinate_bytes);O.push(M,K)}return p.nuvs*R}(B);B=B;H=B+H;F=H+F;D=F+D;S=D+S;ba=S+ba;g=ba+g;ha=g+ha;(function(C){var M,K=p.vertex_index_bytes*3+p.material_index_bytes,R=K+p.uv_index_bytes*3,da=C+p.ntri_flat_uv*R;for(M=C;M<da;M+=R){w(M);z(M+K)}return da-C})(F);(function(C){var M,K=p.vertex_index_bytes*3+p.material_index_bytes+p.normal_index_bytes*3,R=K+p.uv_index_bytes*
3,da=C+p.ntri_smooth_uv*R;for(M=C;M<da;M+=R){t(M);z(M+K)}return da-C})(D);(function(C){var M,K=p.vertex_index_bytes*4+p.material_index_bytes,R=K+p.uv_index_bytes*4,da=C+p.nquad_flat_uv*R;for(M=C;M<da;M+=R){n(M);E(M+K)}return da-C})(g);(function(C){var M,K=p.vertex_index_bytes*4+p.material_index_bytes+p.normal_index_bytes*4,R=K+p.uv_index_bytes*4,da=C+p.nquad_smooth_uv*R;for(M=C;M<da;M+=R){y(M);E(M+K)}return da-C})(ha);(function(C){var M,K=p.vertex_index_bytes*3+p.material_index_bytes,R=C+p.ntri_flat*
K;for(M=C;M<R;M+=K)w(M);return R-C})(B);(function(C){var M,K=p.vertex_index_bytes*3+p.material_index_bytes+p.normal_index_bytes*3,R=C+p.ntri_smooth*K;for(M=C;M<R;M+=K)t(M);return R-C})(H);(function(C){var M,K=p.vertex_index_bytes*4+p.material_index_bytes,R=C+p.nquad_flat*K;for(M=C;M<R;M+=K)n(M);return R-C})(S);(function(C){var M,K=p.vertex_index_bytes*4+p.material_index_bytes+p.normal_index_bytes*4,R=C+p.nquad_smooth*K;for(M=C;M<R;M+=K)y(M);return R-C})(ba);this.cMpCentroids();this.cMpFaceNormals();
this.sortFacesByMt()};f.prototype=new GG;f.prototype.constructor=f;b(new f(c))},CrModel:function(a,b,c){var d=function(f){var g=this;GG.call(this);Loader.prototype.init_mTs(g,a.mTs,f);(function(){var h,j,k,m,o;h=0;for(j=a.vts.length;h<j;h+=3){k=a.vts[h];m=a.vts[h+1];o=a.vts[h+2];Loader.prototype.v(g,k,m,o)}if(a.colors){h=0;for(j=a.colors.length;h<j;h+=3){k=a.colors[h];m=a.colors[h+1];o=a.colors[h+2];Loader.prototype.vc(g,
k,m,o)}}})();(function(){function h(y,z){Loader.prototype.f3(g,y[z],y[z+1],y[z+2],y[z+3])}function j(y,z){Loader.prototype.f3n(g,a.normals,y[z],y[z+1],y[z+2],y[z+3],y[z+4],y[z+5],y[z+6])}function k(y,z){Loader.prototype.f4(g,y[z],y[z+1],y[z+2],y[z+3],y[z+4])}function m(y,z){Loader.prototype.f4n(g,a.normals,y[z],y[z+1],y[z+2],y[z+3],y[z+4],y[z+5],y[z+6],y[z+7],y[z+8])}function o(y,z){var E,v,B,p,e,O,Z,I,L;E=y[z];v=y[z+1];B=y[z+2];p=a.uvs[E*2];Z=a.uvs[E*2+1];e=a.uvs[v*2];I=a.uvs[v*
2+1];O=a.uvs[B*2];L=a.uvs[B*2+1];Loader.prototype.uv3(g.uvs,p,Z,e,I,O,L);if(a.uvs2){p=a.uvs2[E*2];Z=a.uvs2[E*2+1];e=a.uvs2[v*2];I=a.uvs2[v*2+1];O=a.uvs2[B*2];L=a.uvs2[B*2+1];Loader.prototype.uv3(g.uvs2,p,1-Z,e,1-I,O,1-L)}}function w(y,z){var E,v,B,p,e,O,Z,I,L,X,P,V;E=y[z];v=y[z+1];B=y[z+2];p=y[z+3];e=a.uvs[E*2];L=a.uvs[E*2+1];O=a.uvs[v*2];X=a.uvs[v*2+1];Z=a.uvs[B*2];P=a.uvs[B*2+1];I=a.uvs[p*2];V=a.uvs[p*2+1];Loader.prototype.uv4(g.uvs,e,L,O,X,Z,P,I,V);if(a.uvs2){e=a.uvs2[E*2];L=
a.uvs2[E*2+1];O=a.uvs2[v*2];X=a.uvs2[v*2+1];Z=a.uvs2[B*2];P=a.uvs2[B*2+1];I=a.uvs2[p*2];V=a.uvs2[p*2+1];Loader.prototype.uv4(g.uvs2,e,1-L,O,1-X,Z,1-P,I,1-V)}}var t,n;t=0;for(n=a.triangles_uv.length;t<n;t+=7){h(a.triangles_uv,t);o(a.triangles_uv,t+4)}t=0;for(n=a.triangles_n_uv.length;t<n;t+=10){j(a.triangles_n_uv,t);o(a.triangles_n_uv,t+7)}t=0;for(n=a.quads_uv.length;t<n;t+=9){k(a.quads_uv,t);w(a.quads_uv,t+5)}t=0;for(n=a.quads_n_uv.length;t<n;t+=13){m(a.quads_n_uv,t);w(a.quads_n_uv,t+9)}t=0;
for(n=a.triangles.length;t<n;t+=4)h(a.triangles,t);t=0;for(n=a.triangles_n.length;t<n;t+=7)j(a.triangles_n,t);t=0;for(n=a.quads.length;t<n;t+=5)k(a.quads,t);t=0;for(n=a.quads_n.length;t<n;t+=9)m(a.quads_n,t)})();this.cMpCentroids();this.cMpFaceNormals();this.sortFacesByMt()};d.prototype=new GG;d.prototype.constructor=d;b(new d(c))},v:function(a,b,c,d){a.vts.push(new Vertex(new v3(b,c,d)))},vc:function(a,b,c,d){var f=new Color(16777215);f.setRGB(b,
c,d);a.colors.push(f)},f3:function(a,b,c,d,f){a.faces.push(new Face3(b,c,d,null,a.mTs[f]))},f4:function(a,b,c,d,f,g){a.faces.push(new Face4(b,c,d,f,null,a.mTs[g]))},f3n:function(a,b,c,d,f,g,h,j,k){g=a.mTs[g];var m=b[j*3],o=b[j*3+1];j=b[j*3+2];var w=b[k*3],t=b[k*3+1];k=b[k*3+2];a.faces.push(new Face3(c,d,f,[new v3(b[h*3],b[h*3+1],b[h*3+2]),new v3(m,o,j),new v3(w,t,k)],g))},f4n:function(a,b,c,d,f,g,h,j,k,m,o){h=a.mTs[h];var w=
b[k*3],t=b[k*3+1];k=b[k*3+2];var n=b[m*3],y=b[m*3+1];m=b[m*3+2];var z=b[o*3],E=b[o*3+1];o=b[o*3+2];a.faces.push(new Face4(c,d,f,g,[new v3(b[j*3],b[j*3+1],b[j*3+2]),new v3(w,t,k),new v3(n,y,m),new v3(z,E,o)],h))},uv3:function(a,b,c,d,f,g,h){var j=[];j.push(new UV(b,c));j.push(new UV(d,f));j.push(new UV(g,h));a.push(j)},uv4:function(a,b,c,d,f,g,h,j,k){var m=[];m.push(new UV(b,c));m.push(new UV(d,f));m.push(new UV(g,
h));m.push(new UV(j,k));a.push(m)},init_mTs:function(a,b,c){a.mTs=[];for(var d=0;d<b.length;++d)a.mTs[d]=[Loader.prototype.CrMt(b[d],c)]},CrMt:function(a,b){function c(j){j=Math.log(j)/Math.LN2;return Math.floor(j)==j}function d(j,k){var m=new Image;m.onload=function(){if(!c(this.width)||!c(this.height)){var o=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),w=Math.pow(2,Math.round(Math.log(this.height)/Math.LN2));j.image.width=o;j.image.height=
w;j.image.getContext("2d").drawImage(this,0,0,o,w)}else j.image=this;j.image.loaded=1};m.src=k}var f,g,h;f="mLm";g={color:15658734,op:1,map:null,light_map:null,vertex_colors:a.vertex_colors};if(a.shading)if(a.shading=="Phong")f="mQm";if(a.map_diffuse&&b){h=document.createElement("canvas");g.map=new Texture(h);d(g.map,b+"/"+a.map_diffuse)}else if(a.col_diffuse){h=(a.col_diffuse[0]*255<<16)+(a.col_diffuse[1]*255<<8)+a.col_diffuse[2]*255;g.color=h;g.op=a.transparency}else if(a.a_dbg_color)g.color=
a.a_dbg_color;if(a.map_lightmap&&b){h=document.createElement("canvas");g.light_map=new Texture(h);d(g.light_map,b+"/"+a.map_lightmap)}return new THREE[f](g)},extractUrlbase:function(a){a=a.split("/");a.pop();return a.join("/")}};var Stats=function(){function a(U,ea,l){var x,A,u;for(A=0;A<30;A++)for(x=0;x<73;x++){u=(x+A*74)*4;U[u]=U[u+4];U[u+1]=U[u+5];U[u+2]=U[u+6]}for(A=0;A<30;A++){u=(73+A*74)*4;if(A<ea){U[u]=Q[l].bg.r;U[u+1]=Q[l].bg.g;U[u+2]=Q[l].bg.b}else{U[u]=Q[l].fg.r;U[u+1]=Q[l].fg.g;U[u+2]=Q[l].fg.b}}}var b=0,c=2,d,f=0,g=(new Date).getTime(),h=g,j=g,k=0,m=1E3,o=0,w,t,n,y,z,E=0,v=1E3,B=0,p,e,O,Z,I=0,L=1E3,X=0,P,V,W,J,Q={fps:{bg:{r:16,g:16,b:48},fg:{r:0,g:255,b:255}},ms:{bg:{r:16,g:48,b:16},fg:{r:0,g:255,b:0}},mem:{bg:{r:48,
g:16,b:26},fg:{r:255,g:0,b:128}}};d=document.createElement("div");d.style.cursor="pointer";d.style.width="80px";d.style.op="0.9";d.style.zIndex="10001";d.addEventListener("click",function(){b++;b==c&&(b=0);w.style.display="none";p.style.display="none";P.style.display="none";switch(b){case 0:w.style.display="block";break;case 1:p.style.display="block";break;case 2:P.style.display="block"}},false);w=document.createElement("div");w.style.backgroundColor="rgb("+Math.floor(Q.fps.bg.r/2)+","+Math.floor(Q.fps.bg.g/
2)+","+Math.floor(Q.fps.bg.b/2)+")";w.style.padding="2px 0px 3px 0px";d.appendChild(w);t=document.createElement("div");t.style.fontFamily="Helvetica, Arial, sans-serif";t.style.textAlign="left";t.style.fontSize="9px";t.style.color="rgb("+Q.fps.fg.r+","+Q.fps.fg.g+","+Q.fps.fg.b+")";t.style.margin="0px 0px 1px 3px";t.innerHTML='<span style="font-weight:bold">FPS</span>';w.appendChild(t);n=document.createElement("canvas");n.width=74;n.height=30;n.style.display="block";n.style.marginLeft="3px";w.appendChild(n);
y=n.getContext("2d");y.fillStyle="rgb("+Q.fps.bg.r+","+Q.fps.bg.g+","+Q.fps.bg.b+")";y.fillRect(0,0,n.width,n.height);z=y.getImageData(0,0,n.width,n.height);p=document.createElement("div");p.style.backgroundColor="rgb("+Math.floor(Q.ms.bg.r/2)+","+Math.floor(Q.ms.bg.g/2)+","+Math.floor(Q.ms.bg.b/2)+")";p.style.padding="2px 0px 3px 0px";p.style.display="none";d.appendChild(p);e=document.createElement("div");e.style.fontFamily="Helvetica, Arial, sans-serif";e.style.textAlign="left";e.style.fontSize=
"9px";e.style.color="rgb("+Q.ms.fg.r+","+Q.ms.fg.g+","+Q.ms.fg.b+")";e.style.margin="0px 0px 1px 3px";e.innerHTML='<span style="font-weight:bold">MS</span>';p.appendChild(e);n=document.createElement("canvas");n.width=74;n.height=30;n.style.display="block";n.style.marginLeft="3px";p.appendChild(n);O=n.getContext("2d");O.fillStyle="rgb("+Q.ms.bg.r+","+Q.ms.bg.g+","+Q.ms.bg.b+")";O.fillRect(0,0,n.width,n.height);Z=O.getImageData(0,0,n.width,n.height);try{if(webkitPerformance&&webkitPerformance.memory.totalJSHeapSize)c=
3}catch(fa){}P=document.createElement("div");P.style.backgroundColor="rgb("+Math.floor(Q.mem.bg.r/2)+","+Math.floor(Q.mem.bg.g/2)+","+Math.floor(Q.mem.bg.b/2)+")";P.style.padding="2px 0px 3px 0px";P.style.display="none";d.appendChild(P);V=document.createElement("div");V.style.fontFamily="Helvetica, Arial, sans-serif";V.style.textAlign="left";V.style.fontSize="9px";V.style.color="rgb("+Q.mem.fg.r+","+Q.mem.fg.g+","+Q.mem.fg.b+")";V.style.margin="0px 0px 1px 3px";V.innerHTML='<span style="font-weight:bold">MEM</span>';
P.appendChild(V);n=document.createElement("canvas");n.width=74;n.height=30;n.style.display="block";n.style.marginLeft="3px";P.appendChild(n);W=n.getContext("2d");W.fillStyle="#301010";W.fillRect(0,0,n.width,n.height);J=W.getImageData(0,0,n.width,n.height);return{domElement:d,update:function(){f++;g=(new Date).getTime();E=g-h;v=Math.min(v,E);B=Math.max(B,E);a(Z.data,Math.min(30,30-E/200*30),"ms");e.innerHTML='<span style="font-weight:bold">'+E+" MS</span> ("+v+"-"+B+")";O.putImageData(Z,0,0);h=g;if(g>
j+1E3){k=Math.round(f*1E3/(g-j));m=Math.min(m,k);o=Math.max(o,k);a(z.data,Math.min(30,30-k/100*30),"fps");t.innerHTML='<span style="font-weight:bold">'+k+" FPS</span> ("+m+"-"+o+")";y.putImageData(z,0,0);if(c==3){I=webkitPerformance.memory.usedJSHeapSize*9.54E-7;L=Math.min(L,I);X=Math.max(X,I);a(J.data,Math.min(30,30-I/2),"mem");V.innerHTML='<span style="font-weight:bold">'+Math.round(I)+" MEM</span> ("+Math.round(L)+"-"+Math.round(X)+")";W.putImageData(J,0,0)}j=g;f=0}}}};(function(a,b,c,d,f,g,h){function j(o){var w,t,n=this,y=o.length,z=0,E=n.i=n.j=n.m=0;n.S=[];n.c=[];for(y||(o=[y++]);z<c;)n.S[z]=z++;for(z=0;z<c;z++){w=n.S[z];E=E+w+o[z%y]&c-1;t=n.S[E];n.S[z]=t;n.S[E]=w}n.g=function(v){var B=n.S,p=n.i+1&c-1,e=B[p],O=n.j+e&c-1,Z=B[O];B[p]=Z;B[O]=e;for(var I=B[e+Z&c-1];--v;){p=p+1&c-1;e=B[p];O=O+e&c-1;Z=B[O];B[p]=Z;B[O]=e;I=I*c+B[e+Z&c-1]}n.i=p;n.j=O;return I};n.g(c)}function k(o,w,t,n){t=[];if(w&&typeof o=="object")for(n in o)if(n.indexOf("S")<5)try{t.push(k(o[n],w-
1))}catch(y){}return t.length?t:""+o}function m(o,w,t,n){o+="";for(n=t=0;n<o.length;n++){var y=w,z=n&c-1,E=(t^=w[n&c-1]*19)+o.charCodeAt(n);y[z]=E&c-1}o="";for(n in w)o+=String.fromCharCode(w[n]);return o}b.seedrandom=function(o,w){var t=[],n;o=m(k(w?[o,a]:arguments.length?o:[(new Date).getTime(),a,window],3),t);n=new j(t);m(n.S,a);b.random=function(){for(var y=n.g(d),z=h,E=0;y<f;){y=(y+E)*c;z*=c;E=n.g(1)}for(;y>=g;){y/=2;z/=2;E>>>=1}return(y+E)/z};return o};h=b.pow(c,d);f=b.pow(2,f);g=f*2;m(b.random(),
a)})([],Math,256,6,52);function rnd(){return Math.random()}function rndV(){return new v3(rnd(),rnd(),rnd())}function rndV2(){tempV.set(rnd(),rnd(),rnd());return tempV}function gup(a){a=RegExp("[\\?&]"+a+"=([^&#]*)").exec(window.location.href);if(a!=null)return a[1];return null}function ibc(){try{new Float32Array(1)}catch(a){return false}return true}function time(){return(new Date).getTime()}var aq="L",cpu=gup("cpu");if(cpu==null)cpu="default";
if(cpu=="default"){starsBgImage=undefined;nstars=2E4}else if(cpu=="fast"){starsBgImage="textures/stars_blend.jpg";nstars=2E4}else if(cpu=="medium"){starsBgImage="textures/stars_blend2.jpg";nstars=2E3}else if(cpu=="slow"){starsBgImage="textures/stars_blend3.jpg";nstars=0}
function dec(a){var b="",c,d,f,g,h,j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;){c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(j++));d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(j++));g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(j++));h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(j++));c=c<<2|d>>4;d=(d&15)<<4|g>>2;f=(g&3)<<
6|h;b+=String.fromCharCode(c);if(g!=64)b+=String.fromCharCode(d);if(h!=64)b+=String.fromCharCode(f)}return b}function debug(a){document.getElementById("debug").innerHTML=a}function show(a){document.getElementById(a).style.display=""}function hide(a){document.getElementById(a).style.display="none"}var Ws=gup("size");if(Ws==null)Ws=10;var nASs=gup("nast");if(nASs==null)nASs=100;var speed=gup("speed");if(speed==null)speed=5;
var _AS=1,_sH=2,_UFO=3,_Tr=4,_E=5,_M=6,starFaces=[new Face3(0,1,2),new Face3(2,1,0)];function Star(a){GG.call(this);this.vts=[new Vertex(new v3(0,0,0)),new Vertex(new v3(a,0,0)),new Vertex(new v3(a/2,-a/2,0))];this.faces=starFaces}Star.prototype=new GG;Star.prototype.constructor=Star;aq+="2";function lI(a){var b=new Image;b.onload=function(){this.loaded=true};b.src=a;return b}
function lT(a,b,c){image=lI(a);a=c!==undefined?NearestFilter:LinearFilter;return new mLm({color:b,shading:SmoothShading,map:new Texture(image,new UVMapping,ClampToEdgeWrapping,NearestFilter,a)})}function prepoB(a){a.um();a.aum=false;scene.addoB(a)}aq+="p";
function CrRenderer(a){if(a==0)renderer=new WebGLRenderer({scene:scene});renderer.setSize(window.innerWidth,window.innerHeight);container=document.getElementById("main_canvas");container.appendChild(renderer.domElement);renderer.type=a;return renderer}var CC,CCFollowssH,scene,renderer,score=0,maxScore=-999999,nsHs=-1,nUFOs=0,EE=1E4,ww=window.location.href,UTime,E,M,sH,ASs=[],ASCount=[0,0,0],container,stats,tempV=new v3,tempM=new m4;
aq+="h";
function ia(){if(nASs==undefined)nASs=40;hide("gameOver");document.getElementById("gameOver").innerHTML="Game Over!";CCFollowssH=true;CC=new Camera(60,window.innerWidth/window.innerHeight,1,12505*Ws);CC.ppos.set(0,130*Ws,1E3*Ws);CC.rt=new v3(0,Math.sin(CC.ppos.y/CC.ppos.z),0);CC.aum=false;CC.um();scene=new Scene;CrStars(nstars,true,starsBgImage!==undefined);
scene.addLight(new AmbientLight(2236962));var a=new DirectionalLight(15663069,1.6);a.ppos.set(1,1,1);scene.addLight(a);a=new SS(1,12,12);var b=new Mesh(a,new mBm({color:15663069,ambient:15663069}));b.sC.set(200,200,200).ms(Ws);b.ppos.set(4500,4500,4500).ms(Ws);prepoB(b);b=lT("textures/land_ocean_ice_cloud_1024.jpg",16777215);E=new Mesh(a,b);E.sC.set(100,100,100).ms(Ws);
E.rt.x=Math.sin(26*Math.PI/180);E.cT=_E;E.gG.cMpBoundingSS();cMpCOM(E);prepoB(E);M=new Mesh(a,lT("textures/JVV.Moon2.jpg",16777215,true));M.sC.set(30,30,30).ms(Ws);M.ppos.x=500*Ws;M.orbitAngle=0;M.cT=_M;M.gG.cMpBoundingSS();cMpCOM(M);prepoB(M);for(a=0;a<nASs;a++)CrAS(Math.floor(rnd()*2.99));updateAstCount();nsHs=3;sH=
CrsH();sH.ppos.z=800*Ws;sH.um();sH.rot=new v3;UTime=time()+3E4*Math.random()+2E4;renderer=CrRenderer(0);document.addEventListener("mousemove",onDocumentMouseMove,false);document.addEventListener("mousedown",onDocumentMouseDown,false);document.addEventListener("mouseup",onDocumentMouseUp,false);document.addEventListener("keydown",onDocumentKeyDown,false);document.addEventListener("keyup",onDocumentKeyUp,false);setInterval(la,25);CrEx(tempV.set(0,
0,0),{nShards:0,color:0,maxDist:10,doLight:false}).sC.set(0.01,0.01,0.01);stats=new Stats;stats.domElement.style.position="absolute";stats.domElement.style.top="0px";container.appendChild(stats.domElement);is(0);document.getElementById("Lives").innerHTML="Lives: "+nsHs;document.getElementById("UFOs").innerHTML="UFOs: "+nUFOs;document.getElementById("Energy").innerHTML="Energy: "+EE}var ASTextures=[],ASGeoms=[[],[],[]];aq+="c";
function CrAS(a){for(var b=null,c=0;c<ASs.length;c++)if(!ASs[c].vs&&ASs[c].index==a){b=ASs[c];b.vs=true;break}if(b==null){radius=60;color=11158698;nVerts=10;if(a==0){color=11184708;radius=20;nVerts=4}else if(a==1){color=4500138;radius=40;nVerts=8}else if(a==2){color=11158698;radius=60;nVerts=10}if(ASTextures[a]==null)ASTextures[a]=lT("textures/meteor2.jpg",color);if(ASGeoms[a].length>5)b=ASGeoms[a][Math.floor(rnd()*5)];else{b=
ASGeoms[a][ASGeoms[a].length]=new SS(1,nVerts,nVerts);for(c=0;c<b.vts.length;c++)b.vts[c].ppos.mS(rndV2().aSc(-0.5).ms(0.75).aSc(1));b.cMpCentroids();b.cMpFaceNormals();b.cMpVertexNormals();b.sortFacesByMt();b.cMpBoundingSS()}b=new Mesh(b,ASTextures[a]);b.sC.set(rnd(),rnd(),rnd()).aSc(-0.5).ms(1).aSc(1);b.sC.setLength(radius*Math.sqrt(Ws));b.ppos.set(rnd(),
rnd(),rnd()).aSc(-0.5).setLength(2E3*Ws);b.rt.set(rnd(),rnd(),rnd()).aSc(-0.5).setLength(2);b.V=rndV().aSc(-0.5);b.V.ms(100/radius*speed);b.rV=(rnd()+0.5)*2/radius;if(rnd()<0.5)b.rV*=-1;b.rA=rnd()*2*Math.PI;b.rotAxis=rndV().normalize();b.index=a;b.cT=_AS;cMpCOM(b);ASs.push(b);b.color=color;b.vs=true}ASCount[b.index]++;prepoB(b);return b}aq+="3";
function CrsH(){var a=[new v3(0,0.0010,-0.9),new v3(0.02,0,-0.89),new v3(0.02,0,-0.8),new v3(0.2,0,-0.7),new v3(0.26,0,-0.544),new v3(0.32,0,-0.38),new v3(0.38,0,-0.22),new v3(0.44,0,-0.06),new v3(0.5,0,0.1),new v3(0.5,0,0.3),new v3(0.45,0,0.3),new v3(0.1,0,0.2),new v3(0,0.0010,0.2)];sH=new Mesh(new lO(a,12),lT("textures/rivets2.jpg",
13434845,true));sH.sC.set(5,5,7.5).ms(1*Math.sqrt(Ws));sH.ppos.z=800*Ws;sH.V=new v3(0,0,0);sH.rV=new v3(0,0,0);sH.color=13434845;sH.window=new Mesh(new SS(0.2,8,8),new mQm({color:6711022,specular:11184810,shininess:300,rfl:0.8,op:0.8,blending:AdditiveBlending,shading:SmoothShading}));for(a=0;a<sH.window.gG.vts.length;a++)sH.window.gG.vts[a].ppos.aS(tempV.set(0,
0.32,-0.05));sH.window.matrix=sH.matrix;sH.window.aum=false;sH.sH=new Mesh(new SS(1.1,12,12),new mQm({ambient:2254404,color:2263142,specular:11158596,shininess:300,rfl:0.6,op:0.4,refraction_ratio:0.7,blending:AdditiveBlending,shading:SmoothShading}));for(a=0;a<sH.sH.gG.vts.length;a++)sH.sH.gG.vts[a].ppos.z-=0.15;sH.sH.matrix=sH.matrix;sH.sH.aum=sH.sH.vs=
false;sH.Th=[];a=new mBm({ambient:2237030,color:5592473,op:0.8,blending:AdditiveBlending,shading:FlatShading});sH.Th.fwd=new Mesh(new SS(0.1,8,8),a);sH.Th.lt=new Mesh(new SS(0.1,8,8),a);sH.Th.rt=new Mesh(new SS(0.1,8,8),a);for(a=0;a<sH.Th.fwd.gG.vts.length;a++){sH.Th.fwd.gG.vts[a].ppos.z+=0.25;sH.Th.lt.gG.vts[a].ppos.x-=0.5;sH.Th.rt.gG.vts[a].ppos.x+=
0.5}sH.Th.fwd.matrix=sH.Th.lt.matrix=sH.Th.rt.matrix=sH.matrix;sH.Th.fwd.aum=sH.Th.fwd.vs=false;sH.Th.lt.aum=sH.Th.rt.vs=false;sH.Th.rt.aum=sH.Th.lt.vs=false;a=lI("textures/crosshairs2.jpg");a=new mBm({op:0.6,color:5614165,blending:AdditiveBlending,shading:FlatShading,depth_test:false,map:new Texture(a,new UVMapping,
ClampToEdgeWrapping,NearestFilter,LinearFilter)});sH.cH=new Mesh(new Plane(10*Ws,10*Ws,1,1),a);for(a=0;a<sH.cH.gG.vts.length;a++)sH.cH.gG.vts[a].ppos.z-=75*Ws;sH.cH.matrix=sH.matrix;sH.cH.aum=false;sH.cH.vs=true;prepoB(sH);sH.gG.cMpBoundingSS();scene.addoB(sH.window);scene.addoB(sH.sH);scene.addoB(sH.Th.fwd);
scene.addoB(sH.Th.lt);scene.addoB(sH.Th.rt);scene.addoB(sH.cH);sH.cT=_sH;cMpCOM(sH);nsHs--;document.getElementById("Lives").innerHTML="Lives: "+nsHs;EE=1E4;document.getElementById("Energy").innerHTML="Energy: "+EE;return sH}var Us=[];aq+="R";
function CrUFO(a,b){if(a==undefined)if(rnd()<0.7){a=2;if(b==undefined)b=16759739}else{a=1.3;if(b==undefined)b=65280}for(var c=null,d=0;d<Us.length;d++)if(!Us[d].vs&&Us[d].size==a){c=Us[d];break}if(c==null){var f=a==2?10:8;c=new Mesh(new SS(1,f,f),lT("textures/space_panel2.jpg",b,true));for(d=0;d<c.gG.vts.length;d++)c.gG.vts[d].ppos.ms(a).mS(tempV.set(1,0.3,1));c.sC.ms(a*10*Math.sqrt(Ws));c.size=
a;c.color=b;c.window=new Mesh(new SS(1,f,f),new mQm({color:16776960,specular:11184810,shininess:300,rfl:0.8,op:0.8,blending:AdditiveBlending,shading:SmoothShading}));f=c.window.gG;for(d=0;d<f.vts.length;d++)f.vts[d].ppos.ms(a).mS(tempV.set(0.5,0.6,0.5));c.window.matrix=c.matrix;c.window.aum=false;c.lastShot=time();c.gG.cMpBoundingSS();c.V=new v3;changeUFODirection(c);
c.cT=_UFO;cMpCOM(c);scene.addoB(c.window);Us.push(c)}d=rnd();f=rnd()-0.5;var g=rnd()-0.5;if(d<=0.33){c.mainDirection=rnd()>0.5?1:-1;c.ppos.set(-1E3*c.mainDirection,f*2E3,g*2E3)}else if(d<=0.67){c.mainDirection=rnd()>0.5?1:-1;c.ppos.set(f*2E3,-1E3*c.mainDirection,g*2E3)}else{c.mainDirection=rnd()>0.5?1:-1;c.ppos.set(f*2E3,g*2E3,-1E3*c.mainDirection)}c.ppos.ms(Ws);nUFOs++;document.getElementById("UFOs").innerHTML="UFOs: "+nUFOs;c.vs=c.window.vs=
true;prepoB(c);return c}function changeUFODirection(a){if(Math.abs(a.mainDirection)==1)a.V.set(1.5*(a.mainDirection>0?1:-1),rnd(),rnd()).aSc(-0.5);else Math.abs(a.mainDirection)==2?a.V.set(rnd(),1.5*(a.mainDirection>0?1:-1),rnd()).aSc(-0.5):a.V.set(rnd(),rnd(),1.5*(a.mainDirection>0?1:-1)).aSc(-0.5);a.V.setLength(3/a.size*speed)}var starGeoms=[];aq+="l";
function CrStars(a,b,c){if(a>0){for(var d=[],f=new GG,g=0;g<a;g++){var h=Math.floor(rnd()*25)+13;if(d[g%10]==null){var j=20+Math.floor(rnd()*150);j=~~(j+Math.floor(rnd()*20))<<16^~~(j+Math.floor(rnd()*50))<<8^~~(j+Math.floor(rnd()*80));d[g%10]=new mBm({color:j,shading:FlatShading})}if(starGeoms.length<=h||starGeoms.size==null){j=starGeoms[h]=new Star(h*Ws);j.faces[0].mTs=j.faces[1].mTs=[d[g%10]]}h=new Mesh(starGeoms[h]);h.ppos.set(rnd(),
rnd(),rnd()).aSc(-0.5).setLength((5E3+rnd()*1E3)*Ws);h.rt.set(rnd(),rnd(),rnd()).setLength(2*Math.PI);GGUtils.merge(f,h)}f.sortFacesByMt();g=new Mesh(f,new MeshFaceMt);prepoB(g)}if(c&&starsBgImage!==undefined){var k=[];c=lI(starsBgImage);c.onload=function(){k.loadCount=6};for(g=c.loaded=0;g<6;g++)k[g]=c;c=new Texture(k,undefined,undefined,undefined,NearestFilter,NearestFilter);c=SceneUtils.addPanoramaCubeWebGL(scene,12500*
Ws,c);c.aum=false}if(b){c=new Mesh(new SS(4995*Ws),new mBm({color:1118515,wf:true,wf_lw:1}));prepoB(c)}}var exMts=null;aq+="c";
function getExMt(a,b,c){if(a==undefined)a=0;if(c==undefined)c="textures/Explode-05-june-";if(exMts==null||exMts.length<a||exMts[a]==null){if(exMts==null)exMts=[];b="00"+a;if(a>=10)b="0"+a;c=lI(c+b+".jpg");out=new mBm({op:0.7,depth_test:false,blending:AdditiveBlending,shading:FlatShading,map:new Texture(c,new UVMapping,ClampToEdgeWrapping,NearestFilter,LinearFilter)});
exMts[a]=out}return exMts[a]}aq+="m";var exs=[],shardGeoms=[];
function CrEx(a,b){var c="textures/Explode-05-june-",d=25,f=11171652,g=new v3,h=18,j=true;if(b){if(b.path!==undefined)c=b.path;if(b.V!==undefined)g=b.V;if(b.nShards!==undefined)d=b.nShards;if(b.color!==undefined)f=b.color;if(b.maxDist!==undefined)h=b.maxDist;if(b.doLight!==undefined)j=b.doLight}var k=rnd()<0.5?-1:1;k=new Mesh(new Plane((50+rnd()*25)*k*Ws*0.5,(50+rnd()*25)*k*Ws*0.5,1,1),getExMt(0,f,c));k.ppos.cy(a);prepoB(k);
k.index=0;k.maxIndex=29;k.path=c;k.light=new PointLight(f,j?0.1:1.0E-5);k.light.ppos.cy(k.ppos);scene.addLight(k.light);k.color=f;c=false;for(j=0;j<exs.length;j++)if(exs[j]==null){exs[j]=k;c=true;break}c||exs.push(k);k.shards=[];for(c=0;c<d;c++){var m;j=new Color(f);rnd();if(c==0||c==Math.round(d/3)||c==Math.round(d*2/3)){if(c==Math.round(d/3)){j.r*=1.4;j.g*=1.4;j.b*=1.4}else if(c==Math.round(d*2/3)){j.r*=0.6;j.g*=0.6;j.b*=0.6}if(j.r>1)j.r=1;if(j.g>
1)j.g=1;if(j.b>1)j.b=1;j.updateHex();m=new mBm({color:j.hex,shading:FlatShading})}var o;if(shardGeoms.length<=c){o=new lO([new v3(0,0,0.07*1.5),new v3(0.05*1.5,0,-0.045),new v3(0,0,-0.045)],3);var w=o.vts;for(j=0;j<w.length;j++)w[j].ppos.mS(rndV2().aSc(-0.5));shardGeoms[c]=o}else o=shardGeoms[c];j=new Mesh(o,m);j.rt.set(rnd(),rnd(),rnd()).ms(Math.PI);j.sC.ms((40+30*
(rnd()-0.5))*Ws);j.V=rndV().aSc(-0.5).ms(5*speed).aS(g);j.ppos.cy(k.ppos).aS(tempV.cy(j.V).divideScalar(10));j.rotAxis=rndV().aSc(-0.5).ms(2).normalize();j.rV=rnd()*Math.PI/4;j.rA=0;j.traveled=0;j.maxDistance=h+(rnd()-0.25)*h;prepoB(j);k.shards[c]=j}return k}var tredoes=[],trMts=[];trMts.sH=new mBm({color:16724787,shading:FlatShading});aq+="9";
trMts.U=new mBm({color:3355647,shading:FlatShading});var trGeom=new lO([new v3(0,0,0.07),new v3(0.05,0,-0.03),new v3(0,0,-0.03)],3);aq+="p";
function CrTr(a,b,c){if(a==undefined)a=true;if(c==undefined)c=100*Ws/speed;for(var d=null,f=0;f<tredoes.length;f++)if(!tredoes[f].vs&&tredoes[f].fromsH==a){d=tredoes[f];break}if(d==null){d=new Mesh(trGeom,a?trMts.sH:trMts.U);d.sC.ms(50*Math.sqrt(Ws));tredoes.push(d);prepoB(d);d.cT=_Tr;cMpCOM(d)}d.vs=true;d.fromsH=a;d.ppos.cy(b.ppos);if(a){b=sH.rtMatrix.mV3(tempV.set(0,
0,-1));b.normalize().ms(60);d.ppos.aS(b);d.V=b.ms(0.7*speed).aS(sH.V).clone()}else{tempV.set(sH.ppos.x,sH.ppos.y,sH.ppos.z);a=rndV().aSc(-0.5).ms(0.5);tempV.subSelf(b.ppos).normalize().aS(a);d.ppos.cy(b.ppos);d.V=tempV.ms(12/b.size*speed).clone()}d.traveled=0;d.maxDistance=c;d.um();return d}
function cMpCOM(a){for(var b=new v3,c=a.gG.vts,d=0,f=c.length;d<f;d++)b.aS(c[d].ppos);b.divideScalar(c.length);return a.com=b}aq+="Z";
function objectClosestTo(a){var b=null,c=null,d=9999999,f=scene.objects,g=a.com.clone();g=a.matrix.mV3(g);for(var h=0;h<f.length;h++)if(f[h].cT!=undefined){var j=f[h];if(j.vs)if(j!=a)if(j.cT!=a.cT)if(!(a.cT==_Tr&&a.fromsH==true&&j.cT==_sH))if(!(j.cT==_Tr&&j.fromsH==true&&a.cT==_sH))if(!(a.cT==_Tr&&a.fromsH==false&&j.cT==_UFO))if(!(j.cT==_Tr&&j.fromsH==false&&a.cT==_UFO)){var k=
j.com.clone(j.com);k=j.matrix.mV3(k);var m=g.distanceToSquared(k);if(m<d){d=m;b=j;c=k}}}return{dist:d,obj:b,com:c}}aq+="H";
function objectHitBy(a){var b=objectClosestTo(a);if(b.obj==null)return null;if(b.obj.cT!=_E&&b.dist>1E5||b.obj.cT==_E&&b.dist>1E6)return null;var c=tempV.cy(a.com);a.matrix.mV3(c);var d=a.V;if(d.x==0&&d.y==0&&d.z==0)d=b.obj.V;var f=c.clone().subSelf(d);d=c.clone().aS(d);var g=f.distanceToSquared(d),h=b.com;g=((h.x-f.x)*(d.x-f.x)+(h.y-f.y)*(d.y-f.y)+(h.z-f.z)*(d.z-f.z))/g;c.set(f.x+g*(d.x-f.x),f.y+g*(d.y-f.y),f.z+g*(d.z-f.z));c=h.distanceToSquared(c);
f=(new v3(b.obj.gG.bS.radius,b.obj.gG.bS.radius,b.obj.gG.bS.radius)).mS(b.obj.sC);CCFollowssH&&b.obj.cT==_sH&&f.ms(10);f=f.x+f.y+f.z;f=f*f/9;if(c<f)return b.obj;d=(new v3(a.gG.bS.radius,a.gG.bS.radius,a.gG.bS.radius)).mS(a.sC);CCFollowssH&&a.cT==_sH&&d.ms(10);d=d.x+d.y+d.z;d=d*d/9;if(c<f+d)return b.obj;
return null}function is(a){var b=score;score+=a;document.getElementById("Score").innerHTML="Score: "+score;if(score%5E3<b%5E3&&score>maxScore){nsHs+=1;document.getElementById("Lives").innerHTML="Lives: "+nsHs}maxScore=score>maxScore?score:maxScore}aq+="M";
function updateAstCount(){document.getElementById("nAst").innerHTML='Asteroids: <font color="#aa44aa">'+ASCount[2]+'</font><font color="#44aaaa"> '+ASCount[1]+'</font><font color="#aaaa44"> '+ASCount[0]+"<font>"}var startTime=lastTime=time(),sHHitTime=lastTime,lastTorpTime=lastTime,CCZ=1E3;
function la(){if(!paused){var a=time();a-startTime>1E4&&!keysDown.h&&hide("info");E.rt.y+=0.0020*Math.cos(26*Math.PI/180);E.um();M.orbitAngle-=0.02*Math.PI/180;M.ppos.set(500*Ws*Math.cos(M.orbitAngle),0,500*Ws*Math.sin(M.orbitAngle));M.rt.y=-M.orbitAngle;M.um();wp=function(k){var m=1E3*Ws;if(k.x>m)k.x-=2*m;else if(k.x<-m)k.x+=2*m;if(k.y>m)k.y-=2*m;else if(k.y<-m)k.y+=2*m;if(k.z>m)k.z-=2*m;else if(k.z<
-m)k.z+=2*m;return k};var b=true;if(sH.vs){sH.ppos=wp(sH.ppos.aS(sH.V));var c=false;if(EE>a-lastTime&&keysDown.w){var d=sH.rtMatrix.mV3(tempV.set(0,0,-1));d.normalize().ms(0.2*speed);sH.V.aS(d);c=sH.Th.fwd.vs=true}else sH.Th.fwd.vs=false;if(EE>a-lastTime&&keysDown.a){d=sH.rtMatrix.mV3(tempV.set(-1,0,0));d.normalize().ms(0.2*speed);sH.V.aS(d);
c=sH.Th.rt.vs=true}else sH.Th.rt.vs=false;if(EE>a-lastTime&&keysDown.d){d=sH.rtMatrix.mV3(tempV.set(1,0,0));d.normalize().ms(0.2*speed);sH.V.aS(d);c=sH.Th.lt.vs=true}else sH.Th.lt.vs=false;if(EE>a-lastTime&&keysDown.z){sH.V.ms(0.9);if(sH.V.length()>0.0010)c=true}if(c){EE-=a-lastTime;b=false}if(EE>a-lastTime&&keysDown.s){sH.sH.vs=true;EE-=
a-lastTime;b=false}else sH.sH.vs=false;if(EE>1E3&&a-lastTorpTime>330&&keysDown[" "]){CrTr(true,sH,40*Ws/speed);EE-=500;lastTorpTime=a;b=false}if(b&&EE<1E4){EE+=Math.round((a-lastTime)/2);if(EE>1E4)EE=1E4}if(EE<0)EE=0;document.getElementById("Energy").innerHTML="Energy: "+Math.floor(EE/100)*100;b=Math.PI*2/720/16*speed;if(keysDown.dn)sH.rV.x+=b;if(keysDown.up)sH.rV.x-=b;else if(Math.abs(sH.rV.x)>1.0E-7&&
!keysDown.dn&&!keysDown.up)sH.rV.x*=0.8;if(keysDown.lt)sH.rV.y+=b;if(keysDown.rt)sH.rV.y-=b;else if(Math.abs(sH.rV.y)>1.0E-7&&!keysDown.lt&&!keysDown.rt)sH.rV.y*=0.8;sH.rt.aS(sH.rV);sH.rtMatrix.setRotY(sH.rt.y);sH.rtMatrix.mS(tempM.setRotX(sH.rt.x));sH.matrix.setTranslation(sH.ppos.x,sH.ppos.y,sH.ppos.z);sH.matrix.mS(sH.rtMatrix);sH.matrix.mS(tempM.setScale(sH.sC.x,
sH.sC.y,sH.sC.z));if(CCFollowssH){sH.sC.set(5,5,7.5).ms(1*Math.sqrt(Ws));CC.ppos.cy(sH.ppos);d=sH.rtMatrix.mV3(tempV.set(0,0.6,1.2));d.normalize().ms(15*Math.sqrt(Ws));CC.ppos.aS(d);d=sH.rtMatrix.mV3(tempV.set(0,1,0));CC.up.cy(d.normalize());d=sH.rtMatrix.mV3(tempV.set(0,0,-1));d.normalize().ms(99999999);CC.target.ppos.cy(d);
CC.um()}else{sH.sC.set(5,5,7.5).ms(10*Math.sqrt(Ws));if(mouseDown){if(shiftPressed){if(Math.abs(mouseX-oldMouseX)>1)CCZ+=mouseX-oldMouseX}else{if(Math.abs(mouseX-oldMouseX)>1)CC.rt.x+=(mouseX-oldMouseX)*5.0E-4;if(Math.abs(mouseY-oldMouseY)>1)CC.rt.y-=(mouseY-oldMouseY)*5.0E-4}CC.ppos.set(Math.sin(CC.rt.x),Math.sin(CC.rt.y),Math.cos(CC.rt.x)*Math.cos(CC.rt.y)).ms(CCZ*Ws);
CC.um()}}}for(b=0;b<Us.length;b++){c=Us[b];if(!(c==null||!c.vs)){c.rt.y+=2*Math.PI/72/c.size;c.ppos=wp(c.ppos.aS(c.V));c.um();if(a>c.lastShot+(c.size==2?2E3:800)){CrTr(false,c,100*Ws/speed);c.lastShot=a;changeUFODirection(c)}}}for(b=0;b<ASs.length;b++){var f=ASs[b];if(!(f==null||!f.vs)){f.rA+=f.rV;f.ppos=wp(f.ppos.aS(f.V));f.um();tempM.setRotAxis(f.rotAxis,
f.rA);f.matrix.mS(tempM)}}for(b=tredoes.length-1;b>=0;b--){var g=tredoes[b];if(g.vs){var h=objectHitBy(g);if(h!=null){h.cT!=_sH&&CrEx(g.ppos,{V:h.V,color:h.color});g.traveled=g.maxDistance-1;g.vs=false;if(h.cT==_sH){if(!h.sH.vs){CrEx(h.ppos,{V:h.V,color:h.color});h.vs=h.window.vs=h.sH.vs=false;h.Th.fwd.vs=h.Th.lt.vs=false;h.Th.rt.vs=
h.cH.vs=false;sHHitTime=a}}else if(h.cT==_AS){h.vs=false;ASCount[h.index]--;g.fromsH==true&&is(30/(h.index+1));if(h.index>0){var j=0;if(h.index==2)j=2;else if(h.index==1)j=3;for(c=0;c<j;c++){f=CrAS(h.index-1);f.V.aS(h.V);f.ppos.cy(h.ppos);f.ppos.aS(tempV.cy(f.V).ms(3))}}updateAstCount()}else if(h.cT==_UFO){h.vs=h.window.vs=false;if(h.size==2)is(100);
else h.size==1.3&&is(250);nUFOs--;document.getElementById("UFOs").innerHTML="UFOs: "+nUFOs}else if(h.cT==_E)is(-10);else if(h.cT==_M){for(c=0;c<3;c++){f=CrAS(0);f.ppos.cy(g.ppos);f.ppos.aS(d.cy(f.V).ms(5))}is(-5);updateAstCount()}}}if(g.vs){g.rt.set(rnd(),rnd(),rnd()).ms(2*Math.PI);g.traveled+=1;g.ppos=wp(g.ppos.aS(g.V));g.um();if(g.traveled>
g.maxDistance)g.vs=false}}if(sH.vs){h=objectHitBy(sH);if(h!=null&&(h.cT==_AS||h.cT==_UFO||h.cT==_E||h.cT==_M)){CrEx(h.ppos,{V:h.V,color:h.color});CrEx(sH.ppos,{V:sH.V,color:sH.color});if(!sH.sH.vs){sH.vs=sH.window.vs=sH.sH.vs=false;sH.Th.fwd.vs=sH.Th.lt.vs=false;sH.Th.rt.vs=sH.cH.vs=false;
sHHitTime=a}if(h.cT==_AS){h.vs=false;is(30/(h.index+1));if(h.index>0){j=0;if(h.index==2)j=2;else if(h.index==1)j=3;for(c=0;c<j;c++){f=CrAS(h.index-1);f.V.aS(h.V);f.ppos.cy(h.ppos)}}}else if(h.cT==_UFO){h.vs=h.window.vs=false;if(h.size==2)is(100);else h.size==1.3&&is(250);nUFOs--;document.getElementById("UFOs").innerHTML="UFOs: "+nUFOs}}}for(b=exs.length-1;b>=0;b--){d=exs[b];
if(d!=null&&d.vs){if(d.index>=d.maxIndex){d.vs=false;d.light!=null&&scene.removeLight(d.light);scene.removeoB(d)}d.index++;d.mTs[0]=getExMt(d.index,d.color,d.path);if(d.light!=null){if(d.index<=8&&d.light.intensity>=0.01)d.light.intensity+=0.07;if(d.index>8)d.light.intensity*=0.8;d.light!=null&&d.index>8&&d.light.intensity<0.1&&scene.removeLight(d.light)}c=CC.ppos.clone().subSelf(d.ppos).normalize();f=tempV.cross(CC.up,c).normalize();g=(new v3).cross(c,
f).normalize();tempM.set(f.x,g.x,c.x,0,f.y,g.y,c.y,0,f.z,g.z,c.z,0,0,0,0,1);d.um();d.matrix.mS(tempM);f=d.shards;for(c=f.length-1;c>=0;c--){g=f[c];if(g!=null){g.traveled+=1;if(g.vs){g.rA+=g.rV;g.ppos=g.ppos.aS(g.V);g.um();tempM.setRotAxis(g.rotAxis,g.rA);g.matrix.mS(tempM)}if(g.traveled>=g.maxDistance||!d.vs){g.vs=false;scene.removeoB(g);f[c]=null}}}}else if(d!=null){d.light!=null&&scene.removeLight(d.light);
scene.removeoB(d);exs[b]=null}}if(a>=UTime){CrUFO();UTime=a+(3E4*Math.random()+2E4)*(nUFOs+1)}if(!sH.vs&&a-sHHitTime>5E3)if(nsHs>0){sH=CrsH();sH.ppos.z=800*Ws;sH.um()}else show("gameOver");stats!=null&&stats.update();renderer.render(scene,CC);lastTime=a}}aq+="u";
if(ibc())ia();else{document.getElementById("info").style.display="none";document.getElementById("gameOver").style.display="none";document.getElementById("oldie").style.display="block"}var mouseDown=false,mouseX=window.innerWidth/2,mouseY=window.innerHeight/2,oldMouseX,oldMouseY,shiftPressed=false;function onDocumentMouseMove(a){if(mouseDown){oldMouseX=mouseX;mouseX=a.clientX;oldMouseY=mouseY;mouseY=a.clientY;shiftPressed=a.shiftKey}}aq+="=";
function onDocumentMouseDown(a){mouseDown=true;mouseX=oldMouseX=a.clientX;mouseY=oldMouseY=a.clientY}aq+="d";function onDocumentMouseUp(){mouseDown=false}aq+="Q";var paused=false,keysDown=[];
function onDocumentKeyDown(a){if(!a)a=window.event;var b=String.fromCharCode(a.keyCode).toLowerCase();if(a.keyCode==38){b="up";a.preventDefault();a.stopPropagation()}else if(a.keyCode==40){b="dn";a.preventDefault();a.stopPropagation()}else if(a.keyCode==37){b="lt";a.preventDefault();a.stopPropagation()}else if(a.keyCode==39){b="rt";a.preventDefault();a.stopPropagation()}keysDown[b]=true;switch(b){case "p":paused=!paused;break;case "s":sH.sH.vs=true;break;case " ":a.preventDefault();a.stopPropagation();
break;case "v":CCFollowssH=!CCFollowssH;if(!CCFollowssH){CC.target.ppos.set(0,0,0);CC.up.set(0,1,0);CC.ppos.set(Math.sin(CC.rt.x),Math.sin(CC.rt.y),Math.cos(CC.rt.x)*Math.cos(CC.rt.y)).ms(CCZ*Ws);CC.um()}break;case "x":sH.cH.vs=false;break;case "u":CrUFO();break;case "h":show("info")}}aq+="D";
function onDocumentKeyUp(a){if(!a)a=window.event;var b=String.fromCharCode(a.keyCode).toLowerCase();if(a.keyCode==38)b="up";else if(a.keyCode==40)b="dn";else if(a.keyCode==37)b="lt";else if(a.keyCode==39)b="rt";keysDown[b]=false;switch(b){case "w":sH.Th.fwd.vs=false;break;case "a":sH.Th.rt.vs=false;break;case "d":sH.Th.lt.vs=false;break;case "s":sH.sH.vs=false;case "x":sH.cH.vs=true;break;case "h":hide("info")}};
